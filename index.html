<!-- ========== –ù–ê–ß–ê–õ–û –ß–ê–°–¢–ò 1: HTML + –ë–ê–ó–û–í–´–ô CSS ========== -->

<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>VATSIM AWOSD</title>
<style>
/* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –∏ layout */
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',sans-serif;background:#f0f0f0;transition:all .3s ease}
body.dark{background:#1a1a1a;color:#fff}
.container{padding:min(10px,1vw);margin:0 auto;height:100vh;display:flex;flex-direction:column;min-height:600px;max-height:100vh;overflow:hidden;max-width:100vw;box-sizing:border-box}
.controls{display:flex;gap:8px;margin-bottom:10px;align-items:center;flex-wrap:wrap;flex-shrink:0}
select,input{padding:4px 8px;border:1px solid #ccc;border-radius:4px;background:white;font-size:12px;height:28px}
.dark select,.dark input{background:#333;border-color:#555;color:white}
.main-layout{display:grid;grid-template-columns:35% 30% 35%;gap:min(10px,1vw);margin-bottom:min(10px,1vh);flex:1;min-height:0;max-width:100%}
.bottom-section{grid-column:1 / -1;flex:0 0 auto;height:clamp(100px,12vh,120px)}
.block{background:white;border-radius:6px;padding:min(12px,1vw);box-shadow:0 1px 5px rgba(0,0,0,.1);display:flex;flex-direction:column;overflow:hidden;min-height:0}
.dark .block{background:#2a2a2a;box-shadow:0 1px 5px rgba(255,255,255,.1)}

/* –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –¥–∞–Ω–Ω—ã–º */
.connection-status{display:flex;align-items:center;gap:5px;font-size:10px;color:#666}
.connection-status.connected{color:#28a745}
.connection-status.error{color:#dc3545}
.connection-status.loading{color:#ffc107}
.status-indicator{width:8px;height:8px;border-radius:50%;background:currentColor;animation:pulse 2s infinite}
.dark .connection-status{color:#999}
.dark .connection-status.connected{color:#40c767}
.dark .connection-status.error{color:#e74c3c}

@keyframes pulse {
0% { opacity: 1; }
50% { opacity: 0.5; }
100% { opacity: 1; }
}

/* –ë–ª–æ–∫ 1 - —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π */
.block-1{display:flex;flex-direction:column;align-items:center;text-align:center;gap:min(2px,.2vh);font-size:clamp(16px,1.6vw,22px);padding:min(6px,.6vw);overflow-y:auto}
.block-1 *{font-size:inherit!important}
.icao-section{text-align:center;margin-bottom:min(4px,.4vh)}
.block-1 .icao-input{text-align:center;width:clamp(140px,16vw,200px);font-size:clamp(16px,1.6vw,22px);height:clamp(28px,3vh,35px)}
.weather-data{display:flex;flex-direction:column;align-items:center;flex:1;gap:min(2px,.2vh);margin-top:min(20px,2vh)}
.weather-data>*{margin-bottom:0;flex-shrink:0}
.weather-data .sunrise-sunset-row{margin-bottom:min(24px,2.4vh)}
.weather-data .weather-row:first-of-type{margin-top:min(24px,2.4vh)}
.weather-row:nth-child(6){margin-top:min(24px,2.4vh)}
.weather-phenomena-block{margin-top:min(24px,2.4vh)}
.weather-phenomena-block+.weather-row{margin-top:min(24px,2.4vh)}
.weather-row:has(+ .weather-phenomena-block){margin-bottom:0}
.weather-row[id*=‚Äúmor‚Äù],.weather-row:has(.section-label:contains(‚ÄúMOR‚Äù)){margin-top:min(24px,2.4vh)}
.cloudiness-block{margin-top:min(24px,2.4vh)}

/* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ CSV –¥–∞–Ω–Ω—ã—Ö */
.csv-loading{
position: fixed;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(0,0,0,0.8);
color: white;
padding: 20px;
border-radius: 8px;
z-index: 1000;
display: none;
text-align: center;
}

.csv-loading.show{
display: block;
}

.loading-spinner{
width: 40px;
height: 40px;
border: 4px solid #f3f3f3;
border-top: 4px solid #3498db;
border-radius: 50%;
animation: spin 1s linear infinite;
margin: 0 auto 10px;
}

@keyframes spin {
0% { transform: rotate(0deg); }
100% { transform: rotate(360deg); }
}

.csv-info{
font-size: 12px;
color: #ccc;
margin-top: 10px;
}
</style>

</head>
<body>
<div class="csv-loading" id="csvLoading">
  <div class="loading-spinner"></div>
  <div>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤...</div>
  <div class="csv-info">–û–±—Ä–∞–±–æ—Ç–∫–∞ airports.csv –∏ runways.csv</div>
</div>

<div class="container">
<div class="controls">
<select id="courseType">
<option value="true">True</option>
<option value="magnetic">Magnetic</option>
</select>
<select id="theme">
<option value="auto">Auto</option>
<option value="light">Light</option>
<option value="dark">Dark</option>
</select>
<select id="language">
<option value="en">English</option>
<option value="ru">–†—É—Å—Å–∫–∏–π</option>
</select>
<div class="connection-status" id="connectionStatus">
<div class="status-indicator"></div>
<span>Ready to load local CSV files</span>
</div>
</div>

<div class="main-layout">
<!-- –ë–ª–æ–∫ –∫–æ–º–ø–∞—Å–∞ 1 -->
<div class="block">
        <div class="runway-selector">
<select id="runwaySelect">
<option value="">Enter ICAO code</option>
</select>
</div>
<div class="compass-container">
<div class="lateral-component">
<div class="data-value">-</div>
<div class="data-label" id="lateralLabel1">Side</div>
</div>
<div class="headwind-component">
<div class="data-value">-</div>
<div class="data-label" id="headwindLabel1">Head</div>
</div>
<div class="friction-coefficient">
<div class="data-value">-</div>
<div class="data-label" id="frictionLabel1">Breaking action</div>
</div>
<div class="compass" id="compass"></div>
<div class="wind-display">
<div class="wind-direction">---¬∞</div>
<div class="wind-speed">-</div>
<div class="wind-unit">kt</div>
</div>
</div>
<div class="compass-info">
<div class="rvr-row">
<div class="section-label">RVR</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
<div class="units">–º</div>
</div>
</div>
</div>

<!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –±–ª–æ–∫ -->

<div class="block block-1">
<div class="icao-section">
<input type="text" id="icaoInput" class="icao-input" placeholder="ICAO" maxlength="4">
</div>
<div class="weather-data">
<div class="section-label" id="timeLabel">Time UTC</div>
<div class="data-field">
<div class="data-value" id="currentTime">--:--</div>
</div>
<div class="sunrise-sunset-row">
<div class="sunrise-sunset-item">
<div class="section-label" id="sunriseLabel">Sunrise</div>
<div class="data-field">
<div class="data-value" id="sunrise">-</div>
</div>
</div>
<div class="sunrise-sunset-item">
<div class="section-label" id="sunsetLabel">Sunset</div>
<div class="data-field">
<div class="data-value" id="sunset">-</div>
</div>
</div>
</div>
<div class="weather-row">
<div class="section-label">QNH</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
<div class="units">hPa</div>
</div>
<div class="weather-row pressure-row">
<div class="section-label"></div>
<div class="data-field">
<div class="data-value pressure-secondary">-</div>
</div>
<div class="units">mmHg</div>
</div>
<div class="weather-row pressure-row">
<div class="section-label"></div>
<div class="data-field">
<div class="data-value pressure-secondary">-</div>
</div>
<div class="units">inHg</div>
</div>
<div class="weather-row">
<div class="section-label">T</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
<div class="units">¬∞C</div>
</div>
<div class="weather-row">
<div class="section-label">DP</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
<div class="units">¬∞C</div>
</div>
<div class="weather-phenomena-block">
<div class="section-label" id="weatherLabel">Weather</div>
<div class="data-field">
<div class="data-value" id="weatherPhenomena">-</div>
</div>
</div>
<div class="weather-row">
<div class="section-label" id="morLabel">MOR</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
<div class="units">–º</div>
</div>
<div class="weather-row">
<div class="section-label" id="qbbLabel">QBB</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
<div class="units">–º</div>
</div>
<div class="cloudiness-block">
<div class="section-label" id="skyConditionLabel">Sky condition</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
</div>
</div>
</div>

<!-- –ë–ª–æ–∫ –∫–æ–º–ø–∞—Å–∞ 2 -->

<div class="block">
        <div class="runway-selector">
<div class="runway-display-label" id="runwayDisplay2">--</div>
</div>
<div class="compass-container">
<div class="lateral-component">
<div class="data-value">-</div>
<div class="data-label" id="lateralLabel2">Side</div>
</div>
<div class="headwind-component">
<div class="data-value">-</div>
<div class="data-label" id="headwindLabel2">Head</div>
</div>
<div class="friction-coefficient">
<div class="data-value">-</div>
<div class="data-label" id="frictionLabel2">Breaking action</div>
</div>
<div class="compass" id="compass2"></div>
<div class="wind-display">
<div class="wind-direction">---¬∞</div>
<div class="wind-speed">-</div>
<div class="wind-unit">kt</div>
</div>
</div>
<div class="compass-info">
<div class="rvr-row">
<div class="section-label">RVR</div>
<div class="data-field">
<div class="data-value">-</div>
</div>
<div class="units">–º</div>
</div>
</div>
</div>

<!-- –ù–∏–∂–Ω–∏–π –±–ª–æ–∫ -->

<div class="bottom-section">
<div class="forecast-section">
<div class="forecast-field">
<div class="forecast-label" id="forecastLabel">Weather forecast</div>
<div class="forecast-value">-</div>
</div>
<div class="forecast-field">
<div class="forecast-label" id="specialLabel">Special conditions</div>
<div class="forecast-value">-</div>
</div>
<div class="forecast-field">
<div class="forecast-label">METAR</div>
<div class="forecast-value" id="metarCode">-</div>
</div>
</div>
</div>
</div>
</div>

<!-- ========== –ö–û–ù–ï–¶ –ß–ê–°–¢–ò 1 ========== --><!-- ========== –ó–ê–ú–ï–ù–ê –ß–ê–°–¢–ò 2 CSS: –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô LAYOUT COMPASS-INFO ========== -->

<style>
/* –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∏–∑ —á–∞—Å—Ç–∏ 1 */
.sunrise-sunset-row{display:flex;gap:min(6px,.6vw);align-items:center;margin-bottom:min(4px,.4vh)}
.sunrise-sunset-item{display:flex;flex-direction:column;align-items:center;gap:1px}

/* –£–ú–ï–ù–¨–®–ï–ù–ù–´–ô –ë–õ–û–ö –í–†–ï–ú–ï–ù–ò –ù–ê 20% */
.sunrise-sunset-item .section-label{font-size:clamp(11px,1.1vw,14px)!important}
.sunrise-sunset-item .data-field{width:clamp(72px,7.2vw,104px);font-size:clamp(13px,1.3vw,18px)!important}
.sunrise-sunset-item .data-value{font-size:clamp(13px,1.3vw,18px)!important}

/* –í–´–†–ê–í–ù–ò–í–ê–ù–ò–ï –ü–û–õ–ï–ô –ü–û–ì–û–î–´ –ü–û –¶–ï–ù–¢–†–ê–õ–¨–ù–û–ô –õ–ò–ù–ò–ò */
.weather-row{
display:grid;
grid-template-columns:1fr auto 1fr;
align-items:center;
width:100%;
gap:min(6px,.6vw);
margin:min(4px,.4vh) 0;
}

.weather-row .section-label{
color:#666;
text-align:right;
font-size:clamp(14px,1.4vw,18px);
white-space:nowrap;
justify-self:end;
}

.weather-row .data-field{
width:max(80px,7vw);
text-align:center;
padding:min(4px,.4vw);
background:#f8f8f8;
border-radius:3px;
justify-self:center;
}

.weather-row .units{
color:#666;
text-align:left;
font-size:clamp(14px,1.4vw,18px);
justify-self:start;
}

/* ========== –†–ê–°–®–ò–†–ï–ù–ù–´–ï –ë–õ–û–ö–ò –Ø–í–õ–ï–ù–ò–ô –ü–û–ì–û–î–´ –ò –û–ë–õ–ê–ß–ù–û–°–¢–ò –ù–ê 60% ========== */
.weather-phenomena-block,.cloudiness-block{
width:100%;
text-align:center;
display:flex;
flex-direction:column;
align-items:center;
margin:min(8px,.8vh) 0
}

.weather-phenomena-block .section-label,.cloudiness-block .section-label{
text-align:center!important;
width:100%!important;
margin-bottom:min(5px,.5vh)!important
}

.weather-phenomena-block .data-field,.cloudiness-block .data-field{
width:clamp(288px,28.8vw,448px)!important;
text-align:center!important
}

/* –ò–°–ü–†–ê–í–õ–Ø–ï–ú –®–†–ò–§–¢ –Ø–í–õ–ï–ù–ò–ô –ò –û–ë–õ–ê–ß–ù–û–°–¢–ò - –ö–ê–ö –£ –í–û–°–•–û–î–ê/–ó–ê–•–û–î–ê */
.weather-phenomena-block .data-value,.cloudiness-block .data-value{
font-weight:normal!important;
font-size:clamp(13px,1.3vw,18px)!important;
}

/* –°–¢–ò–õ–ò –î–õ–Ø –ü–û–õ–ï–ô QNH –° –£–ú–ï–ù–¨–®–ï–ù–ù–´–ú –®–†–ò–§–¢–û–ú –ò –û–¢–°–¢–£–ü–ê–ú–ò */
.weather-row+.weather-row.pressure-row{margin-top:min(-6px,-.6vh)}
.weather-row.pressure-row .section-label{font-size:clamp(10px,1.0vw,13px)!important}
.weather-row.pressure-row .data-field{font-size:clamp(10px,1.0vw,13px)!important}
.weather-row.pressure-row .units{font-size:clamp(10px,1.0vw,13px)!important}
.weather-row.pressure-row .data-value{font-size:clamp(11px,1.1vw,14px)!important}

/* –û–¢–°–¢–£–ü –ü–û–°–õ–ï –ü–û–°–õ–ï–î–ù–ï–ì–û –ü–û–õ–Ø QNH */
.weather-row:nth-child(6){margin-bottom:min(24px,2.4vh)!important}
.weather-row.pressure-row:last-of-type{margin-bottom:min(24px,2.4vh)!important}
.weather-row.pressure-row:nth-child(3){margin-bottom:min(24px,2.4vh)!important}
.weather-row:has(.units:contains("inHg")){margin-bottom:min(24px,2.4vh)!important}
.weather-row .units:contains("inHg"){margin-bottom:min(24px,2.4vh)!important}

.dark .weather-row .section-label,.dark .weather-row .units{color:#ccc}
.block-1 .section-label{color:#666;margin-bottom:1px;font-size:clamp(14px,1.4vw,18px);text-align:center}
.dark .block-1 .section-label{color:#ccc}
.block-1 .data-field{width:clamp(110px,11vw,150px);text-align:center;padding:min(4px,.4vw);background:#f8f8f8;border-radius:3px}
.data-field{text-align:center;padding:min(4px,.5vw);background:#f8f8f8;border-radius:3px}
.dark .data-field{background:#333}
.data-label{font-size:clamp(10px,1vw,12px);color:#666;margin-bottom:2px}
.dark .data-label{color:#ccc}
.data-value{font-size:clamp(16px,1.6vw,22px);font-weight:bold;line-height:.9}
#currentTime,#sunrise,#sunset{font-weight:normal!important}
.pressure-secondary{font-weight:normal!important}

/* –°—Ç–∏–ª–∏ –∫–æ–º–ø–∞—Å–∞ */
.compass-container{position:relative;width:80%;aspect-ratio:1;margin:0 auto 80px auto;flex-shrink:0;margin-top:min(30px,3vh);overflow:visible}
.compass{position:relative;width:100%;height:100%;border:2px solid #333;border-radius:50%;background:radial-gradient(circle,#fff 0%,#f0f0f0 100%);overflow:visible}
.dark .compass{border-color:#666;background:radial-gradient(circle,#2a2a2a 0%,#1a1a1a 100%)}
.compass-mark{position:absolute;background:#333}
.compass-mark.minor{width:1px;height:12px}
.compass-mark.major{width:2px;height:18px}
.dark .compass-mark{background:#ccc}
.compass-number{position:absolute;font-size:clamp(12px,1.8vw,20px);font-weight:bold;width:24px;text-align:center}
.wind-display{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;background:rgba(255,255,255,.9);padding:min(8px,.8vw);border-radius:6px;border:1px solid #ccc;min-width:80px}
.dark .wind-display{background:rgba(42,42,42,.9);border-color:#555}
.wind-direction{font-size:clamp(18px,2vw,26px);font-weight:bold}
.wind-speed{font-size:clamp(16px,1.8vw,22px);color:#333}
.dark .wind-speed{color:#ccc}
.wind-unit{font-size:clamp(12px,1.2vw,16px);color:#666}

/* –°—Ç–∏–ª–∏ –í–ü–ü */
.runway-display{position:absolute;top:50%;left:50%;width:70%;height:24px;background:transparent;border:3px solid #333;transform:translate(-50%,-50%);border-radius:6px}
.dark .runway-display{border-color:#ccc}
.runway-display.left-landing::before{content:'';position:absolute;width:20%;height:2px;background:repeating-linear-gradient(to right,#333 0px,#333 4px,transparent 4px,transparent 8px);left:5%;top:50%;transform:translateY(-50%);z-index:16}
.runway-display.left-landing::after{content:'';position:absolute;width:0;height:0;border-left:8px solid #333;border-top:4px solid transparent;border-bottom:4px solid transparent;left:25%;top:50%;transform:translateY(-50%);z-index:16}
.runway-display.right-landing::before{content:'';position:absolute;width:20%;height:2px;background:repeating-linear-gradient(to left,#333 0px,#333 4px,transparent 4px,transparent 8px);right:5%;top:50%;transform:translateY(-50%);z-index:16}
.runway-display.right-landing::after{content:'';position:absolute;width:0;height:0;border-right:8px solid #333;border-top:4px solid transparent;border-bottom:4px solid transparent;right:25%;top:50%;transform:translateY(-50%);z-index:16}
.dark .runway-display.left-landing::before{background:repeating-linear-gradient(to right,#ccc 0px,#ccc 4px,transparent 4px,transparent 8px)}
.dark .runway-display.right-landing::before{background:repeating-linear-gradient(to left,#ccc 0px,#ccc 4px,transparent 4px,transparent 8px)}
.dark .runway-display.left-landing::after{border-left-color:#ccc}
.dark .runway-display.right-landing::after{border-right-color:#ccc}

/* –°—Ç–∏–ª–∏ –≤–µ—Ç—Ä–∞ */
.wind-arrow{position:absolute;width:4px;height:25%;background:#333;transform-origin:top center;z-index:10}
.wind-arrow::after{content:'';position:absolute;bottom:-8px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:8px solid transparent;border-right:8px solid transparent;border-top:10px solid #333}
.dark .wind-arrow{background:#ccc}
.dark .wind-arrow::after{border-top-color:#ccc}
.wind-sector{position:absolute;top:50%;left:50%;width:0;height:0;border-left:60px solid transparent;border-right:60px solid transparent;border-bottom:60px solid rgba(255,107,107,.3);transform:translate(-50%,-100%) rotate(180deg);transform-origin:bottom center;display:none}
.wind-sector.variable{display:block}

/* ========== –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô LAYOUT –î–õ–Ø COMPASS-INFO: –ó–ê–ì–û–õ–û–í–ö–ò –°–õ–ï–í–ê, –ï–î–ò–ù–ò–¶–´ –°–ü–†–ê–í–ê ========== */
.compass-info{
display:grid;
grid-template-columns: 40% 60%; /* –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —É–∂–µ, –ø—Ä–∞–≤–∞—è —à–∏—Ä–µ –¥–ª—è QFE */
grid-template-rows: auto auto;
gap:min(8px,0.8vw);
margin-top:min(5px,0.5vh);
font-size:clamp(10px,1vw,14px);
margin-bottom:min(5px,.5vh);
width:100%;
}

/* ========== RVR - –õ–ï–í–ê–Ø –í–ï–†–•–ù–Ø–Ø –ü–û–ó–ò–¶–ò–Ø (–ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô LAYOUT) ========== */
.rvr-row{
grid-column: 1;
grid-row: 1;
display:grid;
grid-template-columns: 1fr auto 1fr; /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ï–¥–∏–Ω–∏—Ü—ã */
align-items:center;
gap:min(4px,.4vw);
}

.rvr-row .section-label{
color:#666;
font-size:clamp(12px,1.2vw,16px);
text-align:right;
justify-self:end;
}

.rvr-row .data-field{
width:max(60px,6vw);
text-align:center;
padding:min(3px,.3vw);
background:#f8f8f8;
border-radius:3px;
justify-self:center;
}

.rvr-row .units{
color:#666;
font-size:clamp(12px,1.2vw,16px);
text-align:left;
justify-self:start;
}

/* ========== ELEVATION - –õ–ï–í–ê–Ø –ù–ò–ñ–ù–Ø–Ø –ü–û–ó–ò–¶–ò–Ø (–ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–´–ô LAYOUT) ========== */
.elev-row{
grid-column: 1;
grid-row: 2;
display:grid;
grid-template-columns: 1fr auto 1fr; /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ï–¥–∏–Ω–∏—Ü—ã */
align-items:center;
gap:min(4px,.4vw);
}

.elev-row .section-label{
color:#666;
font-size:clamp(12px,1.2vw,16px);
text-align:right;
justify-self:end;
}

.elev-row .data-field{
width:max(60px,6vw);
text-align:center;
padding:min(3px,.3vw);
background:#f8f8f8;
border-radius:3px;
justify-self:center;
}

.elev-row .units{
color:#666;
font-size:clamp(12px,1.2vw,16px);
text-align:left;
justify-self:start;
}

/* ========== QFE - –ü–†–ê–í–ê–Ø –ö–û–õ–û–ù–ö–ê (–í–ï–†–¢–ò–ö–ê–õ–¨–ù–´–ô LAYOUT –ö–ê–ö QNH) ========== */
.qfe-row{
grid-column: 2;
grid-row: 1 / span 2; /* –ó–∞–Ω–∏–º–∞–µ—Ç –æ–±–µ —Å—Ç—Ä–æ–∫–∏ */
display:flex;
flex-direction:column;
align-items:center;
gap:2px;
justify-content:center;
}

.qfe-row .section-label{
color:#666;
font-size:clamp(12px,1.2vw,16px);
text-align:center;
margin-bottom:3px;
}

/* QFE –ø–æ–ª—è –¥–∞–Ω–Ω—ã—Ö - –∫–∞–∫ —É QNH (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π layout –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—è) */
.qfe-row .qfe-field{
display:grid;
grid-template-columns: 1fr auto 1fr; /* –ü—É—Å—Ç–æ–µ | –ó–Ω–∞—á–µ–Ω–∏–µ | –ï–¥–∏–Ω–∏—Ü—ã */
align-items:center;
gap:min(4px,.4vw);
margin-bottom:3px;
width:100%;
}

.qfe-row .qfe-field .data-field{
width:max(65px,6.5vw);
text-align:center;
padding:min(2px,.2vw);
background:#f8f8f8;
border-radius:3px;
justify-self:center;
}

.qfe-row .qfe-field .units{
color:#666;
font-size:clamp(10px,1.0vw,13px);
text-align:left;
justify-self:start;
}

.qfe-row .qfe-field .data-value{
font-size:clamp(11px,1.1vw,14px);
font-weight:normal;
}

.qfe-row .qfe-field.secondary .data-value{
font-weight:normal;
}

/* –î–ê–ù–ù–´–ï –í –ü–û–õ–Ø–• */
.rvr-row .data-field .data-value,
.elev-row .data-field .data-value{
font-size:clamp(12px,1.2vw,16px);
font-weight:bold;
}

/* –¢–ï–ú–ù–ê–Ø –¢–ï–ú–ê */
.dark .rvr-row .section-label,
.dark .elev-row .section-label,
.dark .qfe-row .section-label,
.dark .rvr-row .units,
.dark .elev-row .units,
.dark .qfe-row .qfe-field .units{
color:#ccc;
}

.dark .rvr-row .data-field,
.dark .elev-row .data-field,
.dark .qfe-row .qfe-field .data-field{
background:#333;
}

/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤–µ—Ç—Ä–∞ */
.lateral-component{position:absolute;top:-30px;left:-45px;font-size:clamp(10px,1vw,12px);background:#f8f8f8;padding:2px 6px;border-radius:3px;z-index:5;width:max(50px,5vw);text-align:center}
.lateral-component .data-label{position:absolute;top:100%;left:50%;transform:translateX(-50%);margin-top:2px;background:transparent;font-size:clamp(8px,0.8vw,10px)}
.headwind-component{position:absolute;top:-30px;right:-45px;font-size:clamp(10px,1vw,12px);background:#f8f8f8;padding:2px 6px;border-radius:3px;z-index:5;width:max(50px,5vw);text-align:center}
.headwind-component .data-label{position:absolute;top:100%;left:50%;transform:translateX(-50%);margin-top:2px;background:transparent;font-size:clamp(8px,0.8vw,10px)}
.friction-coefficient{position:absolute;bottom:-30px;right:-45px;font-size:clamp(10px,1vw,12px);background:#f8f8f8;padding:2px 6px;border-radius:3px;z-index:5;width:max(50px,5vw);text-align:center}
.friction-coefficient .data-label{position:absolute;bottom:100%;left:50%;transform:translateX(-50%);margin-bottom:2px;background:transparent;font-size:clamp(8px,0.8vw,10px)}
.dark .lateral-component,.dark .headwind-component,.dark .friction-coefficient{background:#333;color:#ccc}

/* –ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã */
.forecast-section{background:white;border-radius:6px;padding:min(8px,.8vw);box-shadow:0 1px 5px rgba(0,0,0,.1);height:100%;overflow:hidden;font-size:clamp(10px,1vw,12px);display:flex;flex-direction:column;justify-content:space-between}
.dark .forecast-section{background:#2a2a2a;box-shadow:0 1px 5px rgba(255,255,255,.1)}
.forecast-field{margin:2px 0;padding:0;background:transparent;border-radius:0;display:flex;align-items:center;gap:8px}
.forecast-field .forecast-label{color:#666;min-width:max(100px,10vw);text-align:right;font-size:clamp(10px,1vw,12px);font-weight:normal;margin-right:min(4px,.4vw)}
.forecast-field .forecast-value{flex:1;background:#f8f8f8;padding:3px 6px;border-radius:3px;font-size:clamp(10px,1vw,12px);word-break:break-all}
.dark .forecast-field .forecast-label{color:#ccc}
.dark .forecast-field .forecast-value{background:#333}

/* –°–µ–ª–µ–∫—Ç–æ—Ä –í–ü–ü */
.runway-selector{margin-bottom:min(10px,1vh);display:flex;justify-content:center}
.runway-selector select,.runway-display-label{text-align:center;width:clamp(140px,16vw,200px);font-size:clamp(12px,1.4vw,16px);height:clamp(28px,3vh,35px);padding:2px 6px;border:1px solid #ccc;border-radius:4px;background:white}
.runway-display-label{display:flex;align-items:center;justify-content:center;font-weight:bold;color:#333}
.dark .runway-selector select,.dark .runway-display-label{background:#333;border-color:#555;color:white}

/* –°—Ç—Ä–µ–ª–∫–∏ —Ç—Ä–µ–Ω–¥–æ–≤ */
.trend-arrow{display:inline-block;margin-left:3px;font-size:14px;color:#666}
.block-1 .trend-arrow{margin-left:5px}
.trend-up{color:#28a745}
.trend-down{color:#dc3545}
.dark .trend-arrow{color:#999}

/* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å—ã –° –í–û–ó–í–†–ê–©–ï–ù–ù–´–ú–ò –ü–†–û–ü–û–†–¶–ò–Ø–ú–ò */
@media (max-width:1400px){.main-layout{grid-template-columns:34% 32% 34%}}
@media (max-width:1200px){.main-layout{grid-template-columns:32% 36% 32%}}
@media (max-width:900px){.main-layout{grid-template-columns:30% 40% 30%;gap:min(6px,1vh)}.container{padding:min(6px,1vw)}.block{padding:min(8px,1.2vw)}.compass-container{width:75%;margin-bottom:10px}}
@media (max-width:600px){.main-layout{grid-template-columns:28% 44% 28%;gap:min(4px,.6vh)}.block{padding:min(6px,1vw)}.compass-container{width:70%;margin-bottom:8px}}
</style>

<!-- ========== –ö–û–ù–ï–¶ –ß–ê–°–¢–ò 2 ========== --><!-- ========== –ß–ê–°–¢–¨ 3: –ü–û–õ–ù–´–ô OURAIRPORTS API –° –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ú QFE ========== -->

<script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentMetarData = null;
let currentRunwayData = null;
let updateInterval = null;
let globalAPI = null;

// OurAirports API –¥–ª—è —Ä–∞–±–æ—Ç—ã –¢–û–õ–¨–ö–û —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ CSV —Ñ–∞–π–ª–∞–º–∏ - –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô QFE
class OurAirportsAPI {
  constructor() {
    this.airports = new Map();
    this.loaded = false;
    this.loadingPromise = null;
  }

  async loadDatabase() {
    if (this.loaded) return true;

    if (this.loadingPromise) return this.loadingPromise;

    console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ CSV —Ñ–∞–π–ª—ã...');
    this.showCSVLoading(true);
    updateConnectionStatus('loading', 'Loading local CSV files...');

    this.loadingPromise = this._loadLocalCSVFiles();
    return this.loadingPromise;
  }

  async _loadLocalCSVFiles() {
    try {
      console.log('üì• Loading local airports.csv and runways.csv...');

      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¢–û–õ–¨–ö–û –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
      const [airportsResponse, runwaysResponse] = await Promise.all([
        fetch('./airports.csv'),
        fetch('./runways.csv')
      ]);

      if (!airportsResponse.ok) {
        throw new Error(`Cannot load airports.csv: ${airportsResponse.status} ${airportsResponse.statusText}`);
      }

      if (!runwaysResponse.ok) {
        throw new Error(`Cannot load runways.csv: ${runwaysResponse.status} ${runwaysResponse.statusText}`);
      }

      const airportsData = await airportsResponse.text();
      const runwaysData = await runwaysResponse.text();

      console.log(`‚úÖ Loaded local CSV files successfully`);
      console.log(`üìä File sizes: airports=${Math.round(airportsData.length/1024)}KB, runways=${Math.round(runwaysData.length/1024)}KB`);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Ñ–∞–π–ª—ã –Ω–µ –ø—É—Å—Ç—ã–µ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∏
      if (airportsData.length < 100) {
        throw new Error('airports.csv appears to be empty or too small');
      }
      if (runwaysData.length < 100) {
        throw new Error('runways.csv appears to be empty or too small');
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ CSV
      const airportsFirstLine = airportsData.split('\n')[0];
      const runwaysFirstLine = runwaysData.split('\n')[0];

      if (!airportsFirstLine.includes('ident') || !airportsFirstLine.includes('name')) {
        throw new Error('airports.csv does not appear to have correct format');
      }
      if (!runwaysFirstLine.includes('airport_ident') || !runwaysFirstLine.includes('le_ident')) {
        throw new Error('runways.csv does not appear to have correct format');
      }

      console.log('‚úÖ CSV files validation passed');

      // –ü–∞—Ä—Å–∏–º CSV –¥–∞–Ω–Ω—ã–µ
      await this._parseCSVData(airportsData, runwaysData);

      this.loaded = true;
      this.showCSVLoading(false);

      const stats = {
        airports: this.airports.size,
        totalRunways: Array.from(this.airports.values()).reduce((sum, airport) => sum + airport.runways.length, 0)
      };

      console.log(`‚úÖ Processed ${stats.airports} airports with ${stats.totalRunways} runways from local CSV files`);
      updateConnectionStatus('connected', `${stats.airports} airports loaded from CSV`);

      return true;

    } catch (error) {
      console.error('‚ùå Failed to load local CSV files:', error);
      console.error('üí° Make sure:');
      console.error('   1. airports.csv and runways.csv are in the same folder as index.html');
      console.error('   2. You are accessing via HTTP server (http://localhost) not file:// protocol');
      console.error('   3. Files are downloaded from https://ourairports.com/data/');

      this.showCSVLoading(false);
      updateConnectionStatus('error', 'CSV files required - cannot load airport data');

      console.log('‚ùå CSV files are required for operation');
      throw new Error('CSV files are required - place airports.csv and runways.csv in the same folder');
    }
  }

  async _parseCSVData(airportsCSV, runwaysCSV) {
    console.log('üìä Parsing CSV data...');

    // –ü—Ä–æ—Å—Ç–æ–π CSV –ø–∞—Ä—Å–µ—Ä
    const parseCSV = (text) => {
      const lines = text.split('\n');
      const headers = this._parseCSVLine(lines[0]);
      const data = [];

      for (let i = 1; i < lines.length; i++) {
        const line = lines[i].trim();
        if (!line) continue;

        const values = this._parseCSVLine(line);
        if (values.length >= headers.length) {
          const row = {};
          headers.forEach((header, index) => {
            row[header] = values[index] || '';
          });
          data.push(row);
        }
      }
      return data;
    };

    // –ü–∞—Ä—Å–∏–º –∞—ç—Ä–æ–ø–æ—Ä—Ç—ã
    console.log('  üìÑ Parsing airports...');
    const airportsData = parseCSV(airportsCSV);
    let airportCount = 0;

    for (const row of airportsData) {
      const icao = row.ident;

      // –¢–æ–ª—å–∫–æ ICAO –∫–æ–¥—ã (4 —Å–∏–º–≤–æ–ª–∞)
      if (!icao || icao.length !== 4 || !icao.match(/^[A-Z0-9]{4}$/)) continue;

      // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–∞–∫—Ä—ã—Ç—ã–µ –∞—ç—Ä–æ–ø–æ—Ä—Ç—ã
      if (row.type === 'closed') continue;

      try {
        // –†–ê–°–®–ò–†–ï–ù–ù–´–ï –î–ê–ù–ù–´–ï –ê–≠–†–û–ü–û–†–¢–ê –° –†–ï–ì–ò–û–ù–ê–ú–ò
        this.airports.set(icao, {
          icao: icao,
          name: row.name || 'Unknown Airport',
          type: row.type || 'unknown',
          elevation_ft: parseFloat(row.elevation_ft) || 0,
          latitude: parseFloat(row.latitude_deg) || 0,
          longitude: parseFloat(row.longitude_deg) || 0,

          // –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –î–õ–Ø –ß–ê–°–û–í–´–• –ü–û–Ø–°–û–í
          country: row.iso_country || '',
          iso_country: row.iso_country || '',
          iso_region: row.iso_region || '',
          municipality: row.municipality || '',
          continent: row.continent || '',

          // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è
          iata: row.iata_code || null,
          local_code: row.local_code || null,
          gps_code: row.gps_code || null,
          home_link: row.home_link || null,
          wikipedia_link: row.wikipedia_link || null,
          keywords: row.keywords || '',

          runways: []
        });
        airportCount++;

        // –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 10000 –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤
        if (airportCount % 10000 === 0) {
          console.log(`    Processed ${airportCount} airports...`);
        }
      } catch (error) {
        continue;
      }
    }

    console.log(`    ‚úÖ Processed ${airportCount} airports with regional data`);

    // –ü–∞—Ä—Å–∏–º –í–ü–ü
    console.log('  üõ¨ Parsing runways...');
    const runwaysData = parseCSV(runwaysCSV);
    let runwayCount = 0;

    for (const row of runwaysData) {
      const icao = row.airport_ident;

      if (!this.airports.has(icao)) continue;
      if (row.closed === '1') continue;

      try {
        const runway = {
          le_ident: row.le_ident || '',
          he_ident: row.he_ident || '',
          le_elevation_ft: parseFloat(row.le_elevation_ft) || 0,
          he_elevation_ft: parseFloat(row.he_elevation_ft) || 0,
          le_heading_deg: parseFloat(row.le_heading_degT) || 0,
          he_heading_deg: parseFloat(row.he_heading_degT) || 180,
          length_ft: parseFloat(row.length_ft) || 0,
          width_ft: parseFloat(row.width_ft) || 0,
          surface: row.surface || 'ASP'
        };

        this.airports.get(icao).runways.push(runway);
        runwayCount++;

        // –ü—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 5000 –í–ü–ü
        if (runwayCount % 5000 === 0) {
          console.log(`    Processed ${runwayCount} runways...`);
        }
      } catch (error) {
        continue;
      }
    }

    console.log(`    ‚úÖ Processed ${runwayCount} runways`);

    // –£–¥–∞–ª—è–µ–º –∞—ç—Ä–æ–ø–æ—Ä—Ç—ã –±–µ–∑ –í–ü–ü
    const airportsWithRunways = new Map();
    for (const [icao, airport] of this.airports) {
      if (airport.runways && airport.runways.length > 0) {
        airportsWithRunways.set(icao, airport);
      }
    }
    this.airports = airportsWithRunways;

    console.log(`üìä Final: ${this.airports.size} airports with runways and regional data`);
  }

  _parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;

    for (let i = 0; i < line.length; i++) {
      const char = line[i];

      if (char === '"') {
        inQuotes = !inQuotes;
      } else if (char === ',' && !inQuotes) {
        result.push(current.trim());
        current = '';
      } else {
        current += char;
      }
    }

    result.push(current.trim());
    return result.map(val => val.replace(/^"|"$/g, ''));
  }

  showCSVLoading(show) {
    const loader = document.getElementById('csvLoading');
    if (loader) {
      loader.className = show ? 'csv-loading show' : 'csv-loading';
    }
  }

  async getRunwayData(icao) {
    await this.loadDatabase();

    const airport = this.airports.get(icao.toUpperCase());
    if (!airport || !airport.runways || airport.runways.length === 0) {
      throw new Error(`No runway data for ${icao}`);
    }

    console.log(`‚úÖ Found ${airport.runways.length} runways for ${icao} (${airport.name}) in ${airport.iso_region || airport.country}`);

    // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –Ω—É–∂–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
    return airport.runways.map(runway => ({
      leIdent: runway.le_ident,
      heIdent: runway.he_ident,
      leElevation: runway.le_elevation_ft * 0.3048, // —Ñ—É—Ç—ã –≤ –º–µ—Ç—Ä—ã
      heElevation: runway.he_elevation_ft * 0.3048,
      leHeading: runway.le_heading_deg,
      heHeading: runway.he_heading_deg,
      length: runway.length_ft * 0.3048,
      width: runway.width_ft * 0.3048,
      surface: runway.surface
    }));
  }

  getRunwayElevation(runwayData, selectedRunway) {
    for (const runway of runwayData) {
      if (runway.leIdent === selectedRunway) return runway.leElevation;
      if (runway.heIdent === selectedRunway) return runway.heElevation;
    }
    return null;
  }

  // ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –†–ê–°–ß–ï–¢ QFE ==========
  calculateQFE(qnhHpa, elevationMeters) {
    if (!qnhHpa || elevationMeters === null) return null;

    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–û–†–ú–£–õ–ê: QFE = QNH - (–≤—ã—Å–æ—Ç–∞_–≤_–º–µ—Ç—Ä–∞—Ö / 8.5)
    // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞ –ò–ö–ê–û: –Ω–∞ –∫–∞–∂–¥—ã–µ 8.5 –º–µ—Ç—Ä–æ–≤ –≤—ã—Å–æ—Ç—ã –¥–∞–≤–ª–µ–Ω–∏–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ 1 –≥–ü–∞
    const qfe = qnhHpa - (elevationMeters / 8.5);

    console.log(`üîß QFE calculation FIXED: QNH ${qnhHpa} hPa - elevation ${elevationMeters}m / 8.5 = ${Math.round(qfe)} hPa`);

    return Math.round(qfe);
  }

  // –ù–û–í–´–ô –ú–ï–¢–û–î –î–õ–Ø –ü–û–õ–£–ß–ï–ù–ò–Ø –î–ê–ù–ù–´–• –ê–≠–†–û–ü–û–†–¢–ê –° –†–ï–ì–ò–û–ù–ê–õ–¨–ù–û–ô –ò–ù–§–û–†–ú–ê–¶–ò–ï–ô
  getAirportInfo(icao) {
    const airport = this.airports.get(icao.toUpperCase());
    if (!airport) return null;

    return {
      icao: airport.icao,
      name: airport.name,
      latitude: airport.latitude,
      longitude: airport.longitude,
      country: airport.country,
      iso_region: airport.iso_region,
      municipality: airport.municipality,
      continent: airport.continent,
      elevation_ft: airport.elevation_ft
    };
  }
}

// METAR –ø–∞—Ä—Å–µ—Ä (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
function parseMetar(metarString) {
  if (!metarString) return null;

  const parts = metarString.split(' ');
  const data = {
    raw: metarString,
    icao: parts[0],
    time: '',
    wind: { direction: 0, speed: 0, gust: 0, variable: false, calm: false },
    visibility: 0,
    weather: [],
    clouds: [],
    temperature: null,
    dewpoint: null,
    pressure: 0
  };

  for (let i = 0; i < parts.length; i++) {
    const part = parts[i];

    // –í—Ä–µ–º—è
    if (part.match(/^\d{6}Z$/)) {
      data.time = part;
    }

    // –í–µ—Ç–µ—Ä
    if (part.match(/^\d{3}\d{2}(G\d{2})?KT$/)) {
      data.wind.direction = parseInt(part.substring(0, 3));
      data.wind.speed = parseInt(part.substring(3, 5));
      const gustMatch = part.match(/G(\d{2})/);
      data.wind.gust = gustMatch ? parseInt(gustMatch[1]) : 0;
    }

    // –®—Ç–∏–ª—å
    if (part === '00000KT') {
      data.wind.calm = true;
    }

    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ—Ç–µ—Ä
    if (part.match(/^\d{3}V\d{3}$/)) {
      data.wind.variable = true;
    }

    // –í–∏–¥–∏–º–æ—Å—Ç—å
    if (part.match(/^\d{4}$/) && parseInt(part) > 100) {
      data.visibility = parseInt(part);
    }

    // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ —Ç–æ—á–∫–∞ —Ä–æ—Å—ã
    if (part.match(/^M?\d{2}\/M?\d{2}$/)) {
      const temps = part.split('/');
      data.temperature = parseInt(temps[0].replace('M', '-'));
      data.dewpoint = parseInt(temps[1].replace('M', '-'));
    }

    // –î–∞–≤–ª–µ–Ω–∏–µ
    if (part.match(/^Q\d{4}$/)) {
      data.pressure = parseInt(part.substring(1));
    }

    // –û–±–ª–∞—á–Ω–æ—Å—Ç—å
    if (part.match(/^(SKC|CLR|FEW|SCT|BKN|OVC)\d{3}$/)) {
      const coverage = part.substring(0, 3);
      const height = parseInt(part.substring(3)) * 100;
      data.clouds.push({ coverage, height });
    }

    // –ü–æ–≥–æ–¥–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è
    if (part.match(/^(\+|-|VC)?(MI|PR|BC|DR|BL|SH|TS|FZ)?(DZ|RA|SN|SG|IC|PL|GR|GS|UP)?(BR|FG|FU|VA|DU|SA|HZ|PY)?(PO|SQ|FC|SS)$/)) {
      data.weather.push(part);
    }
  }

  return data;
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö METAR (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
async function fetchMetarData(icao) {
  updateConnectionStatus('loading', 'Loading METAR...');

  try {
    const response = await fetch(`https://metar.vatsim.net/${icao.toUpperCase()}`);

    if (!response.ok) {
      throw new Error(`HTTP ${response.status}`);
    }

    const metarText = await response.text();

    if (!metarText || metarText.includes('No METAR available')) {
      throw new Error('No METAR data available');
    }

    const parsedData = parseMetar(metarText.trim());
    if (parsedData) {
      updateConnectionStatus('connected', 'METAR loaded');
      return parsedData;
    } else {
      throw new Error('Failed to parse METAR');
    }

  } catch (error) {
    console.error('METAR fetch error:', error);
    updateConnectionStatus('error', 'METAR error');

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏
    return generateDemoData(icao);
  }
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–µ–º–æ-–¥–∞–Ω–Ω—ã—Ö (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
function generateDemoData(icao) {
  return {
    raw: `${icao} 121853Z 19005KT 9999 FEW020 SCT080 12/08 Q1013 NOSIG=`,
    icao: icao,
    time: '121853Z',
    wind: { direction: 190, speed: 5, gust: 0, variable: false, calm: false },
    visibility: 9999,
    weather: [],
    clouds: [
      { coverage: 'FEW', height: 2000 },
      { coverage: 'SCT', height: 8000 }
    ],
    temperature: 12,
    dewpoint: 8,
    pressure: 1013
  };
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
function updateConnectionStatus(status, text) {
  const statusEl = document.getElementById('connectionStatus');
  if (!statusEl) return;

  statusEl.className = `connection-status ${status}`;
  statusEl.querySelector('span').textContent = text;
}

// –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –µ–¥–∏–Ω–∏—Ü –¥–∞–≤–ª–µ–Ω–∏—è (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
function convertPressure(hpa) {
  return {
    hpa: hpa,
    mmhg: Math.round(hpa * 0.750062 * 100) / 100,
    inhg: Math.round(hpa * 0.02953 * 100) / 100
  };
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è API —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
async function getAPI() {
  if (!globalAPI) {
    globalAPI = new OurAirportsAPI();
    await globalAPI.loadDatabase();
  }
  return globalAPI;
}
</script>

<!-- ========== –ö–û–ù–ï–¶ –ß–ê–°–¢–ò 3 ==========><!-- ========== –ó–ê–ú–ï–ù–ê –ß–ê–°–¢–ò 4A1-1: –§–£–ù–ö–¶–ò–ò –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –ß–ê–°–û–í–´–• –ü–û–Ø–°–û–í ========== -->

<script>
// ========== –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ß–ê–°–û–í–û–ì–û –ü–û–Ø–°–ê –ü–û –†–ï–ì–ò–û–ù–ê–ú –ò–ó CSV ==========

/**
 * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –ø–æ –¥–∞–Ω–Ω—ã–º —Ä–µ–≥–∏–æ–Ω–∞ –∏–∑ CSV
 */
function getTimezoneByRegion(airport) {
  if (!airport) return 0;

  const country = airport.country || airport.iso_country || '';
  const region = airport.iso_region || '';
  const municipality = (airport.municipality || '').toLowerCase();
  const longitude = airport.longitude || 0;

  console.log(`üåç Determining timezone for ${airport.icao}: country=${country}, region=${region}`);

  // ========== –†–û–°–°–ò–Ø - –ü–û –†–ï–ì–ò–û–ù–ê–ú ==========
  if (country === 'RU') {
    const regionTimezones = {
      // –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+2
      'RU-KGD': 2,

      // –ú–æ—Å–∫–æ–≤—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+3
      'RU-MOW': 3, 'RU-SPE': 3, 'RU-LEN': 3, 'RU-MOS': 3, 'RU-TUL': 3, 'RU-KLU': 3,
      'RU-BRY': 3, 'RU-SMO': 3, 'RU-TVE': 3, 'RU-YAR': 3, 'RU-VLA': 3, 'RU-IVA': 3,
      'RU-KOS': 3, 'RU-RYA': 3, 'RU-TAM': 3, 'RU-LIP': 3, 'RU-ORL': 3, 'RU-KRS': 3,
      'RU-BEL': 3, 'RU-VOR': 3, 'RU-NVG': 3, 'RU-PSK': 3, 'RU-MUR': 3, 'RU-ARK': 3,
      'RU-KRL': 3, 'RU-KDA': 3, 'RU-STA': 3, 'RU-ROS': 3, 'RU-AD': 3, 'RU-KL': 3,
      'RU-KC': 3, 'RU-KB': 3, 'RU-SE': 3, 'RU-IN': 3, 'RU-CE': 3, 'RU-DA': 3,

      // –°–∞–º–∞—Ä—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+4
      'RU-SAM': 4, 'RU-SAR': 4, 'RU-VGG': 4, 'RU-AST': 4, 'RU-ULY': 4, 'RU-PNZ': 4,
      'RU-NIZ': 4, 'RU-CHU': 4, 'RU-ME': 4, 'RU-MO': 4, 'RU-TA': 4, 'RU-KI': 4, 'RU-UD': 4,

      // –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+5
      'RU-SVE': 5, 'RU-CHE': 5, 'RU-KGN': 5, 'RU-TYU': 5, 'RU-PER': 5, 'RU-BA': 5,
      'RU-ORE': 5, 'RU-YAN': 5, 'RU-KHM': 5,

      // –û–º—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+6
      'RU-OMS': 6, 'RU-NVS': 6, 'RU-TOM': 6, 'RU-KEM': 6, 'RU-AL': 6, 'RU-ALT': 6,

      // –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+7
      'RU-KYA': 7, 'RU-KK': 7, 'RU-TY': 7,

      // –ò—Ä–∫—É—Ç—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+8
      'RU-IRK': 8, 'RU-BU': 8,

      // –Ø–∫—É—Ç—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+9
      'RU-ZAB': 9, 'RU-AMU': 9, 'RU-SA': 9,

      // –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+10
      'RU-PRI': 10, 'RU-KHA': 10, 'RU-YEV': 10,

      // –ú–∞–≥–∞–¥–∞–Ω—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+11
      'RU-MAG': 11, 'RU-SAK': 11,

      // –ö–∞–º—á–∞—Ç—Å–∫–æ–µ –≤—Ä–µ–º—è UTC+12
      'RU-KAM': 12, 'RU-CHU': 12,
    };

    const timezone = regionTimezones[region];
    if (timezone !== undefined) {
      console.log(`‚úÖ Russian timezone for ${region}: UTC+${timezone}`);
      return timezone;
    }

    // Fallback –ø–æ –¥–æ–ª–≥–æ—Ç–µ –¥–ª—è –†–æ—Å—Å–∏–∏
    if (longitude < 30) return 2;
    if (longitude < 45) return 3;
    if (longitude < 60) return 4;
    if (longitude < 75) return 5;
    if (longitude < 105) return 6;
    if (longitude < 120) return 7;
    if (longitude < 135) return 8;
    if (longitude < 150) return 9;
    if (longitude < 165) return 10;
    if (longitude < 175) return 11;
    return 12;
  }

  // ========== –°–®–ê - –ü–û –®–¢–ê–¢–ê–ú ==========
  if (country === 'US') {
    const now = new Date();
    const isDST = isDaylightSavingTimeUS(now);

    const stateTimezones = {
      // Eastern Time
      'US-ME': isDST ? -4 : -5, 'US-NH': isDST ? -4 : -5, 'US-VT': isDST ? -4 : -5,
      'US-MA': isDST ? -4 : -5, 'US-RI': isDST ? -4 : -5, 'US-CT': isDST ? -4 : -5,
      'US-NY': isDST ? -4 : -5, 'US-NJ': isDST ? -4 : -5, 'US-PA': isDST ? -4 : -5,
      'US-DE': isDST ? -4 : -5, 'US-MD': isDST ? -4 : -5, 'US-DC': isDST ? -4 : -5,
      'US-VA': isDST ? -4 : -5, 'US-WV': isDST ? -4 : -5, 'US-NC': isDST ? -4 : -5,
      'US-SC': isDST ? -4 : -5, 'US-GA': isDST ? -4 : -5, 'US-FL': isDST ? -4 : -5,
      'US-OH': isDST ? -4 : -5, 'US-KY': isDST ? -4 : -5, 'US-TN': isDST ? -4 : -5,
      'US-MI': isDST ? -4 : -5,

      // Central Time
      'US-WI': isDST ? -5 : -6, 'US-IL': isDST ? -5 : -6, 'US-IN': isDST ? -5 : -6,
      'US-MN': isDST ? -5 : -6, 'US-IA': isDST ? -5 : -6, 'US-MO': isDST ? -5 : -6,
      'US-AR': isDST ? -5 : -6, 'US-LA': isDST ? -5 : -6, 'US-MS': isDST ? -5 : -6,
      'US-AL': isDST ? -5 : -6, 'US-ND': isDST ? -5 : -6, 'US-SD': isDST ? -5 : -6,
      'US-NE': isDST ? -5 : -6, 'US-KS': isDST ? -5 : -6, 'US-OK': isDST ? -5 : -6,
      'US-TX': isDST ? -5 : -6,

      // Mountain Time
      'US-MT': isDST ? -6 : -7, 'US-WY': isDST ? -6 : -7, 'US-CO': isDST ? -6 : -7,
      'US-NM': isDST ? -6 : -7, 'US-UT': isDST ? -6 : -7, 'US-ID': isDST ? -6 : -7,
      'US-AZ': -7, 'US-NV': isDST ? -7 : -8,

      // Pacific Time
      'US-WA': isDST ? -7 : -8, 'US-OR': isDST ? -7 : -8, 'US-CA': isDST ? -7 : -8,

      // Alaska –∏ Hawaii
      'US-AK': isDST ? -8 : -9, 'US-HI': -10,
    };

    const timezone = stateTimezones[region];
    if (timezone !== undefined) {
      console.log(`‚úÖ US timezone for ${region}: UTC${timezone >= 0 ? '+' : ''}${timezone} (DST: ${isDST})`);
      return timezone;
    }

    // Fallback –ø–æ –¥–æ–ª–≥–æ—Ç–µ –¥–ª—è –°–®–ê
    if (longitude > -75) return isDST ? -4 : -5;
    if (longitude > -90) return isDST ? -5 : -6;
    if (longitude > -105) return isDST ? -6 : -7;
    if (longitude > -120) return isDST ? -7 : -8;
    return isDST ? -8 : -9;
  }

  // ========== –ï–í–†–û–ü–ê - –ü–û –°–¢–†–ê–ù–ê–ú ==========
  const europeanCountries = {
    'GB': 0, 'IE': 0, 'PT': 0, 'IS': 0,
    'FR': 1, 'ES': 1, 'DE': 1, 'IT': 1, 'AT': 1, 'CH': 1, 'NL': 1, 'BE': 1,
    'LU': 1, 'DK': 1, 'NO': 1, 'SE': 1, 'PL': 1, 'CZ': 1, 'SK': 1, 'HU': 1,
    'SI': 1, 'HR': 1, 'BA': 1, 'RS': 1, 'ME': 1, 'MK': 1, 'AL': 1,
    'FI': 2, 'EE': 2, 'LV': 2, 'LT': 2, 'UA': 2, 'MD': 2, 'RO': 2, 'BG': 2,
    'GR': 2, 'CY': 2, 'BY': 3, 'TR': 3
  };

  if (europeanCountries.hasOwnProperty(country)) {
    let baseOffset = europeanCountries[country];

    const noDSTCountries = ['IS', 'BY', 'TR'];
    if (!noDSTCountries.includes(country)) {
      const now = new Date();
      const isDST = isDaylightSavingTimeEU(now);
      if (isDST) baseOffset += 1;

      console.log(`‚úÖ European timezone for ${country}: UTC+${baseOffset} (DST: ${isDST})`);
    } else {
      console.log(`‚úÖ European timezone for ${country}: UTC+${baseOffset} (no DST)`);
    }

    return baseOffset;
  }

  // ========== –î–†–£–ì–ò–ï –°–¢–†–ê–ù–´ ==========
  const otherCountries = {
    'KZ': 6, 'KG': 6, 'TJ': 5, 'TM': 5, 'UZ': 5, 'AZ': 4, 'AM': 4, 'GE': 4,
    'CN': 8, 'JP': 9, 'KR': 9, 'IN': 5.5, 'AU': 10, 'NZ': 12, 'BR': -3,
    'AR': -3, 'MX': -6, 'EG': 2, 'ZA': 2, 'SA': 3, 'AE': 4, 'TH': 7, 'SG': 8
  };

  if (otherCountries.hasOwnProperty(country)) {
    let timezone = otherCountries[country];

    if (country === 'AU') {
      const isDST = isDaylightSavingTimeAU(new Date());
      if (isDST) timezone += 1;
    } else if (country === 'NZ') {
      const isDST = isDaylightSavingTimeNZ(new Date());
      if (isDST) timezone += 1;
    }

    console.log(`‚úÖ Timezone for ${country}: UTC${timezone >= 0 ? '+' : ''}${timezone}`);
    return timezone;
  }

  // ========== FALLBACK - –ü–û –î–û–õ–ì–û–¢–ï ==========
  console.log(`‚ö†Ô∏è Unknown country: ${country}, using longitude-based calculation`);
  let offset = Math.round(longitude / 15);
  return Math.max(-12, Math.min(14, offset));
}

/**
 * –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞ –∞—ç—Ä–æ–ø–æ—Ä—Ç–∞ –∏–∑ CSV –¥–∞–Ω–Ω—ã—Ö
 */
function getAirportTimezoneFromCSV(icao) {
  if (!globalAPI || !globalAPI.airports) {
    console.warn('‚ö†Ô∏è Airport database not loaded');
    return 0;
  }

  const airport = globalAPI.airports.get(icao.toUpperCase());

  if (!airport) {
    console.warn(`‚ö†Ô∏è Airport ${icao} not found`);
    return 0;
  }

  const timezone = getTimezoneByRegion(airport);
  console.log(`üïê Final timezone for ${icao}: UTC${timezone >= 0 ? '+' : ''}${timezone}`);

  return timezone;
}

// ========== –§–£–ù–ö–¶–ò–ò DST ==========

function isDaylightSavingTimeUS(date) {
  const year = date.getFullYear();
  const month = date.getMonth();
  const day = date.getDate();

  if (month < 2 || month > 10) return false;
  if (month > 2 && month < 10) return true;

  if (month === 2) {
    const secondSunday = getSecondSunday(year, 3);
    return day >= secondSunday;
  }

  if (month === 10) {
    const firstSunday = getFirstSunday(year, 11);
    return day < firstSunday;
  }

  return false;
}

function isDaylightSavingTimeEU(date) {
  const year = date.getFullYear();
  const month = date.getMonth();
  const day = date.getDate();

  if (month < 2 || month > 9) return false;
  if (month > 2 && month < 9) return true;

  if (month === 2) {
    const lastSunday = getLastSunday(year, 3);
    return day >= lastSunday;
  }

  if (month === 9) {
    const lastSunday = getLastSunday(year, 10);
    return day < lastSunday;
  }

  return false;
}

function isDaylightSavingTimeAU(date) {
  const year = date.getFullYear();
  const month = date.getMonth();
  const day = date.getDate();

  if (month >= 4 && month <= 8) return false;
  if (month >= 10 || month <= 2) return true;

  if (month === 9) {
    const firstSunday = getFirstSunday(year, 10);
    return day >= firstSunday;
  }

  if (month === 3) {
    const firstSunday = getFirstSunday(year, 4);
    return day < firstSunday;
  }

  return false;
}

function isDaylightSavingTimeNZ(date) {
  const year = date.getFullYear();
  const month = date.getMonth();
  const day = date.getDate();

  if (month >= 1 && month <= 8) return false;
  if (month >= 10) return true;

  if (month === 9) {
    const firstSunday = getFirstSunday(year, 10);
    return day >= firstSunday;
  }

  if (month === 0) {
    const thirdSunday = getThirdSunday(year, 1);
    return day < thirdSunday;
  }

  return false;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –¥–∞—Ç
function getSecondSunday(year, month) {
  const firstDay = new Date(year, month - 1, 1);
  const firstSunday = 7 - firstDay.getDay() + 1;
  return firstSunday > 7 ? firstSunday - 7 + 7 : firstSunday + 7;
}

function getFirstSunday(year, month) {
  const firstDay = new Date(year, month - 1, 1);
  return 7 - firstDay.getDay() + 1;
}

function getLastSunday(year, month) {
  const lastDay = new Date(year, month, 0);
  const lastDate = lastDay.getDate();
  const lastDayOfWeek = lastDay.getDay();
  return lastDate - lastDayOfWeek;
}

function getThirdSunday(year, month) {
  const firstDay = new Date(year, month - 1, 1);
  const firstSunday = 7 - firstDay.getDay() + 1;
  return (firstSunday > 7 ? firstSunday - 7 : firstSunday) + 14;
}

// –¢–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
window.testAirportTimezone = function(icao = 'UUEE') {
  console.log(`üß™ Testing regional timezone for ${icao}...`);

  if (!globalAPI || !globalAPI.loaded) {
    console.error('‚ùå Database not loaded');
    return 'Database not loaded';
  }

  const airport = globalAPI.getAirportInfo(icao);
  if (!airport) {
    console.error(`‚ùå Airport ${icao} not found`);
    return 'Airport not found';
  }

  console.log(`üìä Airport: ${airport.name}`);
  console.log(`   üåç Country: ${airport.country}`);
  console.log(`   üìç Region: ${airport.iso_region}`);
  console.log(`   üèôÔ∏è City: ${airport.municipality}`);

  const timezone = getTimezoneByRegion(airport);
  console.log(`   ‚è∞ Timezone: UTC${timezone >= 0 ? '+' : ''}${timezone}`);

  return { airport, timezone };
};
</script>

<!-- ========== –ö–û–ù–ï–¶ –ß–ê–°–¢–ò 4A1-1 ========== --> <!-- ========== –ó–ê–ú–ï–ù–ê –ß–ê–°–¢–ò 4A1-2: –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –í–†–ï–ú–ï–ù–ò –ò –í–û–°–•–û–î–ê/–ó–ê–•–û–î–ê ========== -->

<script>
// ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï –§–£–ù–ö–¶–ò–ò –í–û–°–•–û–î–ê/–ó–ê–•–û–î–ê –ò –í–†–ï–ú–ï–ù–ò ==========

/**
 * –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∞—ç—Ä–æ–¥—Ä–æ–º–∞
 */
async function updateSunriseSunset() {
  const currentIcao = document.getElementById('icaoInput').value;

  if (!currentIcao || currentIcao.length !== 4) {
    // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ ICAO –Ω–µ –≤–≤–µ–¥–µ–Ω
    document.getElementById('sunrise').textContent = '-';
    document.getElementById('sunset').textContent = '-';
    window.airportData = null;
    console.log('üîÑ Cleared airport data - no ICAO entered');
    return;
  }

  try {
    const api = await getAPI();
    const airport = api.getAirportInfo(currentIcao);

    if (airport && airport.latitude && airport.longitude) {
      console.log(`üåÖ Loading data for ${currentIcao}:`);
      console.log(`   üìç Location: ${airport.latitude}, ${airport.longitude}`);

      // –í—ã—á–∏—Å–ª—è–µ–º –≤–æ—Å—Ö–æ–¥/–∑–∞—Ö–æ–¥ —Å–æ–ª–Ω—Ü–∞
      const sunTimes = calculateSunriseSunset(airport.latitude, airport.longitude);

      // –ü–æ–ª—É—á–∞–µ–º —á–∞—Å–æ–≤–æ–π –ø–æ—è—Å –∏–∑ —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
      const timezoneOffset = getAirportTimezoneFromCSV(currentIcao);

      console.log(`‚è∞ Timezone from region: UTC${timezoneOffset >= 0 ? '+' : ''}${timezoneOffset}`);

      // –°–û–•–†–ê–ù–Ø–ï–ú –î–ê–ù–ù–´–ï –ê–≠–†–û–ü–û–†–¢–ê
      window.airportData = {
        icao: currentIcao,
        latitude: airport.latitude,
        longitude: airport.longitude,
        name: airport.name,
        country: airport.country,
        iso_region: airport.iso_region,
        municipality: airport.municipality,
        sunriseUTC: sunTimes.sunrise,
        sunsetUTC: sunTimes.sunset,
        timezoneOffset: timezoneOffset,
        sunType: sunTimes.type || 'normal'
      };

      console.log('‚úÖ Airport data saved:', window.airportData);

      // –°–†–ê–ó–£ –û–ë–ù–û–í–õ–Ø–ï–ú –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï
      updateTimeDisplay();

    } else {
      throw new Error(`Airport coordinates not found for ${currentIcao}`);
    }
  } catch (error) {
    console.error('‚ùå Error loading airport data:', error);
    document.getElementById('sunrise').textContent = '-';
    document.getElementById('sunset').textContent = '-';
    window.airportData = null;
  }
}

/**
 * –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
 */
function updateTimeDisplay() {
  const timeLabel = document.getElementById('timeLabel');
  const timeElement = document.getElementById('currentTime');
  const sunriseElement = document.getElementById('sunrise');
  const sunsetElement = document.getElementById('sunset');
  const now = new Date();

  const isLocalMode = timeLabel && !timeLabel.textContent.includes('UTC');

  if (isLocalMode && window.airportData) {
    // –ú–ï–°–¢–ù–û–ï –í–†–ï–ú–Ø –ê–≠–†–û–ü–û–†–¢–ê
    const offset = window.airportData.timezoneOffset;
    const localTime = new Date(now.getTime() + (offset * 3600000));
    const hours = localTime.getUTCHours().toString().padStart(2, '0');
    const minutes = localTime.getUTCMinutes().toString().padStart(2, '0');
    timeElement.textContent = `${hours}:${minutes}`;

    // –ú–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è –≤–æ—Å—Ö–æ–¥–∞/–∑–∞—Ö–æ–¥–∞
    if (window.airportData.sunriseUTC && window.airportData.sunriseUTC !== '-') {
      const localSunrise = convertUTCToLocal(window.airportData.sunriseUTC, offset);
      sunriseElement.textContent = localSunrise;
    }

    if (window.airportData.sunsetUTC && window.airportData.sunsetUTC !== '-') {
      const localSunset = convertUTCToLocal(window.airportData.sunsetUTC, offset);
      sunsetElement.textContent = localSunset;
    }

    console.log(`‚úÖ LOCAL mode: ${hours}:${minutes} (${window.airportData.icao})`);

  } else if (isLocalMode && !window.airportData) {
    // –°–ò–°–¢–ï–ú–ù–û–ï –ú–ï–°–¢–ù–û–ï –í–†–ï–ú–Ø
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    timeElement.textContent = `${hours}:${minutes}`;

    console.log(`‚úÖ LOCAL mode: system time ${hours}:${minutes}`);

  } else {
    // UTC –í–†–ï–ú–Ø
    const hours = now.getUTCHours().toString().padStart(2, '0');
    const minutes = now.getUTCMinutes().toString().padStart(2, '0');
    timeElement.textContent = `${hours}:${minutes}`;

    // UTC –≤—Ä–µ–º—è –≤–æ—Å—Ö–æ–¥–∞/–∑–∞—Ö–æ–¥–∞
    if (window.airportData) {
      sunriseElement.textContent = window.airportData.sunriseUTC || '-';
      sunsetElement.textContent = window.airportData.sunsetUTC || '-';
    }

    console.log(`‚úÖ UTC mode: ${hours}:${minutes}`);
  }
}

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è UTC –≤—Ä–µ–º–µ–Ω–∏ –≤ –º–µ—Å—Ç–Ω–æ–µ –≤—Ä–µ–º—è
 */
function convertUTCToLocal(utcTime, timezoneOffset) {
  if (!utcTime || utcTime === '-' || utcTime === '--:--') return utcTime;

  const [hours, minutes] = utcTime.split(':').map(Number);
  const utcDate = new Date();
  utcDate.setUTCHours(hours, minutes, 0, 0);
  const localDate = new Date(utcDate.getTime() + (timezoneOffset * 3600000));
  const localHours = localDate.getUTCHours().toString().padStart(2, '0');
  const localMinutes = localDate.getUTCMinutes().toString().padStart(2, '0');

  return `${localHours}:${localMinutes}`;
}

/**
 * –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É UTC –∏ –º–µ—Å—Ç–Ω—ã–º –≤—Ä–µ–º–µ–Ω–µ–º
 */
function toggleTimeDisplay() {
  const timeLabel = document.getElementById('timeLabel');
  const sunriseLabel = document.getElementById('sunriseLabel');
  const sunsetLabel = document.getElementById('sunsetLabel');
  const lang = document.getElementById('language').value;

  if (!timeLabel) return;

  const isUTC = timeLabel.textContent.includes('UTC');

  if (isUTC) {
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º UTC ‚Üí Local
    if (lang === 'ru') {
      timeLabel.textContent = '–í—Ä–µ–º—è –º–µ—Å—Ç–Ω–æ–µ';
      if (sunriseLabel) sunriseLabel.textContent = '–í–æ—Å—Ö–æ–¥';
      if (sunsetLabel) sunsetLabel.textContent = '–ó–∞—Ö–æ–¥';
    } else {
      timeLabel.textContent = 'Local time';
      if (sunriseLabel) sunriseLabel.textContent = 'Sunrise';
      if (sunsetLabel) sunsetLabel.textContent = 'Sunset';
    }
    console.log('‚è∞ Switched to LOCAL time mode');
  } else {
    // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º Local ‚Üí UTC
    if (lang === 'ru') {
      timeLabel.textContent = '–í—Ä–µ–º—è UTC';
      if (sunriseLabel) sunriseLabel.textContent = '–í–æ—Å—Ö–æ–¥';
      if (sunsetLabel) sunsetLabel.textContent = '–ó–∞—Ö–æ–¥';
    } else {
      timeLabel.textContent = 'Time UTC';
      if (sunriseLabel) sunriseLabel.textContent = 'Sunrise';
      if (sunsetLabel) sunsetLabel.textContent = 'Sunset';
    }
    console.log('‚è∞ Switched to UTC time mode');
  }

  // –°–†–ê–ó–£ –û–ë–ù–û–í–õ–Ø–ï–ú –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï
  updateTimeDisplay();
}

/**
 * –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–ª–∏–∫–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
 */
function attachTimeClickHandlers() {
  const timeElement = document.getElementById('currentTime');
  const sunriseElement = document.getElementById('sunrise');
  const sunsetElement = document.getElementById('sunset');

  if (timeElement) {
    timeElement.style.cursor = 'pointer';
    timeElement.addEventListener('click', toggleTimeDisplay);
  }

  if (sunriseElement) {
    sunriseElement.style.cursor = 'pointer';
    sunriseElement.addEventListener('click', toggleTimeDisplay);
  }

  if (sunsetElement) {
    sunsetElement.style.cursor = 'pointer';
    sunsetElement.addEventListener('click', toggleTimeDisplay);
  }

  console.log('‚úÖ Time click handlers attached');
}

// ========== –¢–û–ß–ù–û–ï –í–´–ß–ò–°–õ–ï–ù–ò–ï –í–û–°–•–û–î–ê/–ó–ê–•–û–î–ê ==========

function calculateSunriseSunset(latitude, longitude, date = new Date()) {
  try {
    if (Math.abs(latitude) > 90 || Math.abs(longitude) > 180) {
      return { sunrise: '-', sunset: '-' };
    }

    if (Math.abs(latitude) > 66.5) {
      const result = calculatePolarSunriseSunsetPrecise(latitude, longitude, date);
      if (result) return result;
    }

    const year = date.getUTCFullYear();
    const month = date.getUTCMonth() + 1;
    const day = date.getUTCDate();

    const julianDay = getJulianDay(year, month, day);
    const n = julianDay - 2451545.0;
    const T = n / 36525.0;

    const L0 = (280.46646 + T * (36000.76983 + T * 0.0003032)) % 360;
    const M = (357.52911 + T * (35999.05029 - 0.0001537 * T)) % 360;
    const Mrad = M * Math.PI / 180;

    const e = 0.016708634 - T * (0.000042037 + 0.0000001267 * T);

    const C = Math.sin(Mrad) * (1.914602 - T * (0.004817 + 0.000014 * T)) +
              Math.sin(2 * Mrad) * (0.019993 - 0.000101 * T) +
              Math.sin(3 * Mrad) * 0.000289;

    const theta = L0 + C;
    const omega = 125.04 - 1934.136 * T;
    const lambda = theta - 0.00569 - 0.00478 * Math.sin(omega * Math.PI / 180);
    const lambdaRad = lambda * Math.PI / 180;

    const epsilon0 = 23 + (26 + ((21.448 - T * (46.8150 + T * (0.00059 - T * 0.001813)))) / 60) / 60;
    const epsilon = epsilon0 + 0.00256 * Math.cos(omega * Math.PI / 180);
    const epsilonRad = epsilon * Math.PI / 180;

    const delta = Math.asin(Math.sin(epsilonRad) * Math.sin(lambdaRad));

    const y = Math.tan(epsilonRad / 2) * Math.tan(epsilonRad / 2);
    const E = 4 * (y * Math.sin(2 * L0 * Math.PI / 180) - 2 * e * Math.sin(Mrad) +
                   4 * e * y * Math.sin(Mrad) * Math.cos(2 * L0 * Math.PI / 180) -
                   0.5 * y * y * Math.sin(4 * L0 * Math.PI / 180) -
                   1.25 * e * e * Math.sin(2 * Mrad)) * 180 / Math.PI;

    const latRad = latitude * Math.PI / 180;
    const h0 = -0.8333;
    const cosH = (Math.sin(h0 * Math.PI / 180) - Math.sin(latRad) * Math.sin(delta)) /
                 (Math.cos(latRad) * Math.cos(delta));

    if (cosH > 1) {
      return { sunrise: '--:--', sunset: '--:--', type: 'polar_night' };
    }
    if (cosH < -1) {
      return { sunrise: '--:--', sunset: '--:--', type: 'polar_day' };
    }

    const H = Math.acos(cosH) * 180 / Math.PI;

    const sunriseUTC = 12 - H/15 - longitude/15 - E/60;
    const sunsetUTC = 12 + H/15 - longitude/15 - E/60;

    const sunrise = normalizeTime(sunriseUTC);
    const sunset = normalizeTime(sunsetUTC);

    return { sunrise, sunset, type: 'precise' };

  } catch (error) {
    console.error('Error calculating sunrise/sunset:', error);
    return { sunrise: '-', sunset: '-', type: 'error' };
  }
}

function getJulianDay(year, month, day) {
  if (month <= 2) {
    year -= 1;
    month += 12;
  }

  const A = Math.floor(year / 100);
  const B = 2 - A + Math.floor(A / 4);

  return Math.floor(365.25 * (year + 4716)) + Math.floor(30.6001 * (month + 1)) + day + B - 1524.5;
}

function normalizeTime(timeDecimal) {
  let hours = timeDecimal;
  while (hours < 0) hours += 24;
  while (hours >= 24) hours -= 24;

  const h = Math.floor(hours);
  const m = Math.round((hours - h) * 60);

  if (m >= 60) {
    return normalizeTime(h + 1);
  }

  return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
}

function calculatePolarSunriseSunsetPrecise(latitude, longitude, date) {
  const julianDay = getJulianDay(date.getUTCFullYear(), date.getUTCMonth() + 1, date.getUTCDate());
  const n = julianDay - 2451545.0;

  const P = Math.asin(0.39795 * Math.cos(0.98563 * (n - 173) * Math.PI / 180));
  const criticalAngle = Math.PI/2 - Math.abs(latitude * Math.PI / 180);

  if (latitude > 0) {
    if (P > criticalAngle) {
      return { sunrise: '00:00', sunset: '23:59', type: 'polar_day' };
    }
    if (P < -criticalAngle) {
      return { sunrise: '--:--', sunset: '--:--', type: 'polar_night' };
    }
  } else {
    if (P < -criticalAngle) {
      return { sunrise: '00:00', sunset: '23:59', type: 'polar_day' };
    }
    if (P > criticalAngle) {
      return { sunrise: '--:--', sunset: '--:--', type: 'polar_night' };
    }
  }

  return null;
}
</script>

<!-- ========== –ö–û–ù–ï–¶ –ß–ê–°–¢–ò 4A1-2 ========== --><!-- ========== –ë–õ–û–ö 4A2 –ü–û–õ–ù–´–ô –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô: QFE –ö–ê–ö QNH ========== -->

<script>
// ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –°–ü–ò–°–ö–ê –í–ü–ü ==========
async function updateRunwayOptions(icao) {
    const select = document.getElementById('runwaySelect');

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏
    select.innerHTML = '<option value="">Loading runways...</option>';
    select.disabled = true;

    try {
        console.log(`üõ¨ Loading runway data for ${icao}...`);

        // –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π API –æ–±—ä–µ–∫—Ç
        const api = await getAPI();
        currentRunwayData = await api.getRunwayData(icao);

        if (!currentRunwayData || currentRunwayData.length === 0) {
            throw new Error(`No runways found for ${icao}`);
        }

        // –§–æ—Ä–º–∏—Ä—É–µ–º —Å–ø–∏—Å–æ–∫ –í–ü–ü
        const runwayList = [];
        currentRunwayData.forEach((runway) => {
            if (runway.leIdent && runway.leIdent !== '-' && runway.leIdent.trim() !== '') {
                runwayList.push(runway.leIdent.trim());
            }
            if (runway.heIdent && runway.heIdent !== '-' && runway.heIdent.trim() !== '') {
                runwayList.push(runway.heIdent.trim());
            }
        });

        // –£–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ–º
        const uniqueRunways = [...new Set(runwayList)].sort();

        if (uniqueRunways.length === 0) {
            throw new Error(`No valid runway identifiers found for ${icao}`);
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Å–µ–ª–µ–∫—Ç–æ—Ä —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        select.innerHTML = '';
        uniqueRunways.forEach(runway => {
            const option = new Option(runway, runway);
            select.appendChild(option);
        });

        // –í—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é –í–ü–ü –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        select.value = uniqueRunways[0];
        select.disabled = false;

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—É—é –í–ü–ü
        updateOppositeRunway();

        // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞—Å—ã –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –µ—Å—Ç—å METAR –¥–∞–Ω–Ω—ã–µ
        if (currentMetarData) {
            initializeCompass('compass');
            initializeCompass('compass2');
            updateWindComponents();
        } else {
            initializeCompassWithRunway('compass');
            initializeCompassWithRunway('compass2');
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º QFE —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–∞—Å—á–µ—Ç–æ–º
        updateQFEForSelectedRunways();

        updateConnectionStatus('connected', `${uniqueRunways.length} runways loaded`);
        console.log(`‚úÖ Successfully loaded ${uniqueRunways.length} runways for ${icao}:`, uniqueRunways);

    } catch (error) {
        console.error(`‚ùå Failed to load runway data for ${icao}:`, error);

        select.innerHTML = '<option value="">No runway data</option>';
        select.disabled = true;

        document.getElementById('runwayDisplay2').textContent = '--';
        currentRunwayData = null;

        initializeEmptyCompass('compass');
        initializeEmptyCompass('compass2');

        document.querySelectorAll('.lateral-component .data-value').forEach(el => el.textContent = '-');
        document.querySelectorAll('.headwind-component .data-value').forEach(el => el.textContent = '-');
        document.querySelectorAll('.friction-coefficient .data-value').forEach(el => el.textContent = '-');

        document.querySelectorAll('.qfe-row, .elev-row').forEach(row => row.remove());

        updateConnectionStatus('error', `No runway data for ${icao}`);
    }
}

// ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø QFE –î–õ–Ø –í–´–ë–†–ê–ù–ù–´–• –í–ü–ü ==========
async function updateQFEForSelectedRunways() {
    if (!currentMetarData || !currentRunwayData) {
        console.log('‚ö†Ô∏è Cannot update QFE: missing METAR or runway data');
        return;
    }

    try {
        const api = await getAPI();
        const selectedRunway1 = document.getElementById('runwaySelect').value;
        const selectedRunway2 = document.getElementById('runwayDisplay2').textContent;

        console.log(`üîß Updating QFE for runways: ${selectedRunway1} and ${selectedRunway2}`);

        if (selectedRunway1) {
            const elevation1 = api.getRunwayElevation(currentRunwayData, selectedRunway1);
            const qfe1 = api.calculateQFE(currentMetarData.pressure, elevation1);
            console.log(`‚úàÔ∏è Runway ${selectedRunway1}: elevation=${elevation1}m, QFE=${qfe1} hPa`);
            updateQFEDisplay('qfe1', qfe1, elevation1, 0);
        }

        if (selectedRunway2 && selectedRunway2 !== '--') {
            const elevation2 = api.getRunwayElevation(currentRunwayData, selectedRunway2);
            const qfe2 = api.calculateQFE(currentMetarData.pressure, elevation2);
            console.log(`‚úàÔ∏è Runway ${selectedRunway2}: elevation=${elevation2}m, QFE=${qfe2} hPa`);
            updateQFEDisplay('qfe2', qfe2, elevation2, 1);
        }
    } catch (error) {
        console.error('‚ùå Error updating QFE:', error);
    }
}

// ========== –ü–†–ê–í–ò–õ–¨–ù–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï QFE –¢–û–ß–ù–û –ö–ê–ö QNH ==========
function updateQFEDisplay(qfeId, qfeValue, elevation, compassIndex) {
    const compassInfo = document.querySelectorAll('.compass-info')[compassIndex];
    if (!compassInfo) {
        console.log(`‚ö†Ô∏è Cannot find compass-info for index ${compassIndex}`);
        return;
    }

    console.log(`üîß Updating QFE display exactly like QNH for compass ${compassIndex + 1}: QFE=${qfeValue}, elevation=${elevation}m`);

    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ QFE –ø–æ–ª—è —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
    const existingQFE = compassInfo.querySelectorAll('.qfe-row, .elev-row');
    existingQFE.forEach(row => row.remove());

    if (qfeValue !== null && qfeValue !== undefined && !isNaN(qfeValue)) {
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º QFE –≤ —Ä–∞–∑–Ω—ã–µ –µ–¥–∏–Ω–∏—Ü—ã
        const qfePressure = convertPressure(qfeValue);
        console.log(`üí± QFE pressure conversion:`, qfePressure);

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –°–æ–∑–¥–∞–µ–º QFE –±–ª–æ–∫ –¢–û–ß–ù–û –ö–ê–ö QNH –í –¶–ï–ù–¢–†–ï
        const qfeRow = document.createElement('div');
        qfeRow.className = 'qfe-row';

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ QFE –∫–∞–∫ QNH
        qfeRow.innerHTML = `
            <div class="qfe-label">QFE</div>
            <div class="qfe-fields">
                <div class="qfe-field primary">
                    <div class="data-field">
                        <div class="data-value">${qfePressure.hpa || '-'}</div>
                    </div>
                    <div class="units">hPa</div>
                </div>
                <div class="qfe-field secondary">
                    <div class="data-field">
                        <div class="data-value">${qfePressure.mmhg || '-'}</div>
                    </div>
                    <div class="units">mmHg</div>
                </div>
                <div class="qfe-field secondary">
                    <div class="data-field">
                        <div class="data-value">${qfePressure.inhg || '-'}</div>
                    </div>
                    <div class="units">inHg</div>
                </div>
            </div>
        `;
        compassInfo.appendChild(qfeRow);

        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—ã—Å–æ—Ç–µ ELEVATION –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π –±–ª–æ–∫ —Å–ª–µ–≤–∞ –≤–Ω–∏–∑—É
        const elevRow = document.createElement('div');
        elevRow.className = 'elev-row';
        elevRow.innerHTML = `
            <div class="section-label">ELEV</div>
            <div class="data-field">
                <div class="data-value">${elevation ? Math.round(elevation) : '-'}</div>
            </div>
            <div class="units">–º</div>
        `;
        compassInfo.appendChild(elevRow);

        console.log(`‚úÖ QFE display updated exactly like QNH for compass ${compassIndex + 1}: ${qfeValue} hPa, elevation: ${elevation}m`);
    } else {
        console.log(`‚ö†Ô∏è Invalid QFE value for compass ${compassIndex + 1}: ${qfeValue}`);
    }
}

// ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ë–ù–û–í–õ–ï–ù–ò–Ø –ü–†–û–¢–ò–í–û–ü–û–õ–û–ñ–ù–û–ô –í–ü–ü ==========
function updateOppositeRunway() {
    const sel = document.getElementById('runwaySelect').value;
    const opp = getOppositeRunway(sel);
    document.getElementById('runwayDisplay2').textContent = opp;

    console.log(`üîÑ Updated opposite runway: ${sel} ‚Üí ${opp}`);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–º–ø–∞—Å—ã
    if (currentMetarData) {
        initializeCompass('compass');
        initializeCompass('compass2');
        updateWindComponents();
    } else {
        initializeCompassWithRunway('compass');
        initializeCompassWithRunway('compass2');
    }

    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –û–±–Ω–æ–≤–ª—è–µ–º QFE –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –í–ü–ü
    updateQFEForSelectedRunways();
}

// ========== –ü–û–õ–£–ß–ï–ù–ò–ï –ü–†–û–¢–ò–í–û–ü–û–õ–û–ñ–ù–û–ô –í–ü–ü ==========
function getOppositeRunway(selectedRunway) {
    if (!currentRunwayData) return '--';

    for (const runway of currentRunwayData) {
        if (runway.leIdent === selectedRunway) {
            return runway.heIdent;
        }
        if (runway.heIdent === selectedRunway) {
            return runway.leIdent;
        }
    }
    return '--';
}

// ========== –†–ê–°–ß–ï–¢ –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –í–ï–¢–†–ê ==========
function calculateWindComponents(windDir, windSpeed, runwayHeading) {
    const windAngleRad = (windDir - runwayHeading) * Math.PI / 180;

    const headwind = Math.round(windSpeed * Math.cos(windAngleRad) * 10) / 10;
    const crosswind = Math.round(windSpeed * Math.sin(windAngleRad) * 10) / 10;

    return { headwind, crosswind };
}

// ========== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ö–û–ú–ü–û–ù–ï–ù–¢–û–í –í–ï–¢–†–ê ==========
function updateWindComponents() {
    if (!currentMetarData || !currentRunwayData) return;

    const windDir = currentMetarData.wind.calm ? 0 : currentMetarData.wind.direction;
    const windSpeed = currentMetarData.wind.calm ? 0 : currentMetarData.wind.speed;

    // –î–ª—è –ø–µ—Ä–≤–æ–≥–æ –∫–æ–º–ø–∞—Å–∞
    const selectedRunway1 = document.getElementById('runwaySelect').value;
    if (selectedRunway1) {
        const runwayHeading = getRunwayHeading(selectedRunway1);
        const components1 = calculateWindComponents(windDir, windSpeed, runwayHeading);

        const lateral1 = document.querySelector('#compass').parentElement.querySelector('.lateral-component .data-value');
        const headwind1 = document.querySelector('#compass').parentElement.querySelector('.headwind-component .data-value');

        if (lateral1) lateral1.textContent = components1.crosswind > 0 ? `+${components1.crosswind.toFixed(1)}` : components1.crosswind.toFixed(1);
        if (headwind1) headwind1.textContent = components1.headwind > 0 ? `+${components1.headwind.toFixed(1)}` : components1.headwind.toFixed(1);
    }

    // –î–ª—è –≤—Ç–æ—Ä–æ–≥–æ –∫–æ–º–ø–∞—Å–∞
    const selectedRunway2 = document.getElementById('runwayDisplay2').textContent;
    if (selectedRunway2 && selectedRunway2 !== '--') {
        const runwayHeading = getRunwayHeading(selectedRunway2);
        const components2 = calculateWindComponents(windDir, windSpeed, runwayHeading);

        const lateral2 = document.querySelector('#compass2').parentElement.querySelector('.lateral-component .data-value');
        const headwind2 = document.querySelector('#compass2').parentElement.querySelector('.headwind-component .data-value');

        if (lateral2) lateral2.textContent = components2.crosswind > 0 ? `+${components2.crosswind.toFixed(1)}` : components2.crosswind.toFixed(1);
        if (headwind2) headwind2.textContent = components2.headwind > 0 ? `+${components2.headwind.toFixed(1)}` : components2.headwind.toFixed(1);
    }
}

// ========== –ü–û–õ–£–ß–ï–ù–ò–ï –ö–£–†–°–ê –í–ü–ü ==========
function getRunwayHeading(runwayIdent) {
    if (!currentRunwayData) return 0;

    for (const runway of currentRunwayData) {
        if (runway.leIdent === runwayIdent) return runway.leHeading;
        if (runway.heIdent === runwayIdent) return runway.heHeading;
    }

    // –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –¥–∞–Ω–Ω—ã—Ö, –≤—ã—á–∏—Å–ª—è–µ–º –∏–∑ –Ω–æ–º–µ—Ä–∞ –í–ü–ü
    const runwayNumber = parseInt(runwayIdent.replace(/[LRC]/g, ''));
    return runwayNumber * 10;
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI —Å –¥–∞–Ω–Ω—ã–º–∏ METAR - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
function updateWeatherDisplay(data) {
    if (!data) return;

    console.log('üå¶Ô∏è Updating weather display with METAR data:', data);

    // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ METAR
    document.getElementById('metarCode').textContent = data.raw;

    // –ò–°–ü–†–ê–í–õ–Ø–ï–ú –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –î–ê–í–õ–ï–ù–ò–Ø QNH - –ò–°–ü–û–õ–¨–ó–£–ï–ú –ü–†–Ø–ú–´–ï ID
    if (data.pressure && data.pressure > 0) {
        const pressure = convertPressure(data.pressure);

        console.log('üîß Updating pressure fields:', pressure);

        // –ò—â–µ–º –ø–æ–ª—è QNH –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ HTML - –Ω–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ units
        const allWeatherRows = document.querySelectorAll('.weather-row');
        console.log(`üîç Found ${allWeatherRows.length} weather rows`);

        let hpaField = null, mmhgField = null, inhgField = null;
        let tempField = null, dewField = null;

        allWeatherRows.forEach((row, index) => {
            const label = row.querySelector('.section-label');
            const value = row.querySelector('.data-value');
            const units = row.querySelector('.units');

            if (!value || !units) return;

            const labelText = label ? label.textContent.trim() : '';
            const unitsText = units.textContent.trim();

            console.log(`Row ${index}: label="${labelText}", units="${unitsText}"`);

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ–ª—è –ø–æ –µ–¥–∏–Ω–∏—Ü–∞–º –∏–∑–º–µ—Ä–µ–Ω–∏—è
            if (unitsText === 'hPa' && !hpaField) {
                hpaField = value;
                console.log(`‚úÖ Found QNH hPa field at row ${index}`);
            } else if (unitsText === 'mmHg' && !mmhgField) {
                mmhgField = value;
                console.log(`‚úÖ Found QNH mmHg field at row ${index}`);
            } else if (unitsText === 'inHg' && !inhgField) {
                inhgField = value;
                console.log(`‚úÖ Found QNH inHg field at row ${index}`);
            } else if (unitsText === '¬∞C' && labelText === 'T' && !tempField) {
                tempField = value;
                console.log(`‚úÖ Found Temperature field at row ${index}`);
            } else if (unitsText === '¬∞C' && labelText === 'DP' && !dewField) {
                dewField = value;
                console.log(`‚úÖ Found Dewpoint field at row ${index}`);
            }
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–ª—è –¥–∞–≤–ª–µ–Ω–∏—è
        if (hpaField) {
            hpaField.textContent = pressure.hpa;
            console.log(`‚úÖ Set QNH hPa: ${pressure.hpa}`);
        } else {
            console.warn('‚ùå QNH hPa field not found');
        }

        if (mmhgField) {
            mmhgField.textContent = pressure.mmhg;
            console.log(`‚úÖ Set QNH mmHg: ${pressure.mmhg}`);
        } else {
            console.warn('‚ùå QNH mmHg field not found');
        }

        if (inhgField) {
            inhgField.textContent = pressure.inhg;
            console.log(`‚úÖ Set QNH inHg: ${pressure.inhg}`);
        } else {
            console.warn('‚ùå QNH inHg field not found');
        }

        // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä—É –∏ —Ç–æ—á–∫—É —Ä–æ—Å—ã
        if (tempField) {
            tempField.textContent = data.temperature !== null ? data.temperature : '-';
            console.log(`üå°Ô∏è Set temperature: ${data.temperature}¬∞C`);
        } else {
            console.warn('‚ùå Temperature field not found');
        }

        if (dewField) {
            dewField.textContent = data.dewpoint !== null ? data.dewpoint : '-';
            console.log(`üå°Ô∏è Set dewpoint: ${data.dewpoint}¬∞C`);
        } else {
            console.warn('‚ùå Dewpoint field not found');
        }

    } else {
        console.warn('‚ùå No valid pressure data in METAR');
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—á–µ—Ä–∫–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –¥–∞–≤–ª–µ–Ω–∏—è
        document.querySelectorAll('.weather-row').forEach(row => {
            const units = row.querySelector('.units');
            const value = row.querySelector('.data-value');
            if (units && value && ['hPa', 'mmHg', 'inHg'].includes(units.textContent.trim())) {
                value.textContent = '-';
            }
        });
    }

    // –í–∏–¥–∏–º–æ—Å—Ç—å MOR
    const visEl = document.querySelector('#morLabel').parentElement.querySelector('.data-value');
    if (visEl) {
        visEl.textContent = data.visibility || '-';
        console.log(`üëÅÔ∏è Set visibility: ${data.visibility}m`);
    }

    // –í–µ—Ç–µ—Ä - –æ–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    const windDir = data.wind.calm ? 0 : data.wind.direction;
    const windSpeed = data.wind.calm ? 0 : data.wind.speed;

    document.querySelectorAll('.wind-direction').forEach(el => {
        el.textContent = data.wind.calm ? '---¬∞' : `${windDir.toString().padStart(3, '0')}¬∞`;
    });

    document.querySelectorAll('.wind-speed').forEach(el => {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –≤–µ—Ç—Ä–∞ (–ø–æ–∫–∞ –±–µ–∑ —Å—Ç—Ä–µ–ª–æ–∫ —Ç—Ä–µ–Ω–¥–æ–≤)
        el.textContent = windSpeed.toString();
    });

    console.log(`üí® Set wind: ${windDir}¬∞/${windSpeed}kt`);

    // ========== –ù–û–í–û–ï: –£–õ–£–ß–®–ï–ù–ù–û–ï –î–ï–ö–û–î–ò–†–û–í–ê–ù–ò–ï –û–ë–õ–ê–ß–ù–û–°–¢–ò –° –ü–†–ï–î–õ–û–ì–ê–ú–ò ==========
    const currentLanguage = document.getElementById('language').value === 'ru' ? 'ru' : 'en';

    // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –æ–±–ª–∞—á–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é –Ω–æ–≤–æ–≥–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞
    const decodedClouds = decodeCloudiness(data.clouds, currentLanguage);
    console.log('‚òÅÔ∏è Decoded clouds with prepositions:', decodedClouds);

    // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –° –ü–†–ï–î–õ–û–ì–ê–ú–ò –ò HTML –ü–ï–†–ï–ù–û–°–ê–ú–ò
    const skyEl = document.querySelector('#skyConditionLabel').parentElement.querySelector('.data-value');
    if (skyEl) {
        skyEl.innerHTML = decodedClouds.summary; // –ò–ó–ú–ï–ù–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º innerHTML –¥–ª—è <br>
        console.log(`‚òÅÔ∏è Sky condition with prepositions and line breaks: ${decodedClouds.summary}`);
    }

    // ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –í–ù–ì–û (–°–ê–ú–ê–Ø –ù–ò–ñ–ù–Ø–Ø –û–ë–õ–ê–ß–ù–û–°–¢–¨) –í –§–£–¢–ê–• ==========
    const cloudBaseEl = document.querySelector('#qbbLabel').parentElement.querySelector('.data-value');
    const cloudBaseUnitsEl = document.querySelector('#qbbLabel').parentElement.querySelector('.units');
    if (cloudBaseEl && cloudBaseUnitsEl) {
        let cloudBaseText = '-';

        // –ò—â–µ–º –°–ê–ú–´–ô –ù–ò–ó–ö–ò–ô —Å–ª–æ–π –æ–±–ª–∞–∫–æ–≤ (–ª—é–±–æ–π —Ç–∏–ø) –¥–ª—è –í–ù–ì–û
        const lowestCloudLayer = decodedClouds.layers
            .filter(layer => layer.height && layer.height > 0 && ['BKN', 'OVC', 'SCT', 'FEW'].includes(layer.coverageCode))
            .sort((a, b) => a.height - b.height)[0];

        if (lowestCloudLayer) {
            cloudBaseText = lowestCloudLayer.height.toString();
            console.log(`‚òÅÔ∏è Lowest cloud base (–í–ù–ì–û): ${cloudBaseText} feet`);
        } else if (decodedClouds.layers.length > 0) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±–ª–∞—á–Ω–æ—Å—Ç—å –Ω–æ –Ω–µ—Ç –∏–∑–º–µ—Ä–∏–º–æ–π –≤—ã—Å–æ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä SKC, CLR)
            const specialLayer = decodedClouds.layers.find(layer => layer.special);
            if (specialLayer && ['SKC', 'CLR', 'NSC', 'NCD'].some(code => specialLayer.code.includes(code))) {
                cloudBaseText = currentLanguage === 'ru' ? '–Ø—Å–Ω–æ' : 'Clear';
                console.log(`‚òÅÔ∏è Clear skies (–í–ù–ì–û): ${cloudBaseText}`);
            } else if (specialLayer && specialLayer.code.includes('VV')) {
                // –î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
                cloudBaseText = specialLayer.height ? specialLayer.height.toString() : 'VV';
                console.log(`‚òÅÔ∏è Vertical visibility (–í–ù–ì–û): ${cloudBaseText}`);
            }
        }

        cloudBaseEl.textContent = cloudBaseText;

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ–¥–∏–Ω–∏—Ü—ã –¥–ª—è –í–ù–ì–û –≤ —Ñ—É—Ç–∞—Ö
        cloudBaseUnitsEl.textContent = currentLanguage === 'ru' ? '—Ñ—Ç' : 'ft';
    }

    // ========== –ù–û–í–û–ï: –ò–ó–í–õ–ï–ß–ï–ù–ò–ï QBB –ò–ó –†–ï–ú–ê–†–û–ö ==========
    const qbbFromRemarks = extractQBBFromRemarks(data.raw, currentLanguage);
    if (qbbFromRemarks !== null) {
        // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω QBB –≤ —Ä–µ–º–∞—Ä–∫–∞—Ö, –∑–∞–º–µ–Ω—è–µ–º –í–ù–ì–û –Ω–∞ QBB
        if (cloudBaseEl && cloudBaseUnitsEl) {
            cloudBaseEl.textContent = qbbFromRemarks.toString();
            cloudBaseUnitsEl.textContent = currentLanguage === 'ru' ? '–º' : 'm'; // QBB –≤—Å–µ–≥–¥–∞ –≤ –º–µ—Ç—Ä–∞—Ö
            console.log(`‚òÅÔ∏è QBB from remarks: ${qbbFromRemarks} meters (overrides –í–ù–ì–û)`);
        }
    }

    // –î–ï–ö–û–î–ò–†–û–í–ê–ù–ò–ï –ü–û–ì–û–î–ù–´–• –Ø–í–õ–ï–ù–ò–ô
    const weatherEl = document.getElementById('weatherPhenomena');
    if (weatherEl) {
        if (data.weather && data.weather.length > 0) {
            const decodedWeather = data.weather.map(weatherCode => {
                let decoded;
                if (weatherHybridDictionary[weatherCode]) {
                    decoded = weatherHybridDictionary[weatherCode][currentLanguage];
                } else {
                    decoded = decodeWeatherComponentAnalysis(weatherCode, currentLanguage);
                    decoded = decoded || weatherCode;
                }
                return decoded;
            });

            const finalWeatherText = formatWeatherList(decodedWeather);
            weatherEl.textContent = finalWeatherText;

        } else {
            weatherEl.textContent = '-';
        }
    }

    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    updateSunriseSunset();
    if (currentRunwayData) {
        initializeCompass('compass');
        initializeCompass('compass2');
        updateWindComponents();
    }
    updateQFEForSelectedRunways();

    console.log('‚úÖ Weather display updated with cloud decoding and prepositions');
}

// –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ö–û–ù–í–ï–†–¢–ê–¶–ò–ò –î–ê–í–õ–ï–ù–ò–Ø
function convertPressure(hpa) {
    if (!hpa || hpa <= 0) {
        return { hpa: '-', mmhg: '-', inhg: '-' };
    }

    const result = {
        hpa: Math.round(hpa), // –¶–µ–ª–æ–µ —á–∏—Å–ª–æ
        mmhg: Math.round(hpa * 0.750062), // –ò–°–ü–†–ê–í–õ–ï–ù–û: –¶–µ–ª–æ–µ —á–∏—Å–ª–æ –±–µ–∑ –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö
        inhg: (hpa * 0.02953).toFixed(2) // –î–≤–∞ –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
    };

    console.log(`üîß Pressure conversion: ${hpa} hPa = ${result.mmhg} mmHg = ${result.inhg} inHg`);

    return result;
}

console.log('‚úÖ Complete QFE functions updated with QNH-like layout - full block');
</script>

<style>
/* ========== QFE –°–¢–ò–õ–ò –ü–†–û–°–¢–´–ï –ò –†–ê–ë–û–ß–ò–ï ========== */

/* QFE –±–ª–æ–∫ - –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–∞–≤—É—é –∫–æ–ª–æ–Ω–∫—É –∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ */
.qfe-row {
    grid-column: 2;
    grid-row: 1 / span 2;
    display: flex;
    align-items: center;
    gap: min(6px,.6vw);
}

/* –ó–∞–≥–æ–ª–æ–≤–æ–∫ QFE —Å–ª–µ–≤–∞ */
.qfe-row .qfe-label {
    color: #666;
    font-size: clamp(12px,1.2vw,16px);
    text-align: left;
}

/* –ë–ª–æ–∫ —Å –ø–æ–ª—è–º–∏ QFE */
.qfe-row .qfe-fields {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1px;
}

/* –ö–∞–∂–¥–æ–µ –ø–æ–ª–µ QFE */
.qfe-row .qfe-field {
    display: flex;
    align-items: center;
    gap: min(4px,.4vw);
    width: 100%;
}

/* –ë–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö QFE - —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞, –≤—ã—Ä–æ–≤–Ω–µ–Ω—ã –ø–æ –ª–µ–≤–æ–º—É –∫—Ä–∞—é */
.qfe-row .qfe-field .data-field {
    width: 65px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ */
    min-width: 65px;
    max-width: 65px;
    text-align: center;
    padding: min(2px,.2vw);
    background: #f8f8f8;
    border-radius: 3px;
    flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
}

/* –ï–¥–∏–Ω–∏—Ü—ã QFE */
.qfe-row .qfe-field .units {
    color: #666;
    font-size: clamp(10px,1.0vw,13px);
    text-align: left;
}

/* –û—Å–Ω–æ–≤–Ω–æ–µ –ø–æ–ª–µ hPa */
.qfe-row .qfe-field.primary .data-value {
    font-size: clamp(11px,1.1vw,14px);
    font-weight: bold;
}

.qfe-row .qfe-field.primary .units {
    font-size: clamp(12px,1.2vw,16px);
}

/* –í—Ç–æ—Ä–∏—á–Ω—ã–µ –ø–æ–ª—è */
.qfe-row .qfe-field.secondary .data-value {
    font-size: clamp(11px,1.1vw,14px);
    font-weight: normal;
}

/* –¢–µ–º–Ω–∞—è —Ç–µ–º–∞ */
.dark .qfe-row .qfe-label,
.dark .qfe-row .qfe-field .units {
    color: #ccc;
}

.dark .qfe-row .qfe-field .data-field {
    background: #333;
}

/* –ê–î–ê–ü–¢–ò–í–ù–û–°–¢–¨ QFE */
@media (max-width: 900px) {
    .qfe-row .qfe-field .data-field {
        width: max(55px,5.5vw);
        padding: min(2px,.2vw);
    }
}

@media (max-width: 600px) {
    .qfe-row .qfe-header-row,
    .qfe-row .qfe-field.secondary {
        gap: min(2px,.2vw);
    }

    .qfe-row .qfe-field .data-field {
        width: max(50px,5vw);
    }
}
</style>

<!-- ========== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê 4A2 –ü–û–õ–ù–´–ô –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô ==========><!-- ========== –ó–ê–ú–ï–ù–ê –ß–ê–°–¢–ò 4B: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ß–ê–°–¢–¨ - –ö–û–ú–ü–ê–°–´ –ò –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ========== -->

<script>
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–º–ø–∞—Å–∞ —Å –í–ü–ü (–Ω–æ –±–µ–∑ –≤–µ—Ç—Ä–∞)
function initializeCompassWithRunway(id) {
  const c = document.getElementById(id);
  c.innerHTML = '';
  const r = c.getBoundingClientRect();
  const s = Math.min(r.width, r.height);
  const rad = s / 2;
  const cx = s / 2, cy = s / 2;

  for (let i = 0; i < 36; i++) {
    const a = i * 10;
    const radian = (a - 90) * Math.PI / 180;
    const m = document.createElement('div');
    const maj = i % 3 === 0;
    m.className = maj ? 'compass-mark major' : 'compass-mark minor';
    const ml = maj ? 18 : 12, mw = maj ? 2 : 1;
    const or = rad - 1;
    const ox = cx + Math.cos(radian) * or, oy = cy + Math.sin(radian) * or;
    const ix = cx + Math.cos(radian) * (or - ml), iy = cy + Math.sin(radian) * (or - ml);
    const mcx = (ox + ix) / 2, mcy = (oy + iy) / 2;
    m.style.left = (mcx - mw / 2) + 'px';
    m.style.top = (mcy - ml / 2) + 'px';
    m.style.width = mw + 'px';
    m.style.height = ml + 'px';
    m.style.transform = `rotate(${a}deg)`;
    m.style.transformOrigin = 'center';
    c.appendChild(m);

    if (a % 30 === 0) {
      const n = document.createElement('div');
      n.className = 'compass-number';
      let d;
      if (a === 0) d = '36';
      else if (a === 30) d = '03';
      else if (a === 60) d = '06';
      else if (a === 90) d = '09';
      else if (a === 120) d = '12';
      else if (a === 150) d = '15';
      else if (a === 180) d = '18';
      else if (a === 210) d = '21';
      else if (a === 240) d = '24';
      else if (a === 270) d = '27';
      else if (a === 300) d = '30';
      else if (a === 330) d = '33';
      n.textContent = d;
      const nr = rad + 15;
      const nx = cx + Math.cos(radian) * nr, ny = cy + Math.sin(radian) * nr;
      n.style.left = (nx - 12) + 'px';
      n.style.top = (ny - 8) + 'px';
      c.appendChild(n);
    }
  }

  if (currentRunwayData) {
    const rw = document.createElement('div');
    rw.className = 'runway-display';
    let runwayAngle;

    if (id === 'compass') {
      rw.classList.add('left-landing');
      const sel = document.getElementById('runwaySelect') ? document.getElementById('runwaySelect').value : '';
      if (sel) {
        runwayAngle = getRunwayHeading(sel) - 90;
      } else {
        runwayAngle = 0;
      }
    } else {
      rw.classList.add('left-landing');
      const opp = document.getElementById('runwayDisplay2') ? document.getElementById('runwayDisplay2').textContent : '';
      if (opp && opp !== '--') {
        runwayAngle = getRunwayHeading(opp) - 90;
      } else {
        runwayAngle = 0;
      }
    }

    rw.style.transform = `translate(-50%,-50%) rotate(${runwayAngle}deg)`;
    c.appendChild(rw);
  }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–º–ø–∞—Å–∞ (—Å –í–ü–ü –∏ –≤–µ—Ç—Ä–æ–º)
function initializeCompass(id) {
  const c = document.getElementById(id);
  c.innerHTML = '';
  const r = c.getBoundingClientRect();
  const s = Math.min(r.width, r.height);
  const rad = s / 2;
  const cx = s / 2, cy = s / 2;

  for (let i = 0; i < 36; i++) {
    const a = i * 10;
    const radian = (a - 90) * Math.PI / 180;
    const m = document.createElement('div');
    const maj = i % 3 === 0;
    m.className = maj ? 'compass-mark major' : 'compass-mark minor';
    const ml = maj ? 18 : 12, mw = maj ? 2 : 1;
    const or = rad - 1;
    const ox = cx + Math.cos(radian) * or, oy = cy + Math.sin(radian) * or;
    const ix = cx + Math.cos(radian) * (or - ml), iy = cy + Math.sin(radian) * (or - ml);
    const mcx = (ox + ix) / 2, mcy = (oy + iy) / 2;
    m.style.left = (mcx - mw / 2) + 'px';
    m.style.top = (mcy - ml / 2) + 'px';
    m.style.width = mw + 'px';
    m.style.height = ml + 'px';
    m.style.transform = `rotate(${a}deg)`;
    m.style.transformOrigin = 'center';
    c.appendChild(m);

    if (a % 30 === 0) {
      const n = document.createElement('div');
      n.className = 'compass-number';
      let d;
      if (a === 0) d = '36';
      else if (a === 30) d = '03';
      else if (a === 60) d = '06';
      else if (a === 90) d = '09';
      else if (a === 120) d = '12';
      else if (a === 150) d = '15';
      else if (a === 180) d = '18';
      else if (a === 210) d = '21';
      else if (a === 240) d = '24';
      else if (a === 270) d = '27';
      else if (a === 300) d = '30';
      else if (a === 330) d = '33';
      n.textContent = d;
      const nr = rad + 15;
      const nx = cx + Math.cos(radian) * nr, ny = cy + Math.sin(radian) * nr;
      n.style.left = (nx - 12) + 'px';
      n.style.top = (ny - 8) + 'px';
      c.appendChild(n);
    }
  }

  if (currentRunwayData) {
    const rw = document.createElement('div');
    rw.className = 'runway-display';
    let runwayAngle;

    if (id === 'compass') {
      rw.classList.add('left-landing');
      const sel = document.getElementById('runwaySelect') ? document.getElementById('runwaySelect').value : '';
      if (sel) {
        runwayAngle = getRunwayHeading(sel) - 90;
      } else {
        runwayAngle = 0;
      }
    } else {
      rw.classList.add('left-landing');
      const opp = document.getElementById('runwayDisplay2') ? document.getElementById('runwayDisplay2').textContent : '';
      if (opp && opp !== '--') {
        runwayAngle = getRunwayHeading(opp) - 90;
      } else {
        runwayAngle = 0;
      }
    }

    rw.style.transform = `translate(-50%,-50%) rotate(${runwayAngle}deg)`;
    c.appendChild(rw);
  }

  if (currentMetarData && currentMetarData.wind.variable) {
    const ws = document.createElement('div');
    ws.className = 'wind-sector variable';
    c.appendChild(ws);
  }

  if (currentMetarData && !currentMetarData.wind.calm) {
    const wa = document.createElement('div');
    wa.className = 'wind-arrow';
    const windAngle = currentMetarData.wind.direction;
    const windRad = (windAngle - 90) * Math.PI / 180;
    const startX = cx + Math.cos(windRad) * (rad - 15);
    const startY = cy + Math.sin(windRad) * (rad - 15);
    wa.style.left = startX + 'px';
    wa.style.top = startY + 'px';
    wa.style.transform = `rotate(${windAngle}deg)`;
    c.appendChild(wa);
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–≤–æ–¥–∞ ICAO —Å —Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–æ–π
function handleIcaoInput() {
  const ii = document.getElementById('icaoInput');
  ii.addEventListener('input', async function() {
    const i = this.value.toUpperCase();
    this.value = i;

    if (i.length === 4) {
      if (!/^[A-Z0-9]{4}$/.test(i)) {
        updateConnectionStatus('error', 'Invalid ICAO code');
        return;
      }

      console.log(`üîÑ Processing ICAO: ${i}`);
      updateConnectionStatus('loading', `Loading data for ${i}...`);

      try {
        // –†–ê–°–®–ò–†–ï–ù–ù–´–ï –õ–û–ì–ò –î–õ–Ø –û–¢–õ–ê–î–ö–ò –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–• –î–ê–ù–ù–´–•
        const api = await getAPI();
        const airportInfo = api.getAirportInfo(i);

        if (airportInfo) {
          console.log(`üìä Airport info for ${i}:`);
          console.log(`   üè¢ Name: ${airportInfo.name}`);
          console.log(`   üåç Country: ${airportInfo.country}`);
          console.log(`   üìç Region: ${airportInfo.iso_region}`);
          console.log(`   üèôÔ∏è City: ${airportInfo.municipality}`);
          console.log(`   üìç Coordinates: ${airportInfo.latitude}, ${airportInfo.longitude}`);
          console.log(`   ‚õ∞Ô∏è Elevation: ${airportInfo.elevation_ft}ft`);

          // –¢–µ—Å—Ç–∏—Ä—É–µ–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞
          const timezone = getAirportTimezoneFromCSV(i);
          console.log(`   ‚è∞ Calculated timezone: UTC${timezone >= 0 ? '+' : ''}${timezone}`);
        }

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –í–ü–ü
        await updateRunwayOptions(i);

        // –ó–∞–≥—Ä—É–∂–∞–µ–º METAR –¥–∞–Ω–Ω—ã–µ
        currentMetarData = await fetchMetarData(i);
        updateWeatherDisplay(currentMetarData);

        // –û–ë–ù–û–í–õ–Ø–ï–ú –î–ê–ù–ù–´–ï –í–û–°–•–û–î–ê/–ó–ê–•–û–î–ê –° –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–ú–ò –ß–ê–°–û–í–´–ú–ò –ü–û–Ø–°–ê–ú–ò
        await updateSunriseSunset();

        if (updateInterval) clearInterval(updateInterval);
        updateInterval = setInterval(async () => {
          try {
            currentMetarData = await fetchMetarData(i);
            updateWeatherDisplay(currentMetarData);
          } catch (error) {
            console.error('METAR auto-update failed:', error);
          }
        }, 30000);

        updateConnectionStatus('connected', `${i} data loaded`);
        console.log(`‚úÖ Successfully loaded all data for ${i} with regional timezone support`);

      } catch (error) {
        console.error(`‚ùå Failed to load data for ${i}:`, error);
        updateConnectionStatus('error', `Failed to load ${i}`);
      }

    } else if (i.length === 0) {
      if (updateInterval) {
        clearInterval(updateInterval);
        updateInterval = null;
      }

      currentMetarData = null;
      currentRunwayData = null;

      const select = document.getElementById('runwaySelect');
      select.innerHTML = '<option value="">Enter ICAO code</option>';
      select.disabled = true;
      document.getElementById('runwayDisplay2').textContent = '--';

      initializeEmptyCompass('compass');
      initializeEmptyCompass('compass2');
      clearAllWeatherData();

      updateConnectionStatus('', 'Enter ICAO code');
      console.log('üîÑ Cleared all data');

    } else {
      updateConnectionStatus('loading', `Type ${4 - i.length} more characters...`);
    }
  });
}

// –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ—Ö –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ UI
function clearAllWeatherData() {
  document.querySelectorAll('.weather-row .data-value').forEach(el => {
    if (!el.classList.contains('pressure-secondary')) {
      el.textContent = '-';
    }
  });
  document.querySelectorAll('.pressure-secondary').forEach(el => el.textContent = '-');

  document.getElementById('weatherPhenomena').textContent = '-';
  document.querySelector('#skyConditionLabel').parentElement.querySelector('.data-value').textContent = '-';
  document.getElementById('metarCode').textContent = '-';

  document.querySelectorAll('.lateral-component .data-value').forEach(el => el.textContent = '-');
  document.querySelectorAll('.headwind-component .data-value').forEach(el => el.textContent = '-');
  document.querySelectorAll('.friction-coefficient .data-value').forEach(el => el.textContent = '-');

  document.querySelectorAll('.wind-direction').forEach(el => el.textContent = '---¬∞');
  document.querySelectorAll('.wind-speed').forEach(el => el.textContent = '-');

  document.querySelectorAll('.compass-info .rvr-row .data-value').forEach(el => el.textContent = '-');

  // –£–¥–∞–ª—è–µ–º QFE –∏ ELEV –ø–æ–ª—è
  document.querySelectorAll('.qfe-row, .elev-row').forEach(row => row.remove());

  document.querySelectorAll('.forecast-value').forEach(el => el.textContent = '-');

  // –û–ß–ò–©–ê–ï–ú –î–ê–ù–ù–´–ï –í–û–°–•–û–î–ê/–ó–ê–•–û–î–ê
  document.getElementById('sunrise').textContent = '-';
  document.getElementById('sunset').textContent = '-';
  window.airportData = null;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function updateTime() {
  const n = new Date();
  const u = n.toUTCString().substr(17, 5);
  document.getElementById('currentTime').textContent = u;
}

function applyTheme(t) {
  const b = document.body;
  const h = new Date().getHours();
  if (t === 'auto') {
    if (h >= 6 && h < 18) b.classList.remove('dark');
    else b.classList.add('dark');
  } else if (t === 'dark') b.classList.add('dark');
  else b.classList.remove('dark');
}

function toggleWindUnits() {
  const wu = document.querySelectorAll('.wind-unit');
  wu.forEach(u => {
    if (u.textContent === '–º/—Å') {
      u.textContent = 'kt';
      const se = document.querySelectorAll('.wind-speed');
      se.forEach(s => {
        const v = parseInt(s.textContent);
        if (!isNaN(v)) {
          const c = Math.round(v * 1.944);
          s.textContent = c.toString();
        }
      });
    } else {
      u.textContent = '–º/—Å';
      const se = document.querySelectorAll('.wind-speed');
      se.forEach(s => {
        const v = parseInt(s.textContent);
        if (!isNaN(v)) {
          const c = Math.round(v / 1.944);
          s.textContent = c.toString();
        }
      });
    }
  });
}

function applyLanguage(lang) {
  if (lang === 'ru') {
    document.getElementById('timeLabel').textContent = '–í—Ä–µ–º—è UTC';
    document.getElementById('sunriseLabel').textContent = '–í–æ—Å—Ö–æ–¥';
    document.getElementById('sunsetLabel').textContent = '–ó–∞—Ö–æ–¥';
    document.getElementById('weatherLabel').textContent = '–Ø–≤–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã';
    document.getElementById('morLabel').textContent = '–í–∏–¥–∏–º–æ—Å—Ç—å';
    document.getElementById('qbbLabel').textContent = '–í–ù–ì–û';
    document.getElementById('skyConditionLabel').textContent = '–û–±–ª–∞—á–Ω–æ—Å—Ç—å';
    document.getElementById('forecastLabel').textContent = '–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã';
    document.getElementById('specialLabel').textContent = '–û—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è';
    document.getElementById('lateralLabel1').textContent = '–ë–æ–∫–æ–≤–∞—è';
    document.getElementById('headwindLabel1').textContent = '–í—Å—Ç—Ä–µ—á–Ω–∞—è';
    document.getElementById('frictionLabel1').textContent = '–ö–°—Ü';
    document.getElementById('lateralLabel2').textContent = '–ë–æ–∫–æ–≤–∞—è';
    document.getElementById('headwindLabel2').textContent = '–í—Å—Ç—Ä–µ—á–Ω–∞—è';
    document.getElementById('frictionLabel2').textContent = '–ö–°—Ü';
  } else {
    document.getElementById('timeLabel').textContent = 'Time UTC';
    document.getElementById('sunriseLabel').textContent = 'Sunrise';
    document.getElementById('sunsetLabel').textContent = 'Sunset';
    document.getElementById('weatherLabel').textContent = 'Weather';
    document.getElementById('morLabel').textContent = 'MOR';
    document.getElementById('qbbLabel').textContent = 'QBB';
    document.getElementById('skyConditionLabel').textContent = 'Sky condition';
    document.getElementById('forecastLabel').textContent = 'Weather forecast';
    document.getElementById('specialLabel').textContent = 'Special conditions';
    document.getElementById('lateralLabel1').textContent = 'Side';
    document.getElementById('headwindLabel1').textContent = 'Head';
    document.getElementById('frictionLabel1').textContent = 'Breaking action';
    document.getElementById('lateralLabel2').textContent = 'Side';
    document.getElementById('headwindLabel2').textContent = 'Head';
    document.getElementById('frictionLabel2').textContent = 'Breaking action';
  }
}

function initializeEmptyCompass(id) {
  const c = document.getElementById(id);
  c.innerHTML = '';
  const r = c.getBoundingClientRect();
  const s = Math.min(r.width, r.height);
  const rad = s / 2;
  const cx = s / 2, cy = s / 2;

  for (let i = 0; i < 36; i++) {
    const a = i * 10;
    const radian = (a - 90) * Math.PI / 180;
    const m = document.createElement('div');
    const maj = i % 3 === 0;
    m.className = maj ? 'compass-mark major' : 'compass-mark minor';
    const ml = maj ? 18 : 12, mw = maj ? 2 : 1;
    const or = rad - 1;
    const ox = cx + Math.cos(radian) * or, oy = cy + Math.sin(radian) * or;
    const ix = cx + Math.cos(radian) * (or - ml), iy = cy + Math.sin(radian) * (or - ml);
    const mcx = (ox + ix) / 2, mcy = (oy + iy) / 2;
    m.style.left = (mcx - mw / 2) + 'px';
    m.style.top = (mcy - ml / 2) + 'px';
    m.style.width = mw + 'px';
    m.style.height = ml + 'px';
    m.style.transform = `rotate(${a}deg)`;
    m.style.transformOrigin = 'center';
    c.appendChild(m);

    if (a % 30 === 0) {
      const n = document.createElement('div');
      n.className = 'compass-number';
      let d;
      if (a === 0) d = '36';
      else if (a === 30) d = '03';
      else if (a === 60) d = '06';
      else if (a === 90) d = '09';
      else if (a === 120) d = '12';
      else if (a === 150) d = '15';
      else if (a === 180) d = '18';
      else if (a === 210) d = '21';
      else if (a === 240) d = '24';
      else if (a === 270) d = '27';
      else if (a === 300) d = '30';
      else if (a === 330) d = '33';
      n.textContent = d;
      const nr = rad + 15;
      const nx = cx + Math.cos(radian) * nr, ny = cy + Math.sin(radian) * nr;
      n.style.left = (nx - 12) + 'px';
      n.style.top = (ny - 8) + 'px';
      c.appendChild(n);
    }
  }
}

// –¢–ï–°–¢–û–í–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ï–ì–ò–û–ù–ê–õ–¨–ù–´–• –ß–ê–°–û–í–´–• –ü–û–Ø–°–û–í
window.testAirportTimezone = function(icao = 'UUEE') {
  console.log(`üß™ Testing regional timezone for ${icao}...`);

  if (!globalAPI || !globalAPI.loaded) {
    console.error('‚ùå Airport database not loaded yet');
    return 'Database not loaded';
  }

  const airport = globalAPI.getAirportInfo(icao);
  if (!airport) {
    console.error(`‚ùå Airport ${icao} not found in database`);
    return 'Airport not found';
  }

  console.log(`üìä Airport details:`);
  console.log(`   üè¢ Name: ${airport.name}`);
  console.log(`   üåç Country: ${airport.country}`);
  console.log(`   üìç Region: ${airport.iso_region}`);
  console.log(`   üèôÔ∏è City: ${airport.municipality}`);
  console.log(`   üìç Coordinates: ${airport.latitude}, ${airport.longitude}`);

  const timezone = getTimezoneByRegion(airport);
  console.log(`   ‚è∞ Regional timezone: UTC${timezone >= 0 ? '+' : ''}${timezone}`);

  // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è
  const now = new Date();
  const localTime = new Date(now.getTime() + (timezone * 3600000));
  console.log(`   üïê Current UTC: ${now.toISOString().substr(11, 8)}`);
  console.log(`   üïê Current local: ${localTime.toISOString().substr(11, 8)}`);

  return { airport: airport, regionalTimezone: timezone };
};

window.testMassTimezones = function() {
  console.log('üß™ Mass testing regional timezones...');

  if (!globalAPI || !globalAPI.loaded) {
    console.error('‚ùå Airport database not loaded yet');
    return 'Database not loaded';
  }

  const testIcaos = [
    // –†–æ—Å—Å–∏—è - —Ä–∞–∑–Ω—ã–µ —Ä–µ–≥–∏–æ–Ω—ã
    'UUEE', 'ULLI', 'UMKK', 'USSS', 'UNNT', 'UHHH', 'UHPP',
    // –ï–≤—Ä–æ–ø–∞
    'EGLL', 'EDDF', 'LFPG', 'LIRF', 'LEMD', 'LSZH',
    // –°–®–ê - —Ä–∞–∑–Ω—ã–µ —à—Ç–∞—Ç—ã
    'KJFK', 'KLAX', 'KORD', 'KDEN', 'KSEA', 'KIAH',
    // –î—Ä—É–≥–∏–µ —Å—Ç—Ä–∞–Ω—ã
    'RJAA', 'ZBAA', 'VIDP', 'OMDB', 'YSSY', 'CYYZ'
  ];

  const results = [];
  let processed = 0;

  testIcaos.forEach(icao => {
    const airport = globalAPI.getAirportInfo(icao);
    if (!airport) {
      console.log(`‚ùå ${icao}: Not found`);
      return;
    }

    const regionalTz = getTimezoneByRegion(airport);
    console.log(`‚úÖ ${icao} (${airport.iso_region}): UTC${regionalTz >= 0 ? '+' : ''}${regionalTz}`);

    results.push({
      icao,
      region: airport.iso_region,
      country: airport.country,
      city: airport.municipality,
      timezone: regionalTz
    });
    processed++;
  });

  console.log(`\nüìä Summary: ${processed} airports processed`);
  return results;
};

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è DOM
document.addEventListener('DOMContentLoaded', function() {
  initializeEmptyCompass('compass');
  initializeEmptyCompass('compass2');

  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º UTC –≤—Ä–µ–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
  updateTime();

  // –û—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è UTC –≤—Ä–µ–º–µ–Ω–∏
  window.mainTimeInterval = setInterval(() => {
    const tl = document.getElementById('timeLabel');
    // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è UTC –≤—Ä–µ–º—è
    if (tl && tl.textContent.includes('UTC')) {
      updateTime();
    }
  }, 1000);

  // –ü–æ–¥–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—Ä–µ–º–µ–Ω–∏ (–∏–∑ —á–∞—Å—Ç–∏ 4A1)
  attachTimeClickHandlers();

  // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä—ã–π —É—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Ä–µ–∂–∏–º
  setInterval(updateTimeDisplay, 1000);

  document.getElementById('theme').addEventListener('change', function() {
    applyTheme(this.value);
  });

  document.getElementById('language').addEventListener('change', function() {
    applyLanguage(this.value);
  });

  applyTheme('auto');
  applyLanguage('en');
  handleIcaoInput();

  document.getElementById('runwaySelect').addEventListener('change', function() {
    updateOppositeRunway();
  });

  document.querySelectorAll('.wind-unit').forEach(u => {
    u.addEventListener('click', toggleWindUnits);
  });

  window.addEventListener('resize', function() {
    setTimeout(() => {
      if (currentRunwayData && currentMetarData) {
        initializeCompass('compass');
        initializeCompass('compass2');
      } else if (currentRunwayData) {
        initializeCompassWithRunway('compass');
        initializeCompassWithRunway('compass2');
      } else {
        initializeEmptyCompass('compass');
        initializeEmptyCompass('compass2');
      }
    }, 100);
  });

  console.log('‚úÖ Application initialized with regional timezone support');
});
</script>

<!-- ========== –ö–û–ù–ï–¶ –ß–ê–°–¢–ò 4B ========== --><!-- ========== –ë–õ–û–ö 5A-1: –î–ï–ö–û–î–ò–†–û–í–©–ò–ö –ü–û–ì–û–î–ù–´–• –£–°–õ–û–í–ò–ô - –°–õ–û–í–ê–†–ò ========== -->

<!-- –û—Å–Ω–æ–≤–∞–Ω –Ω–∞ WMO-4678 –∏ –ø—Ä–∏–∫–∞–∑–µ ‚Ññ115 –æ—Ç 5 –º–∞—Ä—Ç–∞ 2015 -->

<script>
// ========== –ü–û–õ–ù–´–ô –ì–ò–ë–†–ò–î–ù–´–ô –°–õ–û–í–ê–†–¨ –ü–û–ì–û–î–ù–´–• –£–°–õ–û–í–ò–ô ==========

const weatherHybridDictionary = {
  // ===== –ü–†–û–°–¢–´–ï –û–°–ê–î–ö–ò –° –ò–ù–¢–ï–ù–°–ò–í–ù–û–°–¢–¨–Æ =====
  "+DZ": { en: "Heavy Drizzle", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å" },
  "+RA": { en: "Heavy Rain", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å" },
  "+SN": { en: "Heavy Snow", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥" },
  "+SG": { en: "Heavy Snow grains", ru: "–°–∏–ª—å–Ω—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  "+IC": { en: "Heavy Ice crystals", ru: "–°–∏–ª—å–Ω—ã–µ –ª–µ–¥—è–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã" },
  "+PL": { en: "Heavy Ice pellets", ru: "–°–∏–ª—å–Ω–∞—è –ª–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },
  "+GR": { en: "Heavy Hail", ru: "–°–∏–ª—å–Ω—ã–π –≥—Ä–∞–¥" },
  "+GS": { en: "Heavy Small hail", ru: "–°–∏–ª—å–Ω—ã–π –º–µ–ª–∫–∏–π –≥—Ä–∞–¥" },
  "+UP": { en: "Heavy Unknown precipitation", ru: "–°–∏–ª—å–Ω—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–∞–¥–∫–∏" },

  "-DZ": { en: "Light Drizzle", ru: "–°–ª–∞–±–∞—è –º–æ—Ä–æ—Å—å" },
  "-RA": { en: "Light Rain", ru: "–°–ª–∞–±—ã–π –¥–æ–∂–¥—å" },
  "-SN": { en: "Light Snow", ru: "–°–ª–∞–±—ã–π —Å–Ω–µ–≥" },
  "-SG": { en: "Light Snow grains", ru: "–°–ª–∞–±—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  "-IC": { en: "Light Ice crystals", ru: "–°–ª–∞–±—ã–µ –ª–µ–¥—è–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã" },
  "-PL": { en: "Light Ice pellets", ru: "–°–ª–∞–±–∞—è –ª–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },
  "-GR": { en: "Light Hail", ru: "–°–ª–∞–±—ã–π –≥—Ä–∞–¥" },
  "-GS": { en: "Light Small hail", ru: "–°–ª–∞–±—ã–π –º–µ–ª–∫–∏–π –≥—Ä–∞–¥" },
  "-UP": { en: "Light Unknown precipitation", ru: "–°–ª–∞–±—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–∞–¥–∫–∏" },

  "DZ": { en: "Drizzle", ru: "–ú–æ—Ä–æ—Å—å" },
  "RA": { en: "Rain", ru: "–î–æ–∂–¥—å" },
  "SN": { en: "Snow", ru: "–°–Ω–µ–≥" },
  "SG": { en: "Snow grains", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  "IC": { en: "Ice crystals", ru: "–õ–µ–¥—è–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã" },
  "PL": { en: "Ice pellets", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },
  "GR": { en: "Hail", ru: "–ì—Ä–∞–¥" },
  "GS": { en: "Small hail", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥" },
  "UP": { en: "Unknown precipitation", ru: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–∞–¥–∫–∏" },

  // ===== –°–ú–ï–®–ê–ù–ù–´–ï –û–°–ê–î–ö–ò =====
  "+DZRA": { en: "Heavy Drizzle and Rain", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å —Å –¥–æ–∂–¥—ë–º" },
  "+DZSN": { en: "Heavy Drizzle and Snow", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å —Å–æ —Å–Ω–µ–≥–æ–º" },
  "+DZSG": { en: "Heavy Drizzle and Snow grains", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "+DZIC": { en: "Heavy Drizzle and Ice crystals", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "+DZPL": { en: "Heavy Drizzle and Ice pellets", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "+DZGR": { en: "Heavy Drizzle and Hail", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å —Å –≥—Ä–∞–¥–æ–º" },
  "+DZGS": { en: "Heavy Drizzle and Small hail", ru: "–°–∏–ª—å–Ω–∞—è –º–æ—Ä–æ—Å—å —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "+RADZ": { en: "Heavy Rain and Drizzle", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å —Å –º–æ—Ä–æ—Å—å—é" },
  "+RASN": { en: "Heavy Rain and Snow", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å —Å–æ —Å–Ω–µ–≥–æ–º" },
  "+RASG": { en: "Heavy Rain and Snow grains", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "+RAIC": { en: "Heavy Rain and Ice crystals", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "+RAPL": { en: "Heavy Rain and Ice pellets", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "+RAGR": { en: "Heavy Rain and Hail", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å —Å –≥—Ä–∞–¥–æ–º" },
  "+RAGS": { en: "Heavy Rain and Small hail", ru: "–°–∏–ª—å–Ω—ã–π –¥–æ–∂–¥—å —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "+SNDZ": { en: "Heavy Snow and Drizzle", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥ —Å –º–æ—Ä–æ—Å—å—é" },
  "+SNRA": { en: "Heavy Snow and Rain", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥ —Å –¥–æ–∂–¥—ë–º" },
  "+SNSG": { en: "Heavy Snow and Snow grains", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "+SNIC": { en: "Heavy Snow and Ice crystals", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "+SNPL": { en: "Heavy Snow and Ice pellets", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "+SNGR": { en: "Heavy Snow and Hail", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥ —Å –≥—Ä–∞–¥–æ–º" },
  "+SNGS": { en: "Heavy Snow and Small hail", ru: "–°–∏–ª—å–Ω—ã–π —Å–Ω–µ–≥ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "-DZRA": { en: "Light Drizzle and Rain", ru: "–°–ª–∞–±–∞—è –º–æ—Ä–æ—Å—å —Å –¥–æ–∂–¥—ë–º" },
  "-DZSN": { en: "Light Drizzle and Snow", ru: "–°–ª–∞–±–∞—è –º–æ—Ä–æ—Å—å —Å–æ —Å–Ω–µ–≥–æ–º" },
  "-RADZ": { en: "Light Rain and Drizzle", ru: "–°–ª–∞–±—ã–π –¥–æ–∂–¥—å —Å –º–æ—Ä–æ—Å—å—é" },
  "-RASN": { en: "Light Rain and Snow", ru: "–°–ª–∞–±—ã–π –¥–æ–∂–¥—å —Å–æ —Å–Ω–µ–≥–æ–º" },
  "-SNDZ": { en: "Light Snow and Drizzle", ru: "–°–ª–∞–±—ã–π —Å–Ω–µ–≥ —Å –º–æ—Ä–æ—Å—å—é" },
  "-SNRA": { en: "Light Snow and Rain", ru: "–°–ª–∞–±—ã–π —Å–Ω–µ–≥ —Å –¥–æ–∂–¥—ë–º" },
  "-PLSG": { en: "Light Ice pellets and Snow grains", ru: "–°–ª–∞–±–∞—è –ª–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "-SGPL": { en: "Light Snow grains and Ice pellets", ru: "–°–ª–∞–±—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },

  "DZRA": { en: "Drizzle and Rain", ru: "–ú–æ—Ä–æ—Å—å —Å –¥–æ–∂–¥—ë–º" },
  "DZSN": { en: "Drizzle and Snow", ru: "–ú–æ—Ä–æ—Å—å —Å–æ —Å–Ω–µ–≥–æ–º" },
  "DZPL": { en: "Drizzle and Ice pellets", ru: "–ú–æ—Ä–æ—Å—å —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "DZSG": { en: "Drizzle and Snow grains", ru: "–ú–æ—Ä–æ—Å—å —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "DZIC": { en: "Drizzle and Ice crystals", ru: "–ú–æ—Ä–æ—Å—å —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "DZGR": { en: "Drizzle and Hail", ru: "–ú–æ—Ä–æ—Å—å —Å –≥—Ä–∞–¥–æ–º" },
  "DZGS": { en: "Drizzle and Small hail", ru: "–ú–æ—Ä–æ—Å—å —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "RADZ": { en: "Rain and Drizzle", ru: "–î–æ–∂–¥—å —Å –º–æ—Ä–æ—Å—å—é" },
  "RASN": { en: "Rain and Snow", ru: "–î–æ–∂–¥—å —Å–æ —Å–Ω–µ–≥–æ–º" },
  "RAPL": { en: "Rain and Ice pellets", ru: "–î–æ–∂–¥—å —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "RASG": { en: "Rain and Snow grains", ru: "–î–æ–∂–¥—å —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "RAIC": { en: "Rain and Ice crystals", ru: "–î–æ–∂–¥—å —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "RAGR": { en: "Rain and Hail", ru: "–î–æ–∂–¥—å —Å –≥—Ä–∞–¥–æ–º" },
  "RAGS": { en: "Rain and Small hail", ru: "–î–æ–∂–¥—å —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "SNDZ": { en: "Snow and Drizzle", ru: "–°–Ω–µ–≥ —Å –º–æ—Ä–æ—Å—å—é" },
  "SNRA": { en: "Snow and Rain", ru: "–°–Ω–µ–≥ —Å –¥–æ–∂–¥—ë–º" },
  "SNPL": { en: "Snow and Ice pellets", ru: "–°–Ω–µ–≥ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "SNSG": { en: "Snow and Snow grains", ru: "–°–Ω–µ–≥ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "SNIC": { en: "Snow and Ice crystals", ru: "–°–Ω–µ–≥ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "SNGR": { en: "Snow and Hail", ru: "–°–Ω–µ–≥ —Å –≥—Ä–∞–¥–æ–º" },
  "SNGS": { en: "Snow and Small hail", ru: "–°–Ω–µ–≥ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "SGDZ": { en: "Snow grains and Drizzle", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å –º–æ—Ä–æ—Å—å—é" },
  "SGRA": { en: "Snow grains and Rain", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å –¥–æ–∂–¥—ë–º" },
  "SGSN": { en: "Snow grains and Snow", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å–æ —Å–Ω–µ–≥–æ–º" },
  "SGPL": { en: "Snow grains and Ice pellets", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "SGIC": { en: "Snow grains and Ice crystals", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "SGGR": { en: "Snow grains and Hail", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å –≥—Ä–∞–¥–æ–º" },
  "SGGS": { en: "Snow grains and Small hail", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "PLRA": { en: "Ice pellets and Rain", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞ —Å –¥–æ–∂–¥—ë–º" },
  "PLSN": { en: "Ice pellets and Snow", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞ —Å–æ —Å–Ω–µ–≥–æ–º" },
  "PLSG": { en: "Ice pellets and Snow grains", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "PLIC": { en: "Ice pellets and Ice crystals", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "PLGR": { en: "Ice pellets and Hail", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞ —Å –≥—Ä–∞–¥–æ–º" },
  "PLGS": { en: "Ice pellets and Small hail", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "GRRA": { en: "Hail and Rain", ru: "–ì—Ä–∞–¥ —Å –¥–æ–∂–¥—ë–º" },
  "GRSN": { en: "Hail and Snow", ru: "–ì—Ä–∞–¥ —Å–æ —Å–Ω–µ–≥–æ–º" },
  "GRSG": { en: "Hail and Snow grains", ru: "–ì—Ä–∞–¥ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "GRIC": { en: "Hail and Ice crystals", ru: "–ì—Ä–∞–¥ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "GRPL": { en: "Hail and Ice pellets", ru: "–ì—Ä–∞–¥ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "GRGS": { en: "Hail and Small hail", ru: "–ì—Ä–∞–¥ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "GSRA": { en: "Small hail and Rain", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥ —Å –¥–æ–∂–¥—ë–º" },
  "GSSN": { en: "Small hail and Snow", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥ —Å–æ —Å–Ω–µ–≥–æ–º" },
  "GSSG": { en: "Small hail and Snow grains", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "GSIC": { en: "Small hail and Ice crystals", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "GSPL": { en: "Small hail and Ice pellets", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "GSGR": { en: "Small hail and Hail", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥ —Å –≥—Ä–∞–¥–æ–º" },

  // ===== –õ–ò–í–ù–ï–í–´–ï –û–°–ê–î–ö–ò =====
  "+SHDZ": { en: "Heavy Showers of Drizzle", ru: "–°–∏–ª—å–Ω—ã–π –ª–∏–≤–Ω–µ–≤–æ–π –¥–æ–∂–¥—å (–º–æ—Ä–æ—Å—å)" },
  "+SHRA": { en: "Heavy Showers of Rain", ru: "–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–∏" },
  "+SHSN": { en: "Heavy Snow Showers", ru: "–°–∏–ª—å–Ω—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã" },
  "+SHSG": { en: "Heavy Showers of Snow grains", ru: "–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–µ–≤—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  "+SHIC": { en: "Heavy Showers of Ice crystals", ru: "–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–µ–≤—ã–µ –ª–µ–¥—è–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã" },
  "+SHPL": { en: "Heavy Showers of Ice pellets", ru: "–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–µ–≤–∞—è –ª–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },
  "+SHGR": { en: "Heavy Hail Showers", ru: "–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–µ–≤—ã–π –≥—Ä–∞–¥" },
  "+SHGS": { en: "Heavy Small hail Showers", ru: "–°–∏–ª—å–Ω—ã–µ –ª–∏–≤–Ω–µ–≤—ã–π –º–µ–ª–∫–∏–π –≥—Ä–∞–¥" },

  "-SHDZ": { en: "Light Showers of Drizzle", ru: "–°–ª–∞–±—ã–π –ª–∏–≤–Ω–µ–≤–æ–π –¥–æ–∂–¥—å (–º–æ—Ä–æ—Å—å)" },
  "-SHRA": { en: "Light Showers of Rain", ru: "–°–ª–∞–±—ã–µ –ª–∏–≤–Ω–∏" },
  "-SHSN": { en: "Light Snow Showers", ru: "–°–ª–∞–±—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã" },
  "-SHSG": { en: "Light Showers of Snow grains", ru: "–°–ª–∞–±—ã–µ –ª–∏–≤–Ω–µ–≤—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  "-SHIC": { en: "Light Showers of Ice crystals", ru: "–°–ª–∞–±—ã–µ –ª–∏–≤–Ω–µ–≤—ã–µ –ª–µ–¥—è–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã" },
  "-SHPL": { en: "Light Showers of Ice pellets", ru: "–°–ª–∞–±–∞—è –ª–∏–≤–Ω–µ–≤–∞—è –ª–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },
  "-SHGR": { en: "Light Hail Showers", ru: "–°–ª–∞–±—ã–π –ª–∏–≤–Ω–µ–≤—ã–π –≥—Ä–∞–¥" },
  "-SHGS": { en: "Light Small hail Showers", ru: "–°–ª–∞–±—ã–π –ª–∏–≤–Ω–µ–≤—ã–π –º–µ–ª–∫–∏–π –≥—Ä–∞–¥" },

  "SHDZ": { en: "Showers of Drizzle", ru: "–õ–∏–≤–Ω–µ–≤–∞—è –º–æ—Ä–æ—Å—å" },
  "SHRA": { en: "Showers of Rain", ru: "–õ–∏–≤–Ω–µ–≤–æ–π –¥–æ–∂–¥—å" },
  "SHSN": { en: "Snow Showers", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã" },
  "SHSG": { en: "Showers of Snow grains", ru: "–õ–∏–≤–Ω–µ–≤—ã–µ —Å–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  "SHIC": { en: "Showers of Ice crystals", ru: "–õ–∏–≤–Ω–µ–≤—ã–µ –ª–µ–¥—è–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã" },
  "SHPL": { en: "Showers of Ice pellets", ru: "–õ–∏–≤–Ω–µ–≤–∞—è –ª–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },
  "SHGR": { en: "Hail Showers", ru: "–õ–∏–≤–Ω–µ–≤—ã–π –≥—Ä–∞–¥" },
  "SHGS": { en: "Small hail Showers", ru: "–õ–∏–≤–Ω–µ–≤—ã–π –º–µ–ª–∫–∏–π –≥—Ä–∞–¥" },

  // ===== –°–ú–ï–®–ê–ù–ù–´–ï –õ–ò–í–ù–ï–í–´–ï –û–°–ê–î–ö–ò =====
  "SHRADZ": { en: "Showers of rain and drizzle", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º –∏ –º–æ—Ä–æ—Å—å—é" },
  "SHRASN": { en: "Showers of rain and snow", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º –∏ —Å–Ω–µ–≥–æ–º" },
  "SHRASG": { en: "Showers of rain and snow grains", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º –∏ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "SHRAIC": { en: "Showers of rain and ice crystals", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º –∏ –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "SHRAPL": { en: "Showers of rain and ice pellets", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º –∏ –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "SHRAGR": { en: "Showers of rain and hail", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º –∏ –≥—Ä–∞–¥–æ–º" },
  "SHRAGS": { en: "Showers of rain and small hail", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º –∏ –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "SHSNRA": { en: "Showers of snow and rain", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã —Å –¥–æ–∂–¥—ë–º" },
  "SHSNDZ": { en: "Showers of snow and drizzle", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã —Å –º–æ—Ä–æ—Å—å—é" },
  "SHSNSG": { en: "Showers of snow and snow grains", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "SHSNIC": { en: "Showers of snow and ice crystals", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "SHSNPL": { en: "Showers of snow and ice pellets", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "SHSNGR": { en: "Showers of snow and hail", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã —Å –≥—Ä–∞–¥–æ–º" },
  "SHSNGS": { en: "Showers of snow and small hail", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  // ===== –ì–†–û–ó–´ =====
  "+TS": { en: "Heavy Thunderstorm", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞" },
  "-TS": { en: "Light Thunderstorm", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞" },
  "TS": { en: "Thunderstorm", ru: "–ì—Ä–æ–∑–∞" },

  "+TSDZ": { en: "Heavy Thunderstorm with Drizzle", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –º–æ—Ä–æ—Å—å—é" },
  "+TSRA": { en: "Heavy Thunderstorm with Rain", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º" },
  "+TSSN": { en: "Heavy Thunderstorm with Snow", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º" },
  "+TSSG": { en: "Heavy Thunderstorm with Snow grains", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "+TSIC": { en: "Heavy Thunderstorm with Ice crystals", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "+TSPL": { en: "Heavy Thunderstorm with Ice pellets", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "+TSGR": { en: "Heavy Thunderstorm with Hail", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º" },
  "+TSGS": { en: "Heavy Thunderstorm with Small hail", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },
  "+TSUP": { en: "Heavy Thunderstorm with Unknown precipitation", ru: "–°–∏–ª—å–Ω–∞—è –≥—Ä–æ–∑–∞ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –æ—Å–∞–¥–∫–∞–º–∏" },

  "-TSDZ": { en: "Light Thunderstorm with Drizzle", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å –º–æ—Ä–æ—Å—å—é" },
  "-TSRA": { en: "Light Thunderstorm with Rain", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º" },
  "-TSSN": { en: "Light Thunderstorm with Snow", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º" },
  "-TSSG": { en: "Light Thunderstorm with Snow grains", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "-TSIC": { en: "Light Thunderstorm with Ice crystals", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "-TSPL": { en: "Light Thunderstorm with Ice pellets", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "-TSGR": { en: "Light Thunderstorm with Hail", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º" },
  "-TSGS": { en: "Light Thunderstorm with Small hail", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },
  "-TSUP": { en: "Light Thunderstorm with Unknown precipitation", ru: "–°–ª–∞–±–∞—è –≥—Ä–æ–∑–∞ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –æ—Å–∞–¥–∫–∞–º–∏" },

  "TSDZ": { en: "Thunderstorm with Drizzle", ru: "–ì—Ä–æ–∑–∞ —Å –º–æ—Ä–æ—Å—å—é" },
  "TSRA": { en: "Thunderstorm with Rain", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º" },
  "TSSN": { en: "Thunderstorm with Snow", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º" },
  "TSSG": { en: "Thunderstorm with Snow grains", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "TSIC": { en: "Thunderstorm with Ice crystals", ru: "–ì—Ä–æ–∑–∞ —Å –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "TSPL": { en: "Thunderstorm with Ice pellets", ru: "–ì—Ä–æ–∑–∞ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "TSGR": { en: "Thunderstorm with Hail", ru: "–ì—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º" },
  "TSGS": { en: "Thunderstorm with Small hail", ru: "–ì—Ä–æ–∑–∞ —Å –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },
  "TSUP": { en: "Thunderstorm with Unknown precipitation", ru: "–ì—Ä–æ–∑–∞ —Å –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–º–∏ –æ—Å–∞–¥–∫–∞–º–∏" }
};
</script>

<!-- ========== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê 5A-1 ========== --> <!-- ========== –ë–õ–û–ö 5A-2: –î–ï–ö–û–î–ò–†–û–í–©–ò–ö - –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –°–õ–û–í–ê–†–ï–ô ========== -->

<script>
// ===== –ü–†–û–î–û–õ–ñ–ï–ù–ò–ï –ì–ò–ë–†–ò–î–ù–û–ì–û –°–õ–û–í–ê–†–Ø =====

// –î–æ–±–∞–≤–ª—è–µ–º –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É weatherHybridDictionary
Object.assign(weatherHybridDictionary, {
  // ===== –°–ú–ï–®–ê–ù–ù–´–ï –ì–†–û–ó–´ =====
  "TSRADZ": { en: "Thunderstorm with rain and drizzle", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –∏ –º–æ—Ä–æ—Å—å—é" },
  "TSRASN": { en: "Thunderstorm with rain and snow", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –∏ —Å–Ω–µ–≥–æ–º" },
  "TSRASG": { en: "Thunderstorm with rain and snow grains", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –∏ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "TSRAIC": { en: "Thunderstorm with rain and ice crystals", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –∏ –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "TSRAPL": { en: "Thunderstorm with rain and ice pellets", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –∏ –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "TSRAGR": { en: "Thunderstorm with rain and hail", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –∏ –≥—Ä–∞–¥–æ–º" },
  "TSRAGS": { en: "Thunderstorm with rain and small hail", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –∏ –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  "TSSNRA": { en: "Thunderstorm with snow and rain", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –∏ –¥–æ–∂–¥—ë–º" },
  "TSSNDZ": { en: "Thunderstorm with snow and drizzle", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –∏ –º–æ—Ä–æ—Å—å—é" },
  "TSSNSG": { en: "Thunderstorm with snow and snow grains", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –∏ —Å–Ω–µ–∂–Ω—ã–º–∏ –∑—ë—Ä–Ω–∞–º–∏" },
  "TSSNIC": { en: "Thunderstorm with snow and ice crystals", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –∏ –ª–µ–¥—è–Ω—ã–º–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∞–º–∏" },
  "TSSNPL": { en: "Thunderstorm with snow and ice pellets", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –∏ –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "TSSNGR": { en: "Thunderstorm with snow and hail", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –∏ –≥—Ä–∞–¥–æ–º" },
  "TSSNGS": { en: "Thunderstorm with snow and small hail", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –∏ –º–µ–ª–∫–∏–º –≥—Ä–∞–¥–æ–º" },

  // ===== –ü–ï–†–ï–û–•–õ–ê–ñ–î–Å–ù–ù–´–ï –û–°–ê–î–ö–ò =====
  "+FZDZ": { en: "Heavy Freezing Drizzle", ru: "–°–∏–ª—å–Ω–∞—è –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å" },
  "+FZRA": { en: "Heavy Freezing Rain", ru: "–°–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π –¥–æ–∂–¥—å" },
  "+FZSN": { en: "Heavy Freezing Snow", ru: "–°–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π —Å–Ω–µ–≥" },
  "+FZUP": { en: "Heavy Freezing Unknown precipitation", ru: "–°–∏–ª—å–Ω—ã–µ –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–∞–¥–∫–∏" },

  "-FZDZ": { en: "Light Freezing Drizzle", ru: "–°–ª–∞–±–∞—è –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å" },
  "-FZRA": { en: "Light Freezing Rain", ru: "–°–ª–∞–±—ã–π –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π –¥–æ–∂–¥—å" },
  "-FZSN": { en: "Light Freezing Snow", ru: "–°–ª–∞–±—ã–π –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π —Å–Ω–µ–≥" },
  "-FZUP": { en: "Light Freezing Unknown precipitation", ru: "–°–ª–∞–±—ã–µ –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–∞–¥–∫–∏" },

  "FZDZ": { en: "Freezing Drizzle", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å" },
  "FZRA": { en: "Freezing Rain", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π –¥–æ–∂–¥—å" },
  "FZSN": { en: "Freezing Snow", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π —Å–Ω–µ–≥" },
  "FZUP": { en: "Freezing Unknown precipitation", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–µ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–∞–¥–∫–∏" },

  "FZDZRA": { en: "Freezing Drizzle and Rain", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å —Å –¥–æ–∂–¥—ë–º" },
  "FZRASN": { en: "Freezing Rain and Snow", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π –¥–æ–∂–¥—å —Å–æ —Å–Ω–µ–≥–æ–º" },
  "FZDZPL": { en: "Freezing Drizzle and Ice pellets", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },

  // ===== –¢–£–ú–ê–ù–´ –ò –î–´–ú–ö–ò =====
  "+BR": { en: "Heavy Mist", ru: "–°–∏–ª—å–Ω–∞—è –¥—ã–º–∫–∞" },
  "+FG": { en: "Heavy Fog", ru: "–°–∏–ª—å–Ω—ã–π —Ç—É–º–∞–Ω" },
  "+FU": { en: "Heavy Smoke", ru: "–°–∏–ª—å–Ω—ã–π –¥—ã–º" },
  "+VA": { en: "Heavy Volcanic ash", ru: "–°–∏–ª—å–Ω—ã–π –≤—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∏–π –ø–µ–ø–µ–ª" },
  "+DU": { en: "Heavy Dust", ru: "–°–∏–ª—å–Ω–∞—è –ø—ã–ª—å" },
  "+SA": { en: "Heavy Sand", ru: "–°–∏–ª—å–Ω—ã–π –ø–µ—Å–æ–∫" },
  "+HZ": { en: "Heavy Haze", ru: "–°–∏–ª—å–Ω–∞—è –º–≥–ª–∞" },
  "+PY": { en: "Heavy Spray", ru: "–°–∏–ª—å–Ω–∞—è –≤–æ–¥—è–Ω–∞—è –ø—ã–ª—å" },

  "-BR": { en: "Light Mist", ru: "–°–ª–∞–±–∞—è –¥—ã–º–∫–∞" },
  "-FG": { en: "Light Fog", ru: "–°–ª–∞–±—ã–π —Ç—É–º–∞–Ω" },
  "-FU": { en: "Light Smoke", ru: "–°–ª–∞–±—ã–π –¥—ã–º" },
  "-VA": { en: "Light Volcanic ash", ru: "–°–ª–∞–±—ã–π –≤—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∏–π –ø–µ–ø–µ–ª" },
  "-DU": { en: "Light Dust", ru: "–°–ª–∞–±–∞—è –ø—ã–ª—å" },
  "-SA": { en: "Light Sand", ru: "–°–ª–∞–±—ã–π –ø–µ—Å–æ–∫" },
  "-HZ": { en: "Light Haze", ru: "–°–ª–∞–±–∞—è –º–≥–ª–∞" },
  "-PY": { en: "Light Spray", ru: "–°–ª–∞–±–∞—è –≤–æ–¥—è–Ω–∞—è –ø—ã–ª—å" },

  "BR": { en: "Mist", ru: "–î—ã–º–∫–∞" },
  "FG": { en: "Fog", ru: "–¢—É–º–∞–Ω" },
  "FU": { en: "Smoke", ru: "–î—ã–º" },
  "VA": { en: "Volcanic ash", ru: "–í—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∏–π –ø–µ–ø–µ–ª" },
  "DU": { en: "Dust", ru: "–ü—ã–ª—å" },
  "SA": { en: "Sand", ru: "–ü–µ—Å–æ–∫" },
  "HZ": { en: "Haze", ru: "–ú–≥–ª–∞" },
  "PY": { en: "Spray", ru: "–í–æ–¥—è–Ω–∞—è –ø—ã–ª—å" },

  // ===== –¢–£–ú–ê–ù–´ –° –î–ï–°–ö–†–ò–ü–¢–û–†–ê–ú–ò =====
  "MIFG": { en: "Shallow Fog", ru: "–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π —Ç—É–º–∞–Ω" },
  "PRFG": { en: "Partial Fog", ru: "–ß–∞—Å—Ç–∏—á–Ω—ã–π —Ç—É–º–∞–Ω" },
  "BCFG": { en: "Patches of Fog", ru: "–¢—É–º–∞–Ω —É—á–∞—Å—Ç–∫–∞–º–∏" },
  "FZFG": { en: "Freezing Fog", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π —Ç—É–º–∞–Ω" },

  "MIBR": { en: "Shallow Mist", ru: "–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω–∞—è –¥—ã–º–∫–∞" },
  "PRBR": { en: "Partial Mist", ru: "–ß–∞—Å—Ç–∏—á–Ω–∞—è –¥—ã–º–∫–∞" },
  "BCBR": { en: "Patches of Mist", ru: "–î—ã–º–∫–∞ —É—á–∞—Å—Ç–∫–∞–º–∏" },

  // ===== –ú–ï–¢–ï–õ–ò –ò –ü–û–ó–ï–ú–ö–ò =====
  "+BLSN": { en: "Heavy Blowing Snow", ru: "–°–∏–ª—å–Ω–∞—è –Ω–∏–∑–æ–≤–∞—è –º–µ—Ç–µ–ª—å" },
  "+DRSN": { en: "Heavy Drifting Snow", ru: "–°–∏–ª—å–Ω—ã–π –ø–æ–∑–µ–º–æ–∫" },
  "+BLDU": { en: "Heavy Blowing Dust", ru: "–°–∏–ª—å–Ω–∞—è –ø—ã–ª—å–Ω–∞—è –±—É—Ä—è" },
  "+DRDU": { en: "Heavy Drifting Dust", ru: "–°–∏–ª—å–Ω—ã–π –ø–æ–∑–µ–º–æ–∫ –ø—ã–ª–∏" },
  "+BLSA": { en: "Heavy Blowing Sand", ru: "–°–∏–ª—å–Ω–∞—è –ø–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è" },
  "+DRSA": { en: "Heavy Drifting Sand", ru: "–°–∏–ª—å–Ω—ã–π –ø–æ–∑–µ–º–æ–∫ –ø–µ—Å–∫–∞" },

  "-BLSN": { en: "Light Blowing Snow", ru: "–°–ª–∞–±–∞—è –Ω–∏–∑–æ–≤–∞—è –º–µ—Ç–µ–ª—å" },
  "-DRSN": { en: "Light Drifting Snow", ru: "–°–ª–∞–±—ã–π –ø–æ–∑–µ–º–æ–∫" },
  "-BLDU": { en: "Light Blowing Dust", ru: "–°–ª–∞–±–∞—è –ø—ã–ª—å–Ω–∞—è –±—É—Ä—è" },
  "-DRDU": { en: "Light Drifting Dust", ru: "–°–ª–∞–±—ã–π –ø–æ–∑–µ–º–æ–∫ –ø—ã–ª–∏" },
  "-BLSA": { en: "Light Blowing Sand", ru: "–°–ª–∞–±–∞—è –ø–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è" },
  "-DRSA": { en: "Light Drifting Sand", ru: "–°–ª–∞–±—ã–π –ø–æ–∑–µ–º–æ–∫ –ø–µ—Å–∫–∞" },

  "BLSN": { en: "Blowing Snow", ru: "–ù–∏–∑–æ–≤–∞—è –º–µ—Ç–µ–ª—å" },
  "DRSN": { en: "Drifting Snow", ru: "–ü–æ–∑–µ–º–æ–∫" },
  "BLDU": { en: "Blowing Dust", ru: "–ü—ã–ª—å–Ω–∞—è –±—É—Ä—è" },
  "DRDU": { en: "Drifting Dust", ru: "–ü–æ–∑–µ–º–æ–∫ –ø—ã–ª–∏" },
  "BLSA": { en: "Blowing Sand", ru: "–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è" },
  "DRSA": { en: "Drifting Sand", ru: "–ü–æ–∑–µ–º–æ–∫ –ø–µ—Å–∫–∞" }
});
</script>

<!-- ========== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê 5A-2 ========== --> <!-- ========== –ë–õ–û–ö 5A-3: –î–ï–ö–û–î–ò–†–û–í–©–ò–ö - –ó–ê–í–ï–†–®–ï–ù–ò–ï –°–õ–û–í–ê–†–ï–ô ========== -->

<script>
// ===== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ì–ò–ë–†–ò–î–ù–û–ì–û –°–õ–û–í–ê–†–Ø =====

// –î–æ–±–∞–≤–ª—è–µ–º –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É weatherHybridDictionary
Object.assign(weatherHybridDictionary, {
  // ===== –î–†–£–ì–ò–ï –Ø–í–õ–ï–ù–ò–Ø =====
  "+PO": { en: "Heavy Dust/Sand whirls", ru: "–°–∏–ª—å–Ω—ã–µ –ø—ã–ª—å–Ω—ã–µ/–ø–µ—Å—á–∞–Ω—ã–µ –≤–∏—Ö—Ä–∏" },
  "+SQ": { en: "Heavy Squalls", ru: "–°–∏–ª—å–Ω—ã–µ —à–∫–≤–∞–ª—ã" },
  "+FC": { en: "Heavy Funnel cloud/Tornado/Waterspout", ru: "–°–∏–ª—å–Ω—ã–π —Å–º–µ—Ä—á/—Ç–æ—Ä–Ω–∞–¥–æ" },
  "+SS": { en: "Heavy Sandstorm", ru: "–°–∏–ª—å–Ω–∞—è –ø–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è" },
  "+DS": { en: "Heavy Duststorm", ru: "–°–∏–ª—å–Ω–∞—è –ø—ã–ª—å–Ω–∞—è –±—É—Ä—è" },

  "-PO": { en: "Light Dust/Sand whirls", ru: "–°–ª–∞–±—ã–µ –ø—ã–ª—å–Ω—ã–µ/–ø–µ—Å—á–∞–Ω—ã–µ –≤–∏—Ö—Ä–∏" },
  "-SQ": { en: "Light Squalls", ru: "–°–ª–∞–±—ã–µ —à–∫–≤–∞–ª—ã" },
  "-FC": { en: "Light Funnel cloud/Tornado/Waterspout", ru: "–°–ª–∞–±—ã–π —Å–º–µ—Ä—á/—Ç–æ—Ä–Ω–∞–¥–æ" },
  "-SS": { en: "Light Sandstorm", ru: "–°–ª–∞–±–∞—è –ø–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è" },
  "-DS": { en: "Light Duststorm", ru: "–°–ª–∞–±–∞—è –ø—ã–ª—å–Ω–∞—è –±—É—Ä—è" },

  "PO": { en: "Dust/Sand whirls", ru: "–ü—ã–ª—å–Ω—ã–µ/–ø–µ—Å—á–∞–Ω—ã–µ –≤–∏—Ö—Ä–∏" },
  "SQ": { en: "Squalls", ru: "–®–∫–≤–∞–ª—ã" },
  "FC": { en: "Funnel cloud/Tornado/Waterspout", ru: "–°–º–µ—Ä—á/—Ç–æ—Ä–Ω–∞–¥–æ" },
  "SS": { en: "Sandstorm", ru: "–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è" },
  "DS": { en: "Duststorm", ru: "–ü—ã–ª—å–Ω–∞—è –±—É—Ä—è" },

  // ===== –í –û–ö–†–ï–°–¢–ù–û–°–¢–ò (VICINITY) =====
  "VCTS": { en: "Thunderstorm in vicinity", ru: "–ì—Ä–æ–∑–∞ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCTSRA": { en: "Thunderstorm with rain in vicinity", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCTSSN": { en: "Thunderstorm with snow in vicinity", ru: "–ì—Ä–æ–∑–∞ —Å–æ —Å–Ω–µ–≥–æ–º –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCTSGR": { en: "Thunderstorm with hail in vicinity", ru: "–ì—Ä–æ–∑–∞ —Å –≥—Ä–∞–¥–æ–º –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCTSPL": { en: "Thunderstorm with ice pellets in vicinity", ru: "–ì—Ä–æ–∑–∞ —Å –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },

  "VCSH": { en: "Showers in vicinity", ru: "–õ–∏–≤–Ω–∏ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCSHRA": { en: "Rain showers in vicinity", ru: "–õ–∏–≤–Ω–µ–≤–æ–π –¥–æ–∂–¥—å –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCSHSN": { en: "Snow showers in vicinity", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑–∞—Ä—è–¥—ã –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCSHGR": { en: "Hail showers in vicinity", ru: "–õ–∏–≤–Ω–µ–≤–æ–π –≥—Ä–∞–¥ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },

  "VCFG": { en: "Fog in vicinity", ru: "–¢—É–º–∞–Ω –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCBR": { en: "Mist in vicinity", ru: "–î—ã–º–∫–∞ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCFU": { en: "Smoke in vicinity", ru: "–î—ã–º –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCVA": { en: "Volcanic ash in vicinity", ru: "–í—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∏–π –ø–µ–ø–µ–ª –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCDU": { en: "Dust in vicinity", ru: "–ü—ã–ª—å –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCSA": { en: "Sand in vicinity", ru: "–ü–µ—Å–æ–∫ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCHZ": { en: "Haze in vicinity", ru: "–ú–≥–ª–∞ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },

  "VCPO": { en: "Dust/Sand whirls in vicinity", ru: "–ü—ã–ª—å–Ω—ã–µ/–ø–µ—Å—á–∞–Ω—ã–µ –≤–∏—Ö—Ä–∏ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCFC": { en: "Funnel cloud in vicinity", ru: "–í–æ—Ä–æ–Ω–∫–æ–æ–±—Ä–∞–∑–Ω–æ–µ –æ–±–ª–∞–∫–æ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCSS": { en: "Sandstorm in vicinity", ru: "–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCDS": { en: "Duststorm in vicinity", ru: "–ü—ã–ª—å–Ω–∞—è –±—É—Ä—è –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },

  "VCBLSN": { en: "Blowing snow in vicinity", ru: "–ù–∏–∑–æ–≤–∞—è –º–µ—Ç–µ–ª—å –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCDRSN": { en: "Drifting snow in vicinity", ru: "–ü–æ–∑–µ–º–æ–∫ –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCBLDU": { en: "Blowing dust in vicinity", ru: "–ü—ã–ª—å–Ω–∞—è –±—É—Ä—è –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCBLSA": { en: "Blowing sand in vicinity", ru: "–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },

  "VCFZRA": { en: "Freezing rain in vicinity", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π –¥–æ–∂–¥—å –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCFZDZ": { en: "Freezing drizzle in vicinity", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },
  "VCFZFG": { en: "Freezing fog in vicinity", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π —Ç—É–º–∞–Ω –≤ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" },

  // ===== –†–ï–î–ö–ò–ï –ò –û–°–û–ë–´–ï –ö–û–ú–ë–ò–ù–ê–¶–ò–ò =====
  "SHFZRA": { en: "Showers of freezing rain", ru: "–õ–∏–≤–Ω–µ–≤–æ–π –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π –¥–æ–∂–¥—å" },
  "SHFZDZ": { en: "Showers of freezing drizzle", ru: "–õ–∏–≤–Ω–µ–≤–∞—è –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–∞—è –º–æ—Ä–æ—Å—å" },
  "TSFZRA": { en: "Thunderstorm with freezing rain", ru: "–ì—Ä–æ–∑–∞ —Å –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–º –¥–æ–∂–¥—ë–º" },
  "TSFZDZ": { en: "Thunderstorm with freezing drizzle", ru: "–ì—Ä–æ–∑–∞ —Å –ø–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω–æ–π –º–æ—Ä–æ—Å—å—é" },

  "FGBR": { en: "Fog and Mist", ru: "–¢—É–º–∞–Ω —Å –¥—ã–º–∫–æ–π" },
  "BRFG": { en: "Mist and Fog", ru: "–î—ã–º–∫–∞ —Å —Ç—É–º–∞–Ω–æ–º" },
  "FUDU": { en: "Smoke and Dust", ru: "–î—ã–º —Å –ø—ã–ª—å—é" },
  "DUFU": { en: "Dust and Smoke", ru: "–ü—ã–ª—å —Å –¥—ã–º–æ–º" },
  "SADU": { en: "Sand and Dust", ru: "–ü–µ—Å–æ–∫ —Å –ø—ã–ª—å—é" },
  "DUSA": { en: "Dust and Sand", ru: "–ü—ã–ª—å —Å –ø–µ—Å–∫–æ–º" },

  // ===== –¢–†–û–ô–ù–´–ï –ö–û–ú–ë–ò–ù–ê–¶–ò–ò =====
  "TSRAGRSN": { en: "Thunderstorm with rain, hail and snow", ru: "–ì—Ä–æ–∑–∞ —Å –¥–æ–∂–¥—ë–º, –≥—Ä–∞–¥–æ–º –∏ —Å–Ω–µ–≥–æ–º" },
  "SHRASNPL": { en: "Showers of rain, snow and ice pellets", ru: "–õ–∏–≤–Ω–∏ —Å –¥–æ–∂–¥—ë–º, —Å–Ω–µ–≥–æ–º –∏ –ª–µ–¥—è–Ω–æ–π –∫—Ä—É–ø–æ–π" },
  "RASNSG": { en: "Rain, snow and snow grains", ru: "–î–æ–∂–¥—å, —Å–Ω–µ–≥ –∏ —Å–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  "DZRAPL": { en: "Drizzle, rain and ice pellets", ru: "–ú–æ—Ä–æ—Å—å, –¥–æ–∂–¥—å –∏ –ª–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },

  // ===== –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ï –ö–û–î–´ =====
  "AUTO": { en: "Automated observation", ru: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ" },
  "COR": { en: "Corrected observation", ru: "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ" },
  "NIL": { en: "No data", ru: "–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö" },
  "NSW": { en: "No significant weather", ru: "–ë–µ–∑ –æ—Å–æ–±—ã—Ö —è–≤–ª–µ–Ω–∏–π –ø–æ–≥–æ–¥—ã" },
  "TEMPO": { en: "Temporary conditions", ru: "–í—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å–ª–æ–≤–∏—è" },
  "BECMG": { en: "Becoming conditions", ru: "–û–∂–∏–¥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è" },

  // ===== –ò–ù–¢–ï–ù–°–ò–í–ù–û–°–¢–¨ –ë–ï–ó –Ø–í–õ–ï–ù–ò–ô =====
  "RE": { en: "Recent weather", ru: "–ù–µ–¥–∞–≤–Ω—è—è –ø–æ–≥–æ–¥–∞" },
  "+RE": { en: "Heavy recent weather", ru: "–°–∏–ª—å–Ω—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ —è–≤–ª–µ–Ω–∏—è" },
  "-RE": { en: "Light recent weather", ru: "–°–ª–∞–±—ã–µ –Ω–µ–¥–∞–≤–Ω–∏–µ —è–≤–ª–µ–Ω–∏—è" }
});

// ===== –ö–ê–†–¢–´ –î–õ–Ø –ö–û–ú–ü–û–ù–ï–ù–¢–ù–û–ì–û –ê–ù–ê–õ–ò–ó–ê =====
const weatherIntensityMap = {
  "+": { en: "Heavy", ru: "–°–∏–ª—å–Ω—ã–π" },
  "-": { en: "Light", ru: "–°–ª–∞–±—ã–π" }
};

const weatherDescriptorMap = {
  MI: { en: "Shallow", ru: "–ü–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–Ω—ã–π" },
  BC: { en: "Patches", ru: "–£—á–∞—Å—Ç–∫–∞–º–∏" },
  PR: { en: "Partial", ru: "–ß–∞—Å—Ç–∏—á–Ω—ã–π" },
  DR: { en: "Low drifting", ru: "–ü–æ–∑–µ–º–æ–∫" },
  BL: { en: "Blowing", ru: "–ù–∏–∑–æ–≤–∞—è –º–µ—Ç–µ–ª—å/–±—É—Ä—è" },
  SH: { en: "Showers", ru: "–õ–∏–≤–Ω–µ–≤—ã–π" },
  TS: { en: "Thunderstorm", ru: "–ì—Ä–æ–∑–∞" },
  FZ: { en: "Freezing", ru: "–ü–µ—Ä–µ–æ—Ö–ª–∞–∂–¥—ë–Ω–Ω—ã–π" },
  VC: { en: "In the vicinity", ru: "–í –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç–∏" }
};

const weatherPhenomenaMap = {
  // –û—Å–∞–¥–∫–∏
  DZ: { en: "Drizzle", ru: "–ú–æ—Ä–æ—Å—å" },
  RA: { en: "Rain", ru: "–î–æ–∂–¥—å" },
  SN: { en: "Snow", ru: "–°–Ω–µ–≥" },
  SG: { en: "Snow grains", ru: "–°–Ω–µ–∂–Ω—ã–µ –∑—ë—Ä–Ω–∞" },
  IC: { en: "Ice crystals", ru: "–õ–µ–¥—è–Ω—ã–µ –∫—Ä–∏—Å—Ç–∞–ª–ª—ã" },
  PL: { en: "Ice pellets", ru: "–õ–µ–¥—è–Ω–∞—è –∫—Ä—É–ø–∞" },
  GR: { en: "Hail", ru: "–ì—Ä–∞–¥" },
  GS: { en: "Small hail", ru: "–ú–µ–ª–∫–∏–π –≥—Ä–∞–¥" },
  UP: { en: "Unknown precipitation", ru: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –æ—Å–∞–¥–∫–∏" },

  // –ó–∞–º—É—Ç–Ω–µ–Ω–∏–µ
  BR: { en: "Mist", ru: "–î—ã–º–∫–∞" },
  FG: { en: "Fog", ru: "–¢—É–º–∞–Ω" },
  FU: { en: "Smoke", ru: "–î—ã–º" },
  VA: { en: "Volcanic ash", ru: "–í—É–ª–∫–∞–Ω–∏—á–µ—Å–∫–∏–π –ø–µ–ø–µ–ª" },
  DU: { en: "Dust", ru: "–ü—ã–ª—å" },
  SA: { en: "Sand", ru: "–ü–µ—Å–æ–∫" },
  HZ: { en: "Haze", ru: "–ú–≥–ª–∞" },
  PY: { en: "Spray", ru: "–í–æ–¥—è–Ω–∞—è –ø—ã–ª—å" },

  // –î—Ä—É–≥–∏–µ —è–≤–ª–µ–Ω–∏—è
  SQ: { en: "Squalls", ru: "–®–∫–≤–∞–ª—ã" },
  FC: { en: "Funnel cloud/Tornado", ru: "–°–º–µ—Ä—á/—Ç–æ—Ä–Ω–∞–¥–æ" },
  SS: { en: "Sandstorm", ru: "–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è" },
  DS: { en: "Duststorm", ru: "–ü—ã–ª—å–Ω–∞—è –±—É—Ä—è" },
  PO: { en: "Dust/Sand whirls", ru: "–ü—ã–ª—å–Ω—ã–µ/–ø–µ—Å—á–∞–Ω—ã–µ –≤–∏—Ö—Ä–∏" }
};

// –§—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ)
function decodeWeatherToken(token, language = 'ru') {
  const lang = language === 'en' ? 'en' : 'ru';

  if (weatherHybridDictionary[token]) {
    const { en, ru } = weatherHybridDictionary[token];
    return `<b>${token}</b><br>EN: ${en}<br>RU: ${ru}`;
  }

  // –†–∞–∑–±–æ—Ä –ø–æ —á–∞—Å—Ç—è–º (–µ—Å–ª–∏ –Ω–µ—Ç –≤ —Å–ª–æ–≤–∞—Ä–µ)
  let original = token;
  let intensity = "";
  let descriptor = "";
  let phenomena = "";

  if (token.length >= 2 && (token[0] === "+" || token[0] === "-")) {
    intensity = token[0];
    token = token.slice(1);
  }

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º VC –≤ –Ω–∞—á–∞–ª–µ
  if (token.startsWith("VC")) {
    descriptor = "VC";
    token = token.slice(2);
  } else {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥—Ä—É–≥–∏–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã
    for (let code of Object.keys(weatherDescriptorMap)) {
      if (token.startsWith(code)) {
        descriptor = code;
        token = token.slice(code.length);
        break;
      }
    }
  }

  // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –¥–≤–∞ —è–≤–ª–µ–Ω–∏—è
  let ph1 = token.slice(0, 2);
  let ph2 = token.slice(2, 4);

  if (weatherPhenomenaMap[ph1] && weatherPhenomenaMap[ph2]) {
    phenomena = `${weatherPhenomenaMap[ph1][lang]} –∏ ${weatherPhenomenaMap[ph2][lang]}`;
    let phenomenaEn = `${weatherPhenomenaMap[ph1].en} and ${weatherPhenomenaMap[ph2].en}`;

    let intensityText = weatherIntensityMap[intensity]?.[lang] || "";
    let intensityTextEn = weatherIntensityMap[intensity]?.en || "";
    let descriptorText = weatherDescriptorMap[descriptor]?.[lang] || "";
    let descriptorTextEn = weatherDescriptorMap[descriptor]?.en || "";

    return `<b>${original}</b><br>EN: ${intensityTextEn} ${descriptorTextEn} ${phenomenaEn}<br>RU: ${intensityText} ${descriptorText} ${phenomena}`;

  } else if (weatherPhenomenaMap[token]) {
    // –û–¥–Ω–æ —è–≤–ª–µ–Ω–∏–µ
    phenomena = weatherPhenomenaMap[token];

    let intensityText = weatherIntensityMap[intensity]?.[lang] || "";
    let intensityTextEn = weatherIntensityMap[intensity]?.en || "";
    let descriptorText = weatherDescriptorMap[descriptor]?.[lang] || "";
    let descriptorTextEn = weatherDescriptorMap[descriptor]?.en || "";

    return `<b>${original}</b><br>EN: ${intensityTextEn} ${descriptorTextEn} ${phenomena.en}<br>RU: ${intensityText} ${descriptorText} ${phenomena.ru}`;
  }

  return `<b>${original}</b><br><span style="color:gray">–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–æ–¥ / Unknown code</span>`;
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ)
function decodeWeatherCodes(input, language = 'ru') {
  if (!input) {
    return "–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –∫–æ–¥ / Enter at least one code";
  }

  const tokens = input.toUpperCase().trim().split(/\s+/);
  const outputs = tokens.map(token => decodeWeatherToken(token, language));
  return outputs.join("<hr>");
}
</script>

<!-- ========== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê 5A-3 ========== --><!-- ========== –ë–õ–û–ö 5B: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –î–ï–ö–û–î–ò–†–û–í–©–ò–ö–ê –ü–û–ì–û–î–ù–´–• –£–°–õ–û–í–ò–ô (–ò–ó–ú–ï–ù–ï–ù–ù–´–ô) ========== -->

<!-- –ó–∞–º–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->

<script>
// ========== –£–ü–†–û–©–ï–ù–ù–ê–Ø –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –î–ï–ö–û–î–ò–†–û–í–©–ò–ö–ê –ë–ï–ó –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ô ==========

// –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è updateWeatherDisplay() –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –±–ª–æ–∫–µ 6B-1
// –ó–¥–µ—Å—å –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ –¥—Ä—É–≥–∏—Ö –±–ª–æ–∫–∞—Ö

console.log('‚úÖ Weather decoder integration loaded (helper functions only)');
</script>

<!-- ========== –ö–û–ù–ï–¶ –ë–õ–û–ö–ê 5B ========== --><!-- ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö 6A: –î–ï–ö–û–î–ò–†–û–í–©–ò–ö –û–ë–õ–ê–ß–ù–û–°–¢–ò –° –ü–†–ï–î–õ–û–ì–ê–ú–ò ========== -->

<script>
// ========== –î–ï–ö–û–î–ò–†–û–í–©–ò–ö –û–ë–õ–ê–ß–ù–û–°–¢–ò METAR –° –ü–†–ï–î–õ–û–ì–ê–ú–ò ==========

class CloudDecoder {
    constructor() {
        this.language = 'en';
        this.initializeCloudCodes();
    }

    initializeCloudCodes() {
        // ===== –ö–û–î–´ –ü–û–ö–†–´–¢–ò–Ø –ù–ï–ë–ê =====
        this.coverageCodes = {
            'SKC': {
                en: 'Sky Clear',
                ru: '–Ø—Å–Ω–æ',
                description: {
                    en: 'No clouds below 12,000 feet',
                    ru: '–û–±–ª–∞–∫–æ–≤ –Ω–∏–∂–µ 12000 —Ñ—É—Ç–æ–≤ –Ω–µ—Ç'
                },
                priority: 1
            },
            'CLR': {
                en: 'Clear',
                ru: '–Ø—Å–Ω–æ',
                description: {
                    en: 'No clouds below 12,000 feet (automated)',
                    ru: '–û–±–ª–∞–∫–æ–≤ –Ω–∏–∂–µ 12000 —Ñ—É—Ç–æ–≤ –Ω–µ—Ç (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ)'
                },
                priority: 1
            },
            'NSC': {
                en: 'No Significant Cloud',
                ru: '–ù–µ—Ç –∑–Ω–∞—á–∏–º—ã—Ö –æ–±–ª–∞–∫–æ–≤',
                description: {
                    en: 'No cloud below 5,000 feet and no cumulonimbus or towering cumulus',
                    ru: '–û–±–ª–∞–∫–æ–≤ –Ω–∏–∂–µ 5000 —Ñ—É—Ç–æ–≤ –Ω–µ—Ç, –∫—É—á–µ–≤–æ-–¥–æ–∂–¥–µ–≤—ã—Ö –∏ –º–æ—â–Ω—ã—Ö –∫—É—á–µ–≤—ã—Ö –Ω–µ—Ç'
                },
                priority: 1
            },
            'NCD': {
                en: 'No Cloud Detected',
                ru: '–û–±–ª–∞–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã',
                description: {
                    en: 'No cloud detected by automated system',
                    ru: '–û–±–ª–∞–∫–∞ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å–∏—Å—Ç–µ–º–æ–π'
                },
                priority: 1
            },
            'FEW': {
                en: 'Few',
                ru: '–ù–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ',
                description: {
                    en: 'Cloud coverage 1/8 to 2/8 of sky',
                    ru: '–ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ–±–∞ 1/8-2/8'
                },
                priority: 2,
                coverage: '1-2 –æ–∫—Ç–∞'
            },
            'SCT': {
                en: 'Scattered',
                ru: '–†–∞—Å—Å–µ—è–Ω–Ω—ã–µ',
                description: {
                    en: 'Cloud coverage 3/8 to 4/8 of sky',
                    ru: '–ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ–±–∞ 3/8-4/8'
                },
                priority: 3,
                coverage: '3-4 –æ–∫—Ç–∞'
            },
            'BKN': {
                en: 'Broken',
                ru: '–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ',
                description: {
                    en: 'Cloud coverage 5/8 to 7/8 of sky',
                    ru: '–ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ–±–∞ 5/8-7/8'
                },
                priority: 4,
                coverage: '5-7 –æ–∫—Ç'
            },
            'OVC': {
                en: 'Overcast',
                ru: '–°–ø–ª–æ—à–Ω—ã–µ',
                description: {
                    en: 'Cloud coverage 8/8 of sky',
                    ru: '–ü–æ–∫—Ä—ã—Ç–∏–µ –Ω–µ–±–∞ 8/8'
                },
                priority: 5,
                coverage: '8 –æ–∫—Ç'
            },
            '///': {
                en: 'Cloud data not available',
                ru: '–î–∞–Ω–Ω—ã–µ –æ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã',
                description: {
                    en: 'Cloud information not available',
                    ru: '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞'
                },
                priority: 0
            }
        };

        // ===== –¢–ò–ü–´ –û–ë–õ–ê–ö–û–í =====
        this.cloudTypes = {
            'CB': {
                en: 'Cumulonimbus',
                ru: '–∫—É—á–µ–≤–æ-–¥–æ–∂–¥–µ–≤—ã–µ',
                description: {
                    en: 'Cumulonimbus clouds (thunderstorm clouds)',
                    ru: '–ö—É—á–µ–≤–æ-–¥–æ–∂–¥–µ–≤—ã–µ –æ–±–ª–∞–∫–∞ (–≥—Ä–æ–∑–æ–≤—ã–µ –æ–±–ª–∞–∫–∞)'
                },
                priority: 10,
                significant: true
            },
            'TCU': {
                en: 'Towering Cumulus',
                ru: '–º–æ—â–Ω—ã–µ –∫—É—á–µ–≤—ã–µ',
                description: {
                    en: 'Towering Cumulus clouds',
                    ru: '–ú–æ—â–Ω—ã–µ –∫—É—á–µ–≤—ã–µ –æ–±–ª–∞–∫–∞'
                },
                priority: 9,
                significant: true
            },
            'CBMAM': {
                en: 'Cumulonimbus Mammatus',
                ru: '–∫—É—á–µ–≤–æ-–¥–æ–∂–¥–µ–≤—ã–µ –≤—ã–º–µ–æ–±—Ä–∞–∑–Ω—ã–µ',
                description: {
                    en: 'Cumulonimbus with mammatus',
                    ru: '–ö—É—á–µ–≤–æ-–¥–æ–∂–¥–µ–≤—ã–µ —Å –≤—ã–º–µ–Ω–µ–æ–±—Ä–∞–∑–Ω—ã–º–∏ –≤—ã—Ä–æ—Å—Ç–∞–º–∏'
                },
                priority: 11,
                significant: true
            }
        };

        // ===== –û–°–û–ë–´–ï –ö–û–î–´ –û–ë–õ–ê–ß–ù–û–°–¢–ò =====
        this.specialCodes = {
            'CAVOK': {
                en: 'Ceiling and Visibility OK',
                ru: '–ü–æ—Ç–æ–ª–æ–∫ –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å –≤ –Ω–æ—Ä–º–µ',
                description: {
                    en: 'Visibility ‚â•10km, no cloud below 5,000ft, no significant weather',
                    ru: '–í–∏–¥–∏–º–æ—Å—Ç—å ‚â•10–∫–º, –æ–±–ª–∞–∫–æ–≤ –Ω–∏–∂–µ 5000 —Ñ—É—Ç–æ–≤ –Ω–µ—Ç, –æ—Å–æ–±—ã—Ö —è–≤–ª–µ–Ω–∏–π –Ω–µ—Ç'
                }
            },
            'VV': {
                en: 'Vertical Visibility',
                ru: '–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å',
                description: {
                    en: 'Sky obscured, vertical visibility only',
                    ru: '–ù–µ–±–æ –∑–∞–∫—Ä—ã—Ç–æ, —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å'
                }
            }
        };
    }

    // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —è–∑—ã–∫–∞
    setLanguage(lang) {
        this.language = lang;
    }

    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏
    decodeCloudiness(metarClouds) {
        if (!metarClouds || metarClouds.length === 0) {
            return {
                summary: this.language === 'ru' ? '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' : 'No data',
                layers: [],
                ceiling: null,
                significantClouds: [],
                weatherImpact: 'none'
            };
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã
        for (const cloud of metarClouds) {
            if (typeof cloud === 'string') {
                const specialResult = this.decodeSpecialCloudCode(cloud);
                if (specialResult) return specialResult;
            }
        }

        // –î–µ–∫–æ–¥–∏—Ä—É–µ–º —Å–ª–æ–∏ –æ–±–ª–∞–∫–æ–≤
        const layers = [];
        let ceiling = null;
        const significantClouds = [];

        for (const cloud of metarClouds) {
            if (typeof cloud === 'object' && cloud.coverage && cloud.height !== undefined) {
                const decodedLayer = this.decodeCloudLayer(cloud);
                if (decodedLayer) {
                    layers.push(decodedLayer);

                    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–æ—Ç–æ–ª–æ–∫ (–ø–µ—Ä–≤—ã–π —Å–ª–æ–π BKN –∏–ª–∏ OVC)
                    if (!ceiling && (cloud.coverage === 'BKN' || cloud.coverage === 'OVC')) {
                        ceiling = {
                            height: cloud.height,
                            coverage: decodedLayer.coverage,
                            type: decodedLayer.type
                        };
                    }

                    // –°–æ–±–∏—Ä–∞–µ–º –∑–Ω–∞—á–∏–º—ã–µ –æ–±–ª–∞–∫–∞
                    if (decodedLayer.significant) {
                        significantClouds.push(decodedLayer);
                    }
                }
            }
        }

        // –§–æ—Ä–º–∏—Ä—É–µ–º –∏—Ç–æ–≥–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
        const summary = this.generateCloudSummary(layers, ceiling, significantClouds);
        const weatherImpact = this.assessWeatherImpact(layers, significantClouds);

        return {
            summary: summary,
            layers: layers,
            ceiling: ceiling,
            significantClouds: significantClouds,
            weatherImpact: weatherImpact,
            details: this.generateDetailedDescription(layers)
        };
    }

    // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–æ–¥–æ–≤
    decodeSpecialCloudCode(code) {
        const upperCode = code.toUpperCase();

        if (this.specialCodes[upperCode]) {
            const special = this.specialCodes[upperCode];
            return {
                summary: special[this.language],
                layers: [{
                    code: upperCode,
                    description: special[this.language],
                    details: special.description[this.language],
                    special: true
                }],
                ceiling: null,
                significantClouds: [],
                weatherImpact: upperCode === 'CAVOK' ? 'good' : 'limited'
            };
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–¥—ã –ø–æ–∫—Ä—ã—Ç–∏—è –±–µ–∑ –≤—ã—Å–æ—Ç—ã
        if (this.coverageCodes[upperCode]) {
            const coverage = this.coverageCodes[upperCode];
            return {
                summary: coverage[this.language],
                layers: [{
                    code: upperCode,
                    description: coverage[this.language],
                    details: coverage.description[this.language],
                    special: true
                }],
                ceiling: null,
                significantClouds: [],
                weatherImpact: ['SKC', 'CLR', 'NSC'].includes(upperCode) ? 'good' : 'unknown'
            };
        }

        // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å
        const vvMatch = upperCode.match(/^VV(\d{3})$/);
        if (vvMatch) {
            const height = parseInt(vvMatch[1]) * 100;
            return {
                summary: this.language === 'ru' ?
                    `–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å ${height} —Ñ—É—Ç–æ–≤` :
                    `Vertical visibility ${height} feet`,
                layers: [{
                    code: upperCode,
                    height: height,
                    description: this.specialCodes['VV'][this.language],
                    details: this.specialCodes['VV'].description[this.language],
                    special: true
                }],
                ceiling: { height: height, coverage: 'Obscured', type: null },
                significantClouds: [],
                weatherImpact: 'poor'
            };
        }

        return null;
    }

    // –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Å–ª–æ—è –æ–±–ª–∞–∫–æ–≤
    decodeCloudLayer(cloud) {
        if (!cloud.coverage) return null;

        const coverage = this.coverageCodes[cloud.coverage];
        if (!coverage) return null;

        const layer = {
            code: `${cloud.coverage}${cloud.height ? String(Math.round(cloud.height/100)).padStart(3, '0') : ''}`,
            coverage: coverage[this.language],
            coverageCode: cloud.coverage,
            height: cloud.height,
            heightText: this.formatHeight(cloud.height),
            description: coverage.description[this.language],
            priority: coverage.priority,
            significant: false,
            type: null,
            typeDescription: null
        };

        // –î–æ–±–∞–≤–ª—è–µ–º —Ç–∏–ø –æ–±–ª–∞–∫–æ–≤ –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω
        if (cloud.type && this.cloudTypes[cloud.type]) {
            const cloudType = this.cloudTypes[cloud.type];
            layer.type = cloudType[this.language];
            layer.typeDescription = cloudType.description[this.language];
            layer.significant = cloudType.significant;
            layer.priority = Math.max(layer.priority, cloudType.priority);
        }

        return layer;
    }

    // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã—Å–æ—Ç—ã
    formatHeight(height) {
        if (height === null || height === undefined) return '';

        if (this.language === 'ru') {
            return `${height} —Ñ—Ç`;
        } else {
            return `${height} ft`;
        }
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫—Ä–∞—Ç–∫–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –° –ü–†–ï–î–õ–û–ì–ê–ú–ò –ò –ü–ï–†–ï–ù–û–°–ê–ú–ò –°–¢–†–û–ö
    generateCloudSummary(layers, ceiling, significantClouds) {
        if (layers.length === 0) {
            return this.language === 'ru' ? '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö' : 'No data';
        }

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–ª–æ–π
        const specialLayer = layers.find(layer => layer.special);
        if (specialLayer) {
            return this.formatFirstWordCapital(specialLayer.description);
        }

        // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –í–°–ï —Å–ª–æ–∏ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –° –ü–†–ï–î–õ–û–ì–ê–ú–ò –ò –ü–ï–†–ï–ù–û–°–ê–ú–ò
        const layerDescriptions = layers.map(layer => {
            const typeText = layer.type ? ` ${layer.type}` : '';
            const preposition = this.language === 'ru' ? '–Ω–∞' : 'at';

            if (layer.height && layer.height > 0) {
                return `${layer.coverage.toLowerCase()}${typeText} ${preposition} ${layer.heightText}`;
            } else {
                return `${layer.coverage.toLowerCase()}${typeText}`;
            }
        });

        // –ù–û–í–û–ï: –û–±—ä–µ–¥–∏–Ω—è–µ–º –≤—Å–µ —Å–ª–æ–∏ —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º —Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–ø—è—Ç–æ–π
        const allLayers = layerDescriptions.join(',<br>');

        return this.formatFirstWordCapital(allLayers);
    }

    // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —Å–ª–æ–≤–∞ —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π
    formatFirstWordCapital(text) {
        if (!text || text.trim() === '') return '';

        const trimmed = text.trim();
        return trimmed.charAt(0).toUpperCase() + trimmed.slice(1);
    }

    // –û—Ü–µ–Ω–∫–∞ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –ø–æ–ª–µ—Ç—ã
    assessWeatherImpact(layers, significantClouds) {
        // –ï—Å–ª–∏ –µ—Å—Ç—å CB –∏–ª–∏ TCU - –ø–ª–æ—Ö–∏–µ —É—Å–ª–æ–≤–∏—è
        if (significantClouds.some(cloud => cloud.type && (cloud.type.includes('–∫—É—á–µ–≤–æ-–¥–æ–∂–¥–µ–≤—ã–µ') || cloud.type.includes('Cumulonimbus')))) {
            return 'severe';
        }

        if (significantClouds.some(cloud => cloud.type && (cloud.type.includes('–º–æ—â–Ω—ã–µ –∫—É—á–µ–≤—ã–µ') || cloud.type.includes('Towering')))) {
            return 'moderate';
        }

        // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∏–∑–∫–∏–π –ø–æ—Ç–æ–ª–æ–∫
        const lowCeiling = layers.find(layer =>
            (layer.coverageCode === 'BKN' || layer.coverageCode === 'OVC') &&
            layer.height && layer.height < 1000
        );

        if (lowCeiling) return 'poor';

        // –ï—Å–ª–∏ –µ—Å—Ç—å —Å–ø–ª–æ—à–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å
        const overcast = layers.find(layer => layer.coverageCode === 'OVC');
        if (overcast) return 'moderate';

        // –ï—Å–ª–∏ –µ—Å—Ç—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å
        const broken = layers.find(layer => layer.coverageCode === 'BKN');
        if (broken) return 'fair';

        // –Ø—Å–Ω–æ –∏–ª–∏ –Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å
        return 'good';
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Ä–æ–±–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è
    generateDetailedDescription(layers) {
        if (layers.length === 0) return '';

        return layers.map(layer => {
            let detail = `${layer.coverage}`;

            if (layer.height) {
                detail += ` –Ω–∞ –≤—ã—Å–æ—Ç–µ ${layer.heightText}`;
            }

            if (layer.type) {
                detail += ` (${layer.type})`;
            }

            return detail;
        }).join('; ');
    }

    // –ü–∞—Ä—Å–∏–Ω–≥ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –∏–∑ —Å—Ç—Ä–æ–∫–∏ METAR
    parseCloudStringFromMETAR(metarString) {
        const clouds = [];
        const parts = metarString.split(/\s+/);

        for (const part of parts) {
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã
            if (['SKC', 'CLR', 'NSC', 'NCD', 'CAVOK'].includes(part)) {
                clouds.push(part);
                continue;
            }

            // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å
            if (part.match(/^VV\d{3}$/)) {
                clouds.push(part);
                continue;
            }

            // –û–±—ã—á–Ω—ã–µ —Å–ª–æ–∏ –æ–±–ª–∞–∫–æ–≤
            const cloudMatch = part.match(/^(FEW|SCT|BKN|OVC)(\d{3})(CB|TCU|CBMAM)?$/);
            if (cloudMatch) {
                const coverage = cloudMatch[1];
                const height = parseInt(cloudMatch[2]) * 100;
                const type = cloudMatch[3] || null;

                clouds.push({
                    coverage: coverage,
                    height: height,
                    type: type
                });
            }

            // –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å
            if (part === '///') {
                clouds.push(part);
            }
        }

        return clouds;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Ç–æ–ª–∫–∞ –≤ —Ñ—É—Ç–∞—Ö (–¥–ª—è –¥—Ä—É–≥–∏—Ö —Ä–∞—Å—á–µ—Ç–æ–≤)
    getCeilingHeight(decodedClouds) {
        if (!decodedClouds.ceiling) return null;
        return decodedClouds.ceiling.height;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∑–Ω–∞—á–∏–º—ã—Ö –æ–±–ª–∞–∫–æ–≤
    hasSignificantClouds(decodedClouds) {
        return decodedClouds.significantClouds && decodedClouds.significantClouds.length > 0;
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–∞–º–æ–≥–æ –Ω–∏–∑–∫–æ–≥–æ —Å–ª–æ—è
    getLowestLayer(decodedClouds) {
        if (!decodedClouds.layers || decodedClouds.layers.length === 0) return null;

        const layersWithHeight = decodedClouds.layers.filter(layer => layer.height !== null);
        if (layersWithHeight.length === 0) return null;

        return layersWithHeight.reduce((lowest, current) =>
            current.height < lowest.height ? current : lowest
        );
    }
}

// –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –¥–µ–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏
window.cloudDecoder = new CloudDecoder();

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
window.decodeCloudiness = function(clouds, language = 'ru') {
    window.cloudDecoder.setLanguage(language);
    return window.cloudDecoder.decodeCloudiness(clouds);
};

window.parseCloudStringFromMETAR = function(metarString) {
    return window.cloudDecoder.parseCloudStringFromMETAR(metarString);
};

console.log('‚úÖ Cloud decoder initialized with prepositions support');
console.log('üå§Ô∏è Available functions: decodeCloudiness(), parseCloudStringFromMETAR()');
</script>

<!-- ========== –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê 6A ========== --> <!-- ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö 6B-1: –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –° –ü–†–ï–î–õ–û–ì–ê–ú–ò –ò –í–ù–ì–û ========== -->

<script>
// ========== –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø –î–ï–ö–û–î–ò–†–û–í–©–ò–ö–ê –û–ë–õ–ê–ß–ù–û–°–¢–ò –° –ü–†–ï–î–õ–û–ì–ê–ú–ò ==========

// –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã —Å –¥–µ–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–æ–º –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏
function updateWeatherDisplay(data) {
  if (!data) return;

  console.log('üå§Ô∏è Updating weather display with cloud decoder:', data);

  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–¥ METAR
  document.getElementById('metarCode').textContent = data.raw;

  // –î–ê–í–õ–ï–ù–ò–ï QNH (–∫–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ)
  if (data.pressure && data.pressure > 0) {
    const pressure = convertPressure(data.pressure);
    const allWeatherRows = document.querySelectorAll('.weather-row');
    let hpaField = null, mmhgField = null, inhgField = null;
    let tempField = null, dewField = null;

    allWeatherRows.forEach((row) => {
      const label = row.querySelector('.section-label');
      const value = row.querySelector('.data-value');
      const units = row.querySelector('.units');

      if (!value || !units) return;

      const labelText = label ? label.textContent.trim() : '';
      const unitsText = units.textContent.trim();

      if (unitsText === 'hPa' && !hpaField) {
        hpaField = value;
      } else if (unitsText === 'mmHg' && !mmhgField) {
        mmhgField = value;
      } else if (unitsText === 'inHg' && !inhgField) {
        inhgField = value;
      } else if (unitsText === '¬∞C' && labelText === 'T' && !tempField) {
        tempField = value;
      } else if (unitsText === '¬∞C' && labelText === 'DP' && !dewField) {
        dewField = value;
      }
    });

    if (hpaField) hpaField.textContent = pressure.hpa;
    if (mmhgField) mmhgField.textContent = pressure.mmhg;
    if (inhgField) inhgField.textContent = pressure.inhg;
    if (tempField) tempField.textContent = data.temperature !== null ? data.temperature : '-';
    if (dewField) dewField.textContent = data.dewpoint !== null ? data.dewpoint : '-';

  } else {
    document.querySelectorAll('.weather-row').forEach(row => {
      const units = row.querySelector('.units');
      const value = row.querySelector('.data-value');
      if (units && value && ['hPa', 'mmHg', 'inHg'].includes(units.textContent.trim())) {
        value.textContent = '-';
      }
    });
  }

  // –í–∏–¥–∏–º–æ—Å—Ç—å MOR
  const visEl = document.querySelector('#morLabel').parentElement.querySelector('.data-value');
  if (visEl) {
    visEl.textContent = data.visibility || '-';
  }

  // –í–ï–¢–ï–†
  const windDir = data.wind.calm ? 0 : data.wind.direction;
  const windSpeed = data.wind.calm ? 0 : data.wind.speed;

  document.querySelectorAll('.wind-direction').forEach(el => {
    el.textContent = data.wind.calm ? '---¬∞' : `${windDir.toString().padStart(3, '0')}¬∞`;
  });

  document.querySelectorAll('.wind-speed').forEach(el => {
    el.textContent = windSpeed.toString();
  });

  // ========== –ù–û–í–û–ï: –£–õ–£–ß–®–ï–ù–ù–û–ï –î–ï–ö–û–î–ò–†–û–í–ê–ù–ò–ï –û–ë–õ–ê–ß–ù–û–°–¢–ò –° –ü–†–ï–î–õ–û–ì–ê–ú–ò ==========
  const currentLanguage = document.getElementById('language').value === 'ru' ? 'ru' : 'en';

  // –î–µ–∫–æ–¥–∏—Ä—É–µ–º –æ–±–ª–∞—á–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é –Ω–æ–≤–æ–≥–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞
  const decodedClouds = decodeCloudiness(data.clouds, currentLanguage);
  console.log('‚òÅÔ∏è Decoded clouds with prepositions:', decodedClouds);

  // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –° –ü–†–ï–î–õ–û–ì–ê–ú–ò –ò HTML –ü–ï–†–ï–ù–û–°–ê–ú–ò
  const skyEl = document.querySelector('#skyConditionLabel').parentElement.querySelector('.data-value');
  if (skyEl) {
    skyEl.innerHTML = decodedClouds.summary; // –ò–ó–ú–ï–ù–ï–ù–û: –∏—Å–ø–æ–ª—å–∑—É–µ–º innerHTML –¥–ª—è <br>
    console.log(`‚òÅÔ∏è Sky condition with prepositions and line breaks: ${decodedClouds.summary}`);
  }

  // ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ï –û–¢–û–ë–†–ê–ñ–ï–ù–ò–ï –í–ù–ì–û (–°–ê–ú–ê–Ø –ù–ò–ñ–ù–Ø–Ø –û–ë–õ–ê–ß–ù–û–°–¢–¨) –í –§–£–¢–ê–• ==========
  const cloudBaseEl = document.querySelector('#qbbLabel').parentElement.querySelector('.data-value');
  const cloudBaseUnitsEl = document.querySelector('#qbbLabel').parentElement.querySelector('.units');
  if (cloudBaseEl && cloudBaseUnitsEl) {
    let cloudBaseText = '-';

    // –ò—â–µ–º –°–ê–ú–´–ô –ù–ò–ó–ö–ò–ô —Å–ª–æ–π –æ–±–ª–∞–∫–æ–≤ (–ª—é–±–æ–π —Ç–∏–ø) –¥–ª—è –í–ù–ì–û
    const lowestCloudLayer = decodedClouds.layers
      .filter(layer => layer.height && layer.height > 0 &&
                      ['BKN', 'OVC', 'SCT', 'FEW'].includes(layer.coverageCode))
      .sort((a, b) => a.height - b.height)[0];

    if (lowestCloudLayer) {
      cloudBaseText = lowestCloudLayer.height.toString();
      console.log(`‚òÅÔ∏è Lowest cloud base (–í–ù–ì–û): ${cloudBaseText} feet`);
    } else if (decodedClouds.layers.length > 0) {
      // –ï—Å–ª–∏ –µ—Å—Ç—å –æ–±–ª–∞—á–Ω–æ—Å—Ç—å –Ω–æ –Ω–µ—Ç –∏–∑–º–µ—Ä–∏–º–æ–π –≤—ã—Å–æ—Ç—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä SKC, CLR)
      const specialLayer = decodedClouds.layers.find(layer => layer.special);
      if (specialLayer && ['SKC', 'CLR', 'NSC', 'NCD'].some(code => specialLayer.code.includes(code))) {
        cloudBaseText = currentLanguage === 'ru' ? '–Ø—Å–Ω–æ' : 'Clear';
        console.log(`‚òÅÔ∏è Clear skies (–í–ù–ì–û): ${cloudBaseText}`);
      } else if (specialLayer && specialLayer.code.includes('VV')) {
        // –î–ª—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã—Å–æ—Ç—É
        cloudBaseText = specialLayer.height ? specialLayer.height.toString() : 'VV';
        console.log(`‚òÅÔ∏è Vertical visibility (–í–ù–ì–û): ${cloudBaseText}`);
      }
    }

    cloudBaseEl.textContent = cloudBaseText;

    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ–¥–∏–Ω–∏—Ü—ã –¥–ª—è –í–ù–ì–û –≤ —Ñ—É—Ç–∞—Ö
    cloudBaseUnitsEl.textContent = currentLanguage === 'ru' ? '—Ñ—Ç' : 'ft';
  }

  // ========== –ù–û–í–û–ï: –ò–ó–í–õ–ï–ß–ï–ù–ò–ï QBB –ò–ó –†–ï–ú–ê–†–û–ö ==========
  const qbbFromRemarks = extractQBBFromRemarks(data.raw, currentLanguage);
  if (qbbFromRemarks !== null) {
    // –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω QBB –≤ —Ä–µ–º–∞—Ä–∫–∞—Ö, –∑–∞–º–µ–Ω—è–µ–º –í–ù–ì–û –Ω–∞ QBB
    if (cloudBaseEl && cloudBaseUnitsEl) {
      cloudBaseEl.textContent = qbbFromRemarks.toString();
      cloudBaseUnitsEl.textContent = currentLanguage === 'ru' ? '–º' : 'm'; // QBB –≤—Å–µ–≥–¥–∞ –≤ –º–µ—Ç—Ä–∞—Ö
      console.log(`‚òÅÔ∏è QBB from remarks: ${qbbFromRemarks} meters (overrides –í–ù–ì–û)`);
    }
  }

  // –î–ï–ö–û–î–ò–†–û–í–ê–ù–ò–ï –ü–û–ì–û–î–ù–´–• –Ø–í–õ–ï–ù–ò–ô (–æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ)
  const weatherEl = document.getElementById('weatherPhenomena');
  if (weatherEl) {
    if (data.weather && data.weather.length > 0) {
      const decodedWeather = data.weather.map(weatherCode => {
        let decoded;
        if (weatherHybridDictionary[weatherCode]) {
          decoded = weatherHybridDictionary[weatherCode][currentLanguage];
        } else {
          decoded = decodeWeatherComponentAnalysis(weatherCode, currentLanguage);
          decoded = decoded || weatherCode;
        }
        return decoded;
      });

      const finalWeatherText = formatWeatherList(decodedWeather);
      weatherEl.textContent = finalWeatherText;

    } else {
      weatherEl.textContent = '-';
    }
  }

  // –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  updateSunriseSunset();
  if (currentRunwayData) {
    initializeCompass('compass');
    initializeCompass('compass2');
    updateWindComponents();
  }
  updateQFEForSelectedRunways();

  console.log('‚úÖ Weather display updated with cloud decoding and prepositions');
}
</script>

<!-- ========== –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê 6B-1 ========== --><!-- ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö 6B-2A: –ü–û–õ–ù–´–ô –ü–ê–†–°–ï–† METAR - –¢–û–õ–¨–ö–û –û–°–ù–û–í–ù–ê–Ø –ß–ê–°–¢–¨ ========== -->

<script>
// ========== –ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø –ò–ó–í–õ–ï–ß–ï–ù–ò–Ø –¢–û–õ–¨–ö–û –û–°–ù–û–í–ù–û–ô –ß–ê–°–¢–ò METAR ==========

function extractMainMETARPart(metarString) {
    if (!metarString) return '';

    let mainPart = metarString.trim();

    console.log('üîß Extracting MAIN METAR part from:', metarString);

    // 1. –£–¥–∞–ª—è–µ–º —Ä–µ–º–∞—Ä–∫–∏ RMK - –≤—Å–µ –ø–æ—Å–ª–µ "RMK"
    const rmkIndex = mainPart.indexOf(' RMK ');
    if (rmkIndex !== -1) {
        mainPart = mainPart.substring(0, rmkIndex);
        console.log('‚úÇÔ∏è Cut RMK section');
    }

    // 2. –£–¥–∞–ª—è–µ–º –ø—Ä–æ–≥–Ω–æ–∑—ã TEMPO - –≤—Å–µ –ø–æ—Å–ª–µ "TEMPO"
    const tempoIndex = mainPart.indexOf(' TEMPO ');
    if (tempoIndex !== -1) {
        mainPart = mainPart.substring(0, tempoIndex);
        console.log('‚úÇÔ∏è Cut TEMPO section');
    }

    // 3. –£–¥–∞–ª—è–µ–º –ø—Ä–æ–≥–Ω–æ–∑—ã BECMG - –≤—Å–µ –ø–æ—Å–ª–µ "BECMG"
    const becmgIndex = mainPart.indexOf(' BECMG ');
    if (becmgIndex !== -1) {
        mainPart = mainPart.substring(0, becmgIndex);
        console.log('‚úÇÔ∏è Cut BECMG section');
    }

    // 4. –£–¥–∞–ª—è–µ–º –ø—Ä–æ–≥–Ω–æ–∑—ã PROB - –≤—Å–µ –ø–æ—Å–ª–µ "PROB"
    const probIndex = mainPart.indexOf(' PROB');
    if (probIndex !== -1) {
        mainPart = mainPart.substring(0, probIndex);
        console.log('‚úÇÔ∏è Cut PROB section');
    }

    // 5. –£–¥–∞–ª—è–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏–µ –∑–Ω–∞–∫ "="
    mainPart = mainPart.replace(/\s*=\s*$/, '');

    // 6. –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
    mainPart = mainPart.replace(/\s+/g, ' ').trim();

    console.log('‚úÖ Main METAR part extracted:', mainPart);
    return mainPart;
}

// ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ü–ê–†–°–ï–† METAR - –¢–û–õ–¨–ö–û –û–°–ù–û–í–ù–ê–Ø –ß–ê–°–¢–¨ ==========

function parseMetar(metarString) {
    if (!metarString) return null;

    console.log('üå¶Ô∏è Parsing METAR (FIXED - main part only):', metarString);

    // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò–∑–≤–ª–µ–∫–∞–µ–º –¢–û–õ–¨–ö–û –æ—Å–Ω–æ–≤–Ω—É—é —á–∞—Å—Ç—å METAR
    const mainMETAR = extractMainMETARPart(metarString);
    console.log('üéØ Processing ONLY main METAR part:', mainMETAR);

    const parts = mainMETAR.split(' ');
    const data = {
        raw: metarString, // –°–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π METAR –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        icao: parts[0],
        time: '',
        wind: { direction: 0, speed: 0, gust: 0, variable: false, calm: false },
        visibility: 0,
        weather: [],
        clouds: [],
        temperature: null,
        dewpoint: null,
        pressure: null
    };

    for (let i = 0; i < parts.length; i++) {
        const part = parts[i];

        // –í—Ä–µ–º—è
        if (part.match(/^\d{6}Z$/)) {
            data.time = part;
            console.log(`üïê Time: ${part}`);
        }

        // –í–µ—Ç–µ—Ä
        const windMatch = part.match(/^(\d{3})(\d{2,3})(G(\d{2,3}))?(KT|MPS)$/);
        if (windMatch) {
            data.wind.direction = parseInt(windMatch[1]);
            data.wind.speed = parseInt(windMatch[2]);
            data.wind.gust = windMatch[4] ? parseInt(windMatch[4]) : 0;

            if (windMatch[5] === 'MPS') {
                data.wind.speed = Math.round(data.wind.speed * 1.944);
                if (data.wind.gust > 0) {
                    data.wind.gust = Math.round(data.wind.gust * 1.944);
                }
            }

            console.log(`üí® Wind: ${data.wind.direction}¬∞/${data.wind.speed}kt (gust: ${data.wind.gust})`);
        }

        // –®—Ç–∏–ª—å
        if (part === '00000KT' || part === '00000MPS') {
            data.wind.calm = true;
            console.log('üí® Wind: CALM');
        }

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ—Ç–µ—Ä
        if (part.match(/^\d{3}V\d{3}$/)) {
            data.wind.variable = true;
            console.log('üí® Wind: VARIABLE');
        }

        // –í–∏–¥–∏–º–æ—Å—Ç—å
        if (part.match(/^\d{4}$/) && parseInt(part) >= 100) {
            data.visibility = parseInt(part);
            console.log(`üëÅÔ∏è Visibility: ${data.visibility}m`);
        }

        // CAVOK
        if (part === 'CAVOK') {
            data.visibility = 10000;
            console.log('üëÅÔ∏è Visibility: CAVOK (10000m)');
        }

        // –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ —Ç–æ—á–∫–∞ —Ä–æ—Å—ã
        const tempMatch = part.match(/^(M?\d{1,2})\/(M?\d{1,2})$/);
        if (tempMatch) {
            let tempStr = tempMatch[1];
            let dewStr = tempMatch[2];

            if (tempStr.startsWith('M')) {
                data.temperature = -parseInt(tempStr.substring(1));
            } else {
                data.temperature = parseInt(tempStr);
            }

            if (dewStr.startsWith('M')) {
                data.dewpoint = -parseInt(dewStr.substring(1));
            } else {
                data.dewpoint = parseInt(dewStr);
            }

            console.log(`üå°Ô∏è Temperature: ${data.temperature}¬∞C, Dewpoint: ${data.dewpoint}¬∞C`);
        }

        // –î–∞–≤–ª–µ–Ω–∏–µ QNH
        if (part.startsWith('Q') && part.length >= 5) {
            const qnhMatch = part.match(/Q(\d{4})/);
            if (qnhMatch) {
                const pressureValue = parseInt(qnhMatch[1]);
                data.pressure = pressureValue;
                console.log(`‚úÖ PRESSURE: ${part} ‚Üí ${data.pressure} hPa`);
            }
        }

        if (part.startsWith('A') && part.length >= 5) {
            const altimeterMatch = part.match(/A(\d{4})/);
            if (altimeterMatch) {
                const inchesHg = parseInt(altimeterMatch[1]) / 100;
                data.pressure = Math.round(inchesHg / 0.02953);
                console.log(`‚úÖ PRESSURE: ${part} ‚Üí ${inchesHg}" Hg = ${data.pressure} hPa`);
            }
        }

        // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∫–æ–¥—ã –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ - –¢–û–õ–¨–ö–û –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏
        if (['SKC', 'CLR', 'NSC', 'NCD', 'CAVOK'].includes(part)) {
            data.clouds.push(part);
            console.log(`‚òÅÔ∏è Special cloud code: ${part}`);
            continue;
        }

        // –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å - –¢–û–õ–¨–ö–û –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏
        if (part.match(/^VV\d{3}$/)) {
            data.clouds.push(part);
            console.log(`‚òÅÔ∏è Vertical visibility: ${part}`);
            continue;
        }

        // –û–±—ã—á–Ω—ã–µ —Å–ª–æ–∏ –æ–±–ª–∞–∫–æ–≤ - –¢–û–õ–¨–ö–û –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏
        const cloudMatch = part.match(/^(FEW|SCT|BKN|OVC)(\d{3})(CB|TCU|CBMAM)?$/);
        if (cloudMatch) {
            const coverage = cloudMatch[1];
            const height = parseInt(cloudMatch[2]) * 100;
            const type = cloudMatch[3] || null;

            data.clouds.push({
                coverage: coverage,
                height: height,
                type: type
            });

            console.log(`‚òÅÔ∏è Cloud layer: ${coverage} at ${height}ft${type ? ` (${type})` : ''}`);
            continue;
        }

        // –ù–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –æ–±–ª–∞—á–Ω–æ—Å—Ç—å - –¢–û–õ–¨–ö–û –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏
        if (part === '///') {
            data.clouds.push(part);
            console.log('‚òÅÔ∏è Undefined cloud data: ///');
            continue;
        }

        // –ü–æ–≥–æ–¥–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è - –¢–û–õ–¨–ö–û –∏–∑ –æ—Å–Ω–æ–≤–Ω–æ–π —á–∞—Å—Ç–∏
        if (isWeatherPhenomenon(part)) {
            data.weather.push(part);
            console.log(`üåßÔ∏è Weather phenomenon: ${part}`);
        }
    }

    if (data.pressure === null || data.pressure === 0) {
        console.error(`‚ùå NO PRESSURE FOUND IN MAIN METAR PART: "${mainMETAR}"`);
    } else {
        console.log(`üéØ PRESSURE FROM MAIN PART: ${data.pressure} hPa`);
    }

    console.log('üéØ Final parsed data (main part only):', {
        icao: data.icao,
        pressure: data.pressure,
        temperature: data.temperature,
        dewpoint: data.dewpoint,
        visibility: data.visibility,
        weather: data.weather,
        clouds: data.clouds.length,
        wind: `${data.wind.direction}¬∞/${data.wind.speed}kt`
    });

    return data;
}

// –§—É–Ω–∫—Ü–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥–Ω—ã—Ö —è–≤–ª–µ–Ω–∏–π (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
function isWeatherPhenomenon(part) {
    if (!part || part.length < 2) return false;

    // –°–¢–†–û–ì–û –∏—Å–∫–ª—é—á–∞–µ–º –≤—Å–µ, —á—Ç–æ –ù–ï —è–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—É—â–∏–º–∏ –ø–æ–≥–æ–¥–Ω—ã–º–∏ —è–≤–ª–µ–Ω–∏—è–º–∏
    if (part.match(/^\d{4}Z?$/)) return false; // –≤—Ä–µ–º—è
    if (part.match(/^[A-Z]{4}$/)) return false; // ICAO –∫–æ–¥—ã –∞—ç—Ä–æ–ø–æ—Ä—Ç–æ–≤
    if (part.match(/^Q\d{4}$/)) return false; // –¥–∞–≤–ª–µ–Ω–∏–µ QNH
    if (part.match(/^A\d{4}$/)) return false; // –¥–∞–≤–ª–µ–Ω–∏–µ –≤ –¥—é–π–º–∞—Ö
    if (part.match(/^M?\d{2}\/M?\d{2}$/)) return false; // —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞/—Ç–æ—á–∫–∞ —Ä–æ—Å—ã
    if (part.match(/^\d{3}\d{2}(G\d{2})?KT$/)) return false; // –≤–µ—Ç–µ—Ä –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ/—Å–∫–æ—Ä–æ—Å—Ç—å
    if (part.match(/^\d{3}V\d{3}$/)) return false; // –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–π –≤–µ—Ç–µ—Ä
    if (part.match(/^00000KT$/)) return false; // —à—Ç–∏–ª—å
    if (part.match(/^(FEW|SCT|BKN|OVC)\d{3}(CB|TCU|CBMAM)?$/)) return false; // –æ–±–ª–∞—á–Ω–æ—Å—Ç—å
    if (part.match(/^VV\d{3}$/)) return false; // –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å
    if (part.match(/^R\d{2}[LRC]?\/\d{4}(V\d{4})?(FT)?[UDN]?$/)) return false; // RVR
    if (part.match(/^\d{4}$/)) return false; // –≤–∏–¥–∏–º–æ—Å—Ç—å –≤ –º–µ—Ç—Ä–∞—Ö
    if (part.match(/^\d{1,2}SM$/)) return false; // –≤–∏–¥–∏–º–æ—Å—Ç—å –≤ –º–∏–ª—è—Ö

    // –ò—Å–∫–ª—é—á–∞–µ–º —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–¥—ã
    if (['SKC', 'CLR', 'NSC', 'NCD', 'CAVOK', 'NOSIG', 'AUTO', 'COR'].includes(part)) return false;

    // –¢–û–õ–¨–ö–û —Ç–µ–∫—É—â–∏–µ –ø–æ–≥–æ–¥–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è - –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç—Ä–æ–≥–æ –ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É WMO
    if (part.match(/^[-+VC](MI|PR|BC|DR|BL|SH|TS|FZ)?(DZ|RA|SN|SG|IC|PL|GR|GS|UP|BR|FG|FU|VA|DU|SA|HZ|PY|SQ|FC|SS|DS|PO)+$/)) return true;
    if (part.match(/^(MI|PR|BC|DR|BL|SH|TS|FZ)(DZ|RA|SN|SG|IC|PL|GR|GS|UP|BR|FG|FU|VA|DU|SA|HZ|PY|SQ|FC|SS|DS|PO)+$/)) return true;
    if (part.match(/^(DZ|RA|SN|SG|IC|PL|GR|GS|UP|BR|FG|FU|VA|DU|SA|HZ|PY|SQ|FC|SS|DS|PO)+$/)) return true;
    if (part.match(/^[-+](DZ|RA|SN|SG|IC|PL|GR|GS|UP|BR|FG|FU|VA|DU|SA|HZ|PY|SQ|FC|SS|DS|PO)+$/)) return true;

    return false;
}

console.log('‚úÖ METAR parser fixed - only main part processed for weather and clouds');
</script>

<!-- ========== –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê 6B-2A ==========><!-- ========== –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ô –ë–õ–û–ö 6B-2B: –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ========== -->

<script>
// ========== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–ï–ö–û–î–ò–†–û–í–©–ò–ö–ê ==========

// –£–ü–†–û–©–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
function decodeWeatherComponentAnalysis(weatherCode, language = 'ru') {
  if (!weatherCode || weatherCode.trim() === '') return '';

  const code = weatherCode.trim().toUpperCase();
  let remainingCode = code;
  const decodedParts = [];

  // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å
  if (remainingCode.startsWith('-')) {
    const intensityText = weatherIntensityMap['-'][language];
    decodedParts.push(intensityText.toLowerCase());
    remainingCode = remainingCode.substring(1);
  } else if (remainingCode.startsWith('+')) {
    const intensityText = weatherIntensityMap['+'][language];
    decodedParts.push(intensityText.toLowerCase());
    remainingCode = remainingCode.substring(1);
  } else if (remainingCode.startsWith('VC')) {
    const vicinityText = weatherDescriptorMap['VC'][language];
    decodedParts.push(vicinityText.toLowerCase());
    remainingCode = remainingCode.substring(2);
  }

  // 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã
  for (const [descriptor, translations] of Object.entries(weatherDescriptorMap)) {
    if (descriptor !== 'VC' && remainingCode.startsWith(descriptor)) {
      decodedParts.push(translations[language].toLowerCase());
      remainingCode = remainingCode.substring(descriptor.length);
      break;
    }
  }

  // 3. –ü–∞—Ä—Å–∏–º –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —è–≤–ª–µ–Ω–∏—è
  const foundPhenomena = [];
  while (remainingCode.length >= 2) {
    let found = false;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–≤—É—Ö–±—É–∫–≤–µ–Ω–Ω—ã–µ –∫–æ–¥—ã
    for (const [phenomCode, translations] of Object.entries(weatherPhenomenaMap)) {
      if (remainingCode.startsWith(phenomCode)) {
        foundPhenomena.push(translations[language]);
        remainingCode = remainingCode.substring(phenomCode.length);
        found = true;
        break;
      }
    }

    if (!found) break;
  }

  // 4. –°–æ–±–∏—Ä–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  if (foundPhenomena.length > 0) {
    if (foundPhenomena.length === 1) {
      decodedParts.push(foundPhenomena[0]);
    } else {
      // –ù–µ—Å–∫–æ–ª—å–∫–æ —è–≤–ª–µ–Ω–∏–π - —Å–æ–µ–¥–∏–Ω—è–µ–º —á–µ—Ä–µ–∑ "–∏"/"and"
      const conjunction = language === 'ru' ? ' –∏ ' : ' and ';
      const combinedPhenomena = foundPhenomena.join(conjunction);
      decodedParts.push(combinedPhenomena);
    }
  }

  const result = decodedParts.join(' ');
  return result || code;
}

// –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ–≥–æ–¥—ã
function formatWeatherText(text) {
  if (!text || text.trim() === '') return '';

  const trimmed = text.trim();
  return trimmed.charAt(0).toUpperCase() + trimmed.slice(1).toLowerCase();
}

// –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—Å–µ–≥–æ —Å–ø–∏—Å–∫–∞ –ø–æ–≥–æ–¥–Ω—ã—Ö —è–≤–ª–µ–Ω–∏–π
function formatWeatherList(weatherArray) {
  if (!weatherArray || weatherArray.length === 0) return '';

  const formattedList = weatherArray.map((weather, index) => {
    if (index === 0) {
      return formatWeatherText(weather);
    } else {
      return weather.trim().toLowerCase();
    }
  }).join(', ');

  return formattedList;
}

// –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Å —É—á–µ—Ç–æ–º –Ω–æ–≤–æ–≥–æ –¥–µ–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏
function clearAllWeatherData() {
  document.querySelectorAll('.weather-row .data-value').forEach(el => {
    if (!el.classList.contains('pressure-secondary')) {
      el.textContent = '-';
    }
  });
  document.querySelectorAll('.pressure-secondary').forEach(el => el.textContent = '-');

  // –û—á–∏—â–∞–µ–º –ø–æ–≥–æ–¥–Ω—ã–µ —è–≤–ª–µ–Ω–∏—è
  const weatherEl = document.getElementById('weatherPhenomena');
  if (weatherEl) {
    weatherEl.textContent = '-';
  }

  // –û—á–∏—â–∞–µ–º –æ–±–ª–∞—á–Ω–æ—Å—Ç—å
  document.querySelector('#skyConditionLabel').parentElement.querySelector('.data-value').textContent = '-';

  // –û—á–∏—â–∞–µ–º –Ω–∏–∂–Ω—é—é –≥—Ä–∞–Ω–∏—Ü—É –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –µ–¥–∏–Ω–∏—Ü—ã
  const qbbEl = document.querySelector('#qbbLabel').parentElement.querySelector('.data-value');
  const qbbUnitsEl = document.querySelector('#qbbLabel').parentElement.querySelector('.units');
  if (qbbEl) qbbEl.textContent = '-';
  if (qbbUnitsEl) qbbUnitsEl.textContent = '–º'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –º–µ—Ç—Ä—ã –¥–ª—è QBB

  document.getElementById('metarCode').textContent = '-';

  document.querySelectorAll('.lateral-component .data-value').forEach(el => el.textContent = '-');
  document.querySelectorAll('.headwind-component .data-value').forEach(el => el.textContent = '-');
  document.querySelectorAll('.friction-coefficient .data-value').forEach(el => el.textContent = '-');

  document.querySelectorAll('.wind-direction').forEach(el => el.textContent = '---¬∞');
  document.querySelectorAll('.wind-speed').forEach(el => el.textContent = '-');

  document.querySelectorAll('.compass-info .rvr-row .data-value').forEach(el => el.textContent = '-');
  document.querySelectorAll('.qfe-row, .elev-row').forEach(row => row.remove());
  document.querySelectorAll('.forecast-value').forEach(el => el.textContent = '-');

  // –û—á–∏—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –≤–æ—Å—Ö–æ–¥–∞/–∑–∞—Ö–æ–¥–∞
  document.getElementById('sunrise').textContent = '-';
  document.getElementById('sunset').textContent = '-';
  window.airportData = null;

  console.log('üßπ All weather data cleared including enhanced cloud data');
}

// –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —è–∑—ã–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–µ–∫–æ–¥–∏—Ä–æ–≤—â–∏–∫–∞ –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏
function applyLanguage(lang) {
  // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –º–µ—Ç–∫–∏
  if (lang === 'ru') {
    document.getElementById('timeLabel').textContent = '–í—Ä–µ–º—è UTC';
    document.getElementById('sunriseLabel').textContent = '–í–æ—Å—Ö–æ–¥';
    document.getElementById('sunsetLabel').textContent = '–ó–∞—Ö–æ–¥';
    document.getElementById('weatherLabel').textContent = '–Ø–≤–ª–µ–Ω–∏—è –ø–æ–≥–æ–¥—ã';
    document.getElementById('morLabel').textContent = '–í–∏–¥–∏–º–æ—Å—Ç—å';
    document.getElementById('qbbLabel').textContent = '–í–ù–ì–û';
    document.getElementById('skyConditionLabel').textContent = '–û–±–ª–∞—á–Ω–æ—Å—Ç—å';
    document.getElementById('forecastLabel').textContent = '–ü—Ä–æ–≥–Ω–æ–∑ –ø–æ–≥–æ–¥—ã';
    document.getElementById('specialLabel').textContent = '–û—Å–æ–±—ã–µ —É—Å–ª–æ–≤–∏—è';
    document.getElementById('lateralLabel1').textContent = '–ë–æ–∫–æ–≤–∞—è';
    document.getElementById('headwindLabel1').textContent = '–í—Å—Ç—Ä–µ—á–Ω–∞—è';
    document.getElementById('frictionLabel1').textContent = '–ö–°—Ü';
    document.getElementById('lateralLabel2').textContent = '–ë–æ–∫–æ–≤–∞—è';
    document.getElementById('headwindLabel2').textContent = '–í—Å—Ç—Ä–µ—á–Ω–∞—è';
    document.getElementById('frictionLabel2').textContent = '–ö–°—Ü';

    // –ò–°–ü–†–ê–í–õ–Ø–ï–ú –ï–î–ò–ù–ò–¶–´ –î–õ–Ø –í–ò–î–ò–ú–û–°–¢–ò –í –†–£–°–°–ö–û–ú
    const morUnits = document.querySelector('#morLabel').parentElement.querySelector('.units');
    if (morUnits) morUnits.textContent = '–º';

  } else {
    document.getElementById('timeLabel').textContent = 'Time UTC';
    document.getElementById('sunriseLabel').textContent = 'Sunrise';
    document.getElementById('sunsetLabel').textContent = 'Sunset';
    document.getElementById('weatherLabel').textContent = 'Weather';
    document.getElementById('morLabel').textContent = 'Visibility'; // –ò–°–ü–†–ê–í–õ–ï–ù–û: MOR ‚Üí Visibility
    document.getElementById('qbbLabel').textContent = 'QBB';
    document.getElementById('skyConditionLabel').textContent = 'Sky condition';
    document.getElementById('forecastLabel').textContent = 'Weather forecast';
    document.getElementById('specialLabel').textContent = 'Special conditions';
    document.getElementById('lateralLabel1').textContent = 'Side';
    document.getElementById('headwindLabel1').textContent = 'Head';
    document.getElementById('frictionLabel1').textContent = 'Breaking action';
    document.getElementById('lateralLabel2').textContent = 'Side';
    document.getElementById('headwindLabel2').textContent = 'Head';
    document.getElementById('frictionLabel2').textContent = 'Breaking action';

    // –ò–°–ü–†–ê–í–õ–Ø–ï–ú –ï–î–ò–ù–ò–¶–´ –î–õ–Ø –í–ò–î–ò–ú–û–°–¢–ò –í –ê–ù–ì–õ–ò–ô–°–ö–û–ú
    const morUnits = document.querySelector('#morLabel').parentElement.querySelector('.units');
    if (morUnits) morUnits.textContent = 'm'; // –ò–°–ü–†–ê–í–õ–ï–ù–û: –º ‚Üí m
  }

  // –ü–ï–†–ï–ö–û–î–ò–†–£–ï–ú –ü–û–ì–û–î–ù–´–ï –Ø–í–õ–ï–ù–ò–Ø –ò –û–ë–õ–ê–ß–ù–û–°–¢–¨ –ü–†–ò –°–ú–ï–ù–ï –Ø–ó–´–ö–ê
  if (currentMetarData) {
    console.log('üîÑ Re-decoding weather and clouds for language change:', lang);
    updateWeatherDisplay(currentMetarData);
  }
}

console.log('‚úÖ Enhanced cloud decoder integration completed with forecast filtering');

// –ù–û–í–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è QBB –∏–∑ —Ä–µ–º–∞—Ä–æ–∫ METAR
function extractQBBFromRemarks(metarString, language = 'ru') {
  if (!metarString) return null;

  // –ò—â–µ–º —Å–µ–∫—Ü–∏—é RMK –≤ METAR
  const rmkIndex = metarString.indexOf(' RMK ');
  if (rmkIndex === -1) return null;

  const remarksSection = metarString.substring(rmkIndex + 5); // +5 –¥–ª—è ' RMK '
  console.log('üîç Searching for QBB in remarks:', remarksSection);

  // –ò—â–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã QBB –≤ —Ä–µ–º–∞—Ä–∫–∞—Ö
  // –í–æ–∑–º–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: QBB150, QBB 150, QBB=150 –∏ —Ç.–¥.
  const qbbPattern = /QBB[=\s]?(\d{3,4})/i;
  const qbbMatch = remarksSection.match(qbbPattern);

  if (qbbMatch) {
    const qbbValue = parseInt(qbbMatch[1]);
    console.log(`‚úÖ Found QBB in remarks: ${qbbValue} meters`);
    return qbbValue;
  }

  // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è QBB
  const altPatterns = [
    /CLD BASE[=\s]?(\d{3,4})/i,
    /CLOUD BASE[=\s]?(\d{3,4})/i,
    /CB[=\s]?(\d{3,4})/i,
    /–í–ù–ì–û[=\s]?(\d{3,4})/i
  ];

  for (const pattern of altPatterns) {
    const match = remarksSection.match(pattern);
    if (match) {
      const qbbValue = parseInt(match[1]);
      console.log(`‚úÖ Found alternative QBB pattern in remarks: ${qbbValue} meters`);
      return qbbValue;
    }
  }

  console.log('‚ùå No QBB found in remarks');
  return null;
}

// –ù–û–í–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≥–Ω–æ–∑–æ–≤
window.testMETARFiltering = function(metarString = 'UUEE 121200Z 27008G15KT 9999 FEW020 SCT080 BKN200 12/08 Q1013 TEMPO 1215/1218 4000 -RA BKN010 BECMG 1218/1221 27015KT CAVOK RMK QBB120 TEST') {
  console.log('üß™ Testing METAR forecast filtering...');
  console.log('üì• Original:', metarString);

  const filtered = filterMETARForCurrentConditions(metarString);
  console.log('üîß Filtered:', filtered);

  const parsed = parseMetar(metarString);
  console.log('üìä Parsed weather phenomena:', parsed.weather);
  console.log('‚òÅÔ∏è Parsed clouds:', parsed.clouds);

  // –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ QBB
  const qbb = extractQBBFromRemarks(metarString);
  console.log('üè¢ Extracted QBB:', qbb);

  return { original: metarString, filtered: filtered, parsed: parsed, qbb: qbb };
};

// –ù–û–í–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±–ª–∞—á–Ω–æ—Å—Ç–∏ —Å –ø—Ä–µ–¥–ª–æ–≥–∞–º–∏ –∏ –ø–µ—Ä–µ–Ω–æ—Å–∞–º–∏
window.testCloudDisplayWithPrepositions = function(language = 'ru') {
  console.log(`üß™ Testing cloud display with prepositions and line breaks (${language})...`);

  const testClouds = [
    { coverage: 'FEW', height: 1000 },
    { coverage: 'SCT', height: 2500 },
    { coverage: 'BKN', height: 8000, type: 'TCU' }
  ];

  window.cloudDecoder.setLanguage(language);
  const decoded = window.cloudDecoder.decodeCloudiness(testClouds);

  console.log('‚òÅÔ∏è Cloud summary with prepositions and line breaks:', decoded.summary);
  console.log('üìã Layer details:', decoded.layers.map(l => `${l.coverage} ${l.heightText}${l.type ? ` (${l.type})` : ''}`));

  return decoded;
};

// –ù–û–í–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è QBB –∏–∑ —Ä–µ–º–∞—Ä–æ–∫
window.testQBBExtraction = function(metarString = 'UUEE 121200Z 27008KT 9999 FEW020 12/08 Q1013 RMK QBB150 A2991') {
  console.log('üß™ Testing QBB extraction from remarks...');
  console.log('üì• METAR:', metarString);

  const qbbRu = extractQBBFromRemarks(metarString, 'ru');
  const qbbEn = extractQBBFromRemarks(metarString, 'en');

  console.log('üè¢ QBB (RU):', qbbRu);
  console.log('üè¢ QBB (EN):', qbbEn);

  return { metar: metarString, qbbRu: qbbRu, qbbEn: qbbEn };
};
</script>

<!-- ========== –ö–û–ù–ï–¶ –ò–°–ü–†–ê–í–õ–ï–ù–ù–û–ì–û –ë–õ–û–ö–ê 6B-2B ========== -->

</body>
</html>
